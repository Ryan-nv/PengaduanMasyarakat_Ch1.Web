var na=Object.defineProperty;var aa=Object.getOwnPropertyDescriptor;var h=(p,n,e,t)=>{for(var i=t>1?void 0:t?aa(n,e):n,r=p.length-1,a;r>=0;r--)(a=p[r])&&(i=(t?a(n,e,i):a(i))||i);return t&&i&&na(n,e,i),i};var De=(p,n,e)=>new Promise((t,i)=>{var r=l=>{try{o(e.next(l))}catch(d){i(d)}},a=l=>{try{o(e.throw(l))}catch(d){i(d)}},o=l=>l.done?t(l.value):Promise.resolve(l.value).then(r,a);o((e=e.apply(p,n)).next())});import{ColumnSelection as $C,RetrieveColumnSelection as zC,SummaryType as HC,Criteria as UC}from"@serenity-is/corelib/q";import{addAttribute as H,addTypeMember as oa,MemberType as Ds,ISlickFormatter as Fs,registerClass as wi,registerEditor as Ps,registerInterface as Es,registerEnum as la,startsWith as _s,EditorAttribute as da}from"@serenity-is/corelib/q";function F(p){return function(n){return wi(n,"Serenity."+p+"Attribute")}}var U=class{constructor(n){this.value=n}};U=h([F("EnumKey")],U);var Fe=class{constructor(n){this.displayName=n}};Fe=h([F("DisplayName")],Fe);var ci=class{constructor(n){this.category=n}};ci=h([F("Category")],ci);var kt=class{constructor(n){this.value=n}};kt=h([F("ColumnsKey")],kt);var hi=class{constructor(n){this.cssClass=n}};hi=h([F("CssClass")],hi);var mi=class{constructor(n){this.value=n}};mi=h([F("DefaultValue")],mi);var rt=class{constructor(n){this.value=n}};rt=h([F("DialogType")],rt);var gi=class{constructor(n,e){this.key=n;this.value=e}};gi=h([F("EditorOption")],gi);var Di=class{constructor(n){this.editorType=n}setParams(n){}};wi(Di,"Serenity.EditorTypeAttributeBase");var fi=class extends Di{constructor(n){super(n)}};fi=h([F("EditorType")],fi);var st=class{constructor(n){this.value=n}};st=h([F("Element")],st);var Ae=class{constructor(n){this.value=n}};Ae=h([F("EntityType")],Ae);var nt=class{constructor(n=!0){this.value=n}};nt=h([F("Filterable")],nt);var at=class{constructor(n=!0){this.value=n}};at=h([F("Flexify")],at);var fe=class{constructor(n){this.value=n}};fe=h([F("FormKey")],fe);var yi=class{constructor(n){this.origin=n}};yi=h([F("GeneratedCode")],yi);var vi=class{constructor(){}};vi=h([F("Hidden")],vi);var bi=class{constructor(n){this.hint=n}};bi=h([F("Hint")],bi);var We=class{constructor(n){this.value=n}};We=h([F("IdProperty")],We);var Ci=class{constructor(n=!0){this.value=n}};Ci=h([F("Insertable")],Ci);var Je=class{constructor(n){this.value=n}};Je=h([F("IsActiveProperty")],Je);var Pe=class{constructor(n){this.value=n}};Pe=h([F("ItemName")],Pe);var qe=class{constructor(n){this.value=n}};qe=h([F("LocalTextPrefix")],qe);var ot=class{constructor(n=!0){this.value=n}};ot=h([F("Maximizable")],ot);var xi=class{constructor(n){this.maxLength=n}};xi=h([F("MaxLength")],xi);var Ot=class{constructor(n){this.value=n}};Ot=h([F("NameProperty")],Ot);var Ii=class{};Ii=h([F("OneWay")],Ii);var Me=class{};Me=h([F("Option")],Me);var lt=class{constructor(n){this.value=n}};lt=h([F("OptionsType")],lt);var dt=class{constructor(n=!0){this.value=n}};dt=h([F("Panel")],dt);var Si=class{constructor(n){this.value=n}};Si=h([F("Placeholder")],Si);var Ti=class{constructor(n=!0){this.value=n}};Ti=h([F("ReadOnly")],Ti);var ki=class{constructor(n=!0){this.isRequired=n}};ki=h([F("Required")],ki);var ut=class{constructor(n=!0){this.value=n}};ut=h([F("Resizable")],ut);var pt=class{constructor(n=!0){this.value=n}};pt=h([F("Responsive")],pt);var Ee=class{constructor(n){this.value=n}};Ee=h([F("Service")],Ee);var Oi=class{constructor(n=!0){this.value=n}};Oi=h([F("Updatable")],Oi);var m;(D=>{function p(x,I){return function(R){typeof x=="string"?wi(R,x,I):wi(R,null,x)}}D.registerClass=p;function n(x,I){return function(R){typeof x=="string"?Es(R,x,I):Es(R,null,x)}}D.registerInterface=n;function e(x,I){return function(R){typeof x=="string"?Ps(R,x,I):Ps(R,null,x)}}D.registerEditor=e;function t(x,I,R){la(x,R,I),I&&H(x,new U(I))}D.registerEnum=t;function i(x,I,R){t(x,R!=null?R:I,I)}D.registerEnumType=i;function r(x=[Fs],I=[Fs]){return p(x,I)}D.registerFormatter=r;function a(x){return function(I){H(I,new U(x))}}D.enumKey=a;function o(){return function(x,I){var R=_s(I,"get_")||_s(I,"set_"),Y=R?I.substr(4):I;oa(x.constructor,{name:Y,attr:[new Me],type:R?Ds.property:Ds.field,getter:R?"get_"+Y:null,setter:R?"set_"+Y:null})}}D.option=o;function l(x){return function(I){H(I,new rt(x))}}D.dialogType=l;function d(){return function(x){var I=new da;H(x,I)}}D.editor=d;function c(x){return function(I){H(I,new st(x))}}D.element=c;function u(x=!0){return function(I){H(I,new nt(x))}}D.filterable=u;function g(x=!0){return function(I){H(I,new at(x))}}D.flexify=g;function y(x){return function(I){H(I,new Pe(x))}}D.itemName=y;function f(x=!0){return function(I){H(I,new ot(x))}}D.maximizable=f;function v(x){return function(I){H(I,new lt(x))}}D.optionsType=v;function C(x=!0){return function(I){H(I,new dt(x))}}D.panel=C;function S(x=!0){return function(I){H(I,new ut(x))}}D.resizable=S;function O(x=!0){return function(I){H(I,new pt(x))}}D.responsive=O;function T(x){return function(I){H(I,new Ee(x))}}D.service=T})(m||(m={}));var _e=class{};_e=h([m.registerInterface("Serenity.IBooleanValue")],_e);var Z=class{};Z=h([m.registerInterface("Serenity.IDoubleValue")],Z);var ye=class{};ye=h([m.registerInterface("Serenity.IDialog")],ye);var Re=class{};Re=h([m.registerInterface("Serenity.IEditDialog")],Re);var J=class{};J=h([m.registerInterface("Serenity.IGetEditValue")],J);var E=class{};E=h([m.registerInterface("Serenity.IReadOnly")],E);var q=class{};q=h([m.registerInterface("Serenity.ISetEditValue")],q);var P=class{};P=h([m.registerInterface("Serenity.IStringValue")],P);var Ve=class{};Ve=h([m.registerInterface("Serenity.IValidateRequired")],Ve);import{registerEnum as ua}from"@serenity-is/corelib/q";var Rs=(i=>(i[i.Before=0]="Before",i[i.Delete=1]="Delete",i[i.Insert=2]="Insert",i[i.Update=3]="Update",i))(Rs||{});ua(Rs,"Serenity.CaptureOperationType");import{isEmptyOrNull as pa}from"@serenity-is/corelib/q";var re;(t=>{function p(i,r){var a=i,o=a["get_"+r];if(typeof o!="undefined")return o.apply(i);var l=e(r);return o=a["get_"+l],typeof o!="undefined"?o.apply(i):a[l]}t.getPropertyValue=p;function n(i,r,a){var o=i,l=o["set_"+r];if(typeof l!="undefined"){l.apply(i,[a]);return}var d=e(r);if(l=o["set_"+d],typeof l!="undefined"){l.apply(i,[a]);return}o[d]=a}t.setPropertyValue=n;function e(i){if(pa(i))return i;if(i==="ID")return"id";for(var r=!1,a=0,o=0;o<i.length;o++)if(i.charCodeAt(o)>=65&&i.charCodeAt(o)<=90)a++;else{r=!0;break}return!r&&i.length!==1||a===0?i:a>1?i.substr(0,a-1).toLowerCase()+i.substr(a-1):i.length===1?i.toLowerCase():i.substr(0,1).toLowerCase()+i.substr(1)}t.makeCamelCase=e})(re||(re={}));import{ArgumentNullException as fa,Exception as ya,htmlEncode as va,isAssignableFrom as ba,isEmptyOrNull as Ca,notifyError as xa}from"@serenity-is/corelib/q";import{Config as ca,endsWith as ha,getType as Vs,getTypeNameProp as ma,getTypes as ga}from"@serenity-is/corelib/q";function $e(p,n,e){let t;function i(){t=null}function r(l){var d=Vs(l);if(d!=null&&p(d))return d;for(var c of ca.rootNamespaces){var u=c+"."+l;if(d=t[u],d||(d=Vs(c+"."+l),d!=null&&p(d)))return d}}function a(){t={};for(var l of ga())if(p(l)){var d=ma(l);t[d]=l;var c=n&&n(l);c&&c!==d&&(t[c]=l)}if(e){for(var u of Object.keys(t))if(u.endsWith(e)){var g=u.substring(0,u.length-e.length);g&&!t[g]&&(t[g]=t[u])}}}function o(l){var g;if(!l)return null;var d;t==null&&a();var d=t[l];if(d)return d;if(d=r(l),d==null&&e&&!ha(l,e)&&(d=(g=t[l+e])!=null?g:r(l+e)),d){t[l]=d;var c=n&&n(d);if(c&&l!=c&&(t[c]=d),e&&l.endsWith(e)){var u=l.substring(0,l.length-e.length);u&&!t[u]&&(t[u]=t[l])}return d}return d}return{reset:i,tryGet:o}}var ct;(i=>{let p=$e(r=>ba(ye,r),null,"Dialog");function n(r){if(Ca(r))throw new fa("key");var a=p.tryGet(r);if(a)return a;var o=`"${va(r)}" dialog class not found! 
Make sure there is such a dialog type under the project root namespace, 
and its namespace parts start with capital letters like MyProject.MyModule.MyDialog.

If using ES modules, make sure the dialog type has a decorator like 
@Decorators.registerClass('MyProject.MyModule.MyDialog') with the full name
and "side-effect-import" this dialog class from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyDialog.ts").

If you had this error from an editor with the InplaceAdd option, verify that the lookup key
and dialog type name match case-sensitively, excluding the Dialog suffix.
Specify the DialogType property in the LookupEditor attribute if it is not.

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw xa(o.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new ya(o)}i.get=n;function e(){p.reset()}i.reset=e;function t(r){return p.tryGet(r)}i.tryGet=t})(ct||(ct={}));import{ArgumentNullException as Pa,EditorAttribute as Ea,Exception as _a,getAttributes as Ra,htmlEncode as Va,isAssignableFrom as Qa,isEmptyOrNull as Ba,notifyError as Na}from"@serenity-is/corelib/q";function Qs(p){function n(){if(typeof p=="undefined"||!p.ui||!p.ui.dialog||!p.ui.dialog.prototype)return!1;p.ui.dialog.prototype._allowInteraction=function(e){return p(e.target).closest(".ui-dialog").length?!0:!!p(e.target).closest(".ui-datepicker, .select2-drop, .cke, .cke_dialog, .modal, #support-modal").length},function(e){p.ui.dialog.prototype._focusTabbable=function(){if(p(document.documentElement).hasClass("mobile-device")){this.uiDialog&&this.uiDialog.focus();return}e.call(this)}}(p.ui.dialog.prototype._focusTabbable),function(e){p.ui.dialog.prototype._createTitlebar=function(){e.call(this),this.uiDialogTitlebar.find(".ui-dialog-titlebar-close").html('<i class="fa fa-times" />')}}(p.ui.dialog.prototype._createTitlebar)}!n()&&typeof p!="undefined"&&p.fn&&p(n),typeof p!="undefined"&&p.fn&&(p.toJSON||(p.toJSON=JSON.stringify),p.parseJSON||(p.parseJSON=JSON.parse),p.cleanData=function(e){return function(t){var i,r,a,o,l=t;for(a=0;(r=l[a])!=null;a++)try{i=p._data(r,"events"),i&&i.remove&&(l===t&&(l=Array.prototype.slice.call(t)),p(r).triggerHandler("remove"),delete i.remove)}catch(d){}e(t)}}(p.cleanData))}import{addValidationRule as Ia,ArgumentNullException as Sa,Config as Ta,Exception as Hr,format as Ur,getAttributes as ka,getInstanceType as Pi,getTypeFullName as Ei,getTypeShortName as Oa,isAssignableFrom as Fi,notifyError as wa,replaceAll as Bs,startsWith as Da}from"@serenity-is/corelib/q";function Fa(){var n,e;let p=typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:null;typeof React=="undefined"&&typeof p!="undefined"&&(p.preact!=null?(p.React=p.ReactDOM=p.preact,React.Fragment=(n=React.Fragment)!=null?n:"x-fragment"):p.Nerv!=null?(p.React=p.ReactDOM=p.Nerv,React.Fragment=(e=React.Fragment)!=null?e:"x-fragment"):(p.React={Component:function(){},Fragment:"x-fragment",createElement:function(){return{_reactNotLoaded:!0}}},p.ReactDOM={render:function(){throw Error("To use React, it should be included before Serenity.CoreLib.js")}}))}Fa();var b=class{constructor(n,e){if(this.element=n,this.options=e||{},this.widgetName=b.getWidgetName(Pi(this)),this.uniqueName=this.widgetName+(b.nextWidgetNumber++).toString(),n.data(this.widgetName))throw new Hr(Ur("The element already has widget '{0}'!",this.widgetName));n.on("remove."+this.widgetName,t=>{t.bubbles||t.cancelable||this.destroy()}).data(this.widgetName,this),this.addCssClass(),this.idPrefix=this.uniqueName+"_",this.renderContents()}destroy(){this.element&&(this.element.removeClass(this.getCssClass()),this.element.off("."+this.widgetName).off("."+this.uniqueName).removeData(this.widgetName),this.element=null)}addCssClass(){this.element.addClass(this.getCssClass())}getCssClass(){var n=Pi(this),e=[],t=Bs(Ei(n),".","-");e.push(t);for(let i of Ta.rootNamespaces)if(Da(t,i+"-")){e.push(t.substr(i.length+1));break}return e.push(Oa(n)),e.filter((i,r,a)=>a.indexOf(i)===r).map(i=>"s-"+i).join(" ")}static getWidgetName(n){return Bs(Ei(n),".","_")}static elementFor(n){var e=ka(n,st,!0),t=e.length>0?e[0].value:"<input/>";return $(t)}addValidationRule(n,e){return Ia(this.element,n,e)}getGridField(){return this.element.closest(".field")}change(n){this.element.on("change."+this.uniqueName,n)}changeSelect2(n){this.element.on("change."+this.uniqueName,function(e,t){t!==!0&&n(e)})}static create(n){let e;if(Fi(ye,n.type))e=new n.type(n.options),n.container&&e.element.appendTo(n.container),n.element&&n.element(e.element);else{var t=b.elementFor(n.type);n.container&&t.appendTo(n.container),n.element&&n.element(t),e=new n.type(t,n.options)}return e.init(null),n.init&&n.init(e),e}initialize(){}init(n){return n&&n(this),this}renderContents(){}};b.nextWidgetNumber=0,b.__isWidgetType=!0,b=h([m.registerClass("Serenity.Widget")],b);typeof $!="undefined"&&$.fn&&($.fn.tryGetWidget=function(p){var n=this,e;if(Fi(b,p)){var t=b.getWidgetName(p);if(e=n.data(t),e!=null&&!Fi(p,Pi(e))&&(e=null),e!=null)return e}var i=n.data();if(i==null)return null;for(var r of Object.keys(i))if(e=i[r],e!=null&&Fi(p,Pi(e)))return e;return null},$.fn.getWidget=function(p){if(this==null)throw new Sa("element");if(this.length===0)throw new Hr(Ur("Searching for widget of type '{0}' on a non-existent element! ({1})",Ei(p),this.selector));var n=this.tryGetWidget(p);if(n==null){var e=Ur("Element has no widget of type '{0}'! If you have recently changed editor type of a property in a form class, or changed data type in row (which also changes editor type) your script side Form definition might be out of date. Make sure your project builds successfully and transform T4 templates",Ei(p));throw wa(e,"",null),new Hr(e)}return n});typeof jQuery=="function"&&Qs(jQuery);var ht;(i=>{let p=$e(r=>!!Ra(r,Ea).length||Qa(b,r),null,"Editor");function n(r){if(Ba(r))throw new Pa("key");var a=p.tryGet(r);if(a)return a;var o=`"${Va(r)}" editor class not found! 
Make sure there is such a editor type under the project root namespace,
and its namespace parts start with capital letters like MyProject.MyModule.MyEditor.

If using ES modules, make sure the editor type has a decorator like 
@Decorators.registerEditor('MyProject.MyModule.MyFormatter') with the full name 
and "side-effect-import" this editor class from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyEditor.ts").

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw Na(o.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new _a(o)}i.get=n;function e(){p.reset()}i.reset=e;function t(r){return p.tryGet(r)}i.tryGet=t})(ht||(ht={}));import{Exception as La,getAttributes as Ga,htmlEncode as Aa,isEnum as Wa,notifyError as Ja}from"@serenity-is/corelib/q";var ze;(i=>{let p=$e(Wa,r=>{var a;return(a=Ga(r,U)[0])==null?void 0:a.value},null);function n(r){var a=p.tryGet(r);if(a)return a;var o=`Can't find "${Aa(r)}" enum type! 
If you have recently defined this enum type in server side code, make sure 
your project builds successfully and run "dotnet sergen t". 

Also verify there is such an enum type under the project root namespace, 
and its namespace parts start with capital letters like MyProject.MyModule.MyEnum.

If using ES modules, make sure the enum type is registered with 
Q.registerEnum('MyProject.MyModule.MyDialog') with the full name of 
your enum type and "side-effect-import" this enum from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyEnum.ts").

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw Ja(o.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new La(o)}i.get=n;function e(){p.reset()}i.reset=e;function t(r){return p.tryGet(r)}i.tryGet=t})(ze||(ze={}));import{ISlickFormatter as Mp}from"@serenity-is/corelib/q";import{executeOnceWhenVisible as qa,executeEverytimeWhenVisible as Ma}from"@serenity-is/corelib/q";var ve;(e=>(e.executeOnceWhenShown=qa,e.executeEverytimeWhenShown=Ma))(ve||(ve={}));var Ns=class{constructor(n){this.idPrefix=n}byId(n){return $("#"+this.idPrefix+n)}w(n,e){return $("#"+this.idPrefix+n).getWidget(e)}};import{htmlEncode as Ls,isEmptyOrNull as jr,startsWith as Kr}from"@serenity-is/corelib/q";var mt=class extends b{constructor(n,e){super(n,e),n.addClass("s-PopupMenuButton"),n.click(t=>{var a,o;t.preventDefault(),t.stopPropagation(),this.options.onPopup!=null&&this.options.onPopup();var i=this.options.menu;i.show().position({my:(a=this.options.positionMy)!=null?a:"left top",at:(o=this.options.positionAt)!=null?o:"left bottom",of:this.element});var r=this.uniqueName;$(document).one("click."+r,function(l){i.hide()})}),this.options.menu.hide().appendTo(document.body).addClass("s-PopupMenu").menu()}destroy(){this.options.menu!=null&&(this.options.menu.remove(),this.options.menu=null),super.destroy()}};mt=h([m.registerEditor("Serenity.PopupMenuButton")],mt);var _i=class extends mt{constructor(n,e){super(n,e),n.addClass("s-PopupToolButton"),$("<b/>").appendTo(n.children(".button-outer").children("span"))}};_i=h([m.registerEditor("Serenity.PopupToolButton")],_i);var A=class extends b{constructor(e,t){super(e,t);this.element.addClass("s-Toolbar clearfix").html('<div class="tool-buttons"><div class="buttons-outer"><div class="buttons-inner"></div></div></div>'),this.createButtons()}destroy(){this.element.find("div.tool-button").unbind("click"),this.mouseTrap&&(this.mouseTrap.destroy?this.mouseTrap.destroy():this.mouseTrap.reset(),this.mouseTrap=null),super.destroy()}createButtons(){for(var e=$("div.buttons-inner",this.element).last(),t=this.options.buttons,i=0,r=0;r<t.length;r++){var a=t[r];a.separator&&i>0&&(e=$('<div class="buttons-inner"></div>').appendTo(e.parent()),i=0),this.createButton(e,a),i++}}createButton(e,t){var l;var i=(l=t.cssClass)!=null?l:"",r=$('<div class="tool-button"><div class="button-outer"><span class="button-inner"></span></div></div>').appendTo(e);(t.separator==="right"||t.separator==="both")&&$('<div class="separator"></div>').appendTo(e),i.length>0&&r.addClass(i),jr(t.hint)||r.attr("title",t.hint),r.click(function(d){r.hasClass("disabled")||t.onClick(d)});var a=t.title;if(t.htmlEncode!==!1&&(a=Ls(t.title)),!jr(t.icon)){r.addClass("icon-tool-button");var o=t.icon;Kr(o,"fa-")?o="fa "+o:Kr(o,"glyphicon-")&&(o="glyphicon "+o),a="<i class='"+Ls(o)+"'></i> "+a}a==null||a.length===0?r.addClass("no-text"):r.find("span").html(a),t.visible===!1&&r.hide(),t.disabled!=null&&typeof t.disabled!="function"&&r.toggleClass("disabled",!!t.disabled),(typeof t.visible=="function"||typeof t.disabled=="function")&&r.on("updateInterface",()=>{typeof t.visible=="function"&&r.toggle(!!t.visible()),typeof t.disabled=="function"&&r.toggleClass("disabled",!!t.disabled())}),!jr(t.hotkey)&&window.Mousetrap!=null&&(this.mouseTrap=this.mouseTrap||window.Mousetrap(t.hotkeyContext||this.options.hotkeyContext||window.document.documentElement),this.mouseTrap.bind(t.hotkey,function(d,c){return r.is(":visible")&&r.triggerHandler("click"),t.hotkeyAllowDefault}))}findButton(e){return e!=null&&Kr(e,".")&&(e=e.substr(1)),$("div.tool-button."+e,this.element)}updateInterface(){this.element.find(".tool-button").each(function(e,t){$(t).triggerHandler("updateInterface")})}};A=h([m.registerClass("Serenity.Toolbar")],A);import{canLoadScriptData as Ri,Config as $a,format as za,getBaseType as Ha,getInstanceType as Yr,getTemplate as Ua,getTypeFullName as Xr,getTypeShortName as Gs,replaceAll as ja,startsWith as Ka,localText as Ya}from"@serenity-is/corelib/q";var N=class extends b{byId(n){return $("#"+this.idPrefix+n)}byID(n,e){return this.byId(n).getWidget(e)}static noGeneric(n){var e=n.indexOf("$");return e>=0?n.substr(0,e):n}getDefaultTemplateName(){return N.noGeneric(Gs(Yr(this)))}getTemplateName(){var n=Yr(this),e=Xr(n),t=N.templateNames,i=N.templateNames[e];if(i!=null)return i;for(;n&&n!==b;){var r=N.noGeneric(Xr(n));for(let a of $a.rootNamespaces)if(Ka(r,a+".")){r=r.substr(a.length+1);break}if(Ri("Template."+r)||(r=ja(r,".","_"),Ri("Template."+r)||$("script#Template_"+r).length>0))return t[e]=r,r;if(r=N.noGeneric(Gs(n)),Ri("Template."+r)||$("script#Template_"+r).length>0)return N.templateNames[e]=r,r;n=Ha(n)}return t[e]=i=this.getDefaultTemplateName(),i}getFallbackTemplate(){return null}getTemplate(){var n=this.getTemplateName(),e=$("script#Template_"+n);if(e.length>0)return e.html();let t;if(!Ri("Template."+n)&&this.getDefaultTemplateName()==n&&(t=this.getFallbackTemplate(),t!=null))return t;if(t=Ua(n),t==null)throw new Error(za("Can't locate template for widget '{0}' with name '{1}'!",Xr(Yr(this)),n));return t}renderContents(){for(var n=this.getTemplate().replace(new RegExp("~_","g"),this.idPrefix),e=0;;){var t=n.indexOf('{{text:"',e);if(t<0)break;var e=n.indexOf('"}}',t);if(e<0)break;var i=n.substr(t+8,e-t-8),r=Ya(i);n=n.substr(0,t)+r+n.substr(e+3),e=t+r.length}this.element.html(n)}};N.templateNames={},N=h([m.registerClass("Serenity.TemplatedWidget")],N);import{bsModalMarkup as Xa,closePanel as Za,Config as eo,dialogButtonToBS as to,dialogButtonToUI as io,endsWith as ro,getAttributes as Zt,getInstanceType as Qi,isEmptyOrNull as so,layoutFillHeight as no,newBodyDiv as ao,parseInteger as oo,positionToastContainer as lo,validateOptions as uo}from"@serenity-is/corelib/q";typeof $!="undefined"&&$.fn&&($.fn.flexHeightOnly=function(p=1){return this.flexWidthHeight(0,p)},$.fn.flexWidthOnly=function(p=1){return this.flexWidthHeight(p,0)},$.fn.flexWidthHeight=function(p=1,n=1){return this.addClass("flexify").data("flex-x",p).data("flex-y",n)},$.fn.flexX=function(p){return this.data("flex-x",p)},$.fn.flexY=function(p){return this.data("flex-y",p)});var Vi=class extends b{constructor(e,t){super(e,t);this.xDifference=0;this.yDifference=0;ve.executeOnceWhenShown(e,()=>{this.storeInitialSize()})}storeInitialSize(){if(!this.element.data("flexify-init")){var e=this.options.designWidth;e==null&&(e=this.element.width()),this.element.data("flexify-width",e);var t=this.options.designHeight;t==null&&(t=this.element.height()),this.element.data("flexify-height",t),this.element.data("flexify-init",!0),this.element.on("resize."+this.uniqueName,()=>this.resizeElements()),this.element.on("resizestop."+this.uniqueName,()=>this.resizeElements());var i=this.element.find(".ui-tabs");i.length>0&&i.on("tabsactivate."+this.uniqueName,()=>this.resizeElements()),(this.options.designWidth!=null||this.options.designHeight!=null)&&this.resizeElements()}}getXFactor(e){var t=null;return this.options.getXFactor!=null&&(t=this.options.getXFactor(e)),t==null&&(t=e.data("flex-x")),t!=null?t:1}getYFactor(e){var t=null;return this.options.getYFactor!=null&&(t=this.options.getYFactor(e)),t==null&&(t=e.data("flex-y")),t!=null?t:0}resizeElements(){var e=this.element.width(),t=this.element.data("flexify-width");t==null&&(this.element.data("flexify-width",e),t=e);var i=this.element.height(),r=this.element.data("flexify-height");r==null&&(this.element.data("flexify-height",i),r=i),this.xDifference=e-t,this.yDifference=i-r;var a=this.element,o=this.element.find(".ui-tabs-panel");o.length>0&&(a=o.filter(":visible")),a.find(".flexify").add(o.filter(".flexify:visible")).each((l,d)=>{this.resizeElement($(d))})}resizeElement(e){var t=this.getXFactor(e);if(t!==0){var i=e.data("flexify-width");if(i==null){var r=e.width();e.data("flexify-width",r),i=r}e.width(i+t*this.xDifference|0)}var a=this.getYFactor(e);if(a!==0){var o=e.data("flexify-height");if(o==null){var l=e.height();e.data("flexify-height",l),o=l}e.height(o+a*this.yDifference|0)}e.hasClass("require-layout")&&e.triggerHandler("layout")}};var He;(t=>{function p(i,r,a,o,l){var d=i.dialog();return d.dialog("option","resizable",!0),o!=null&&d.dialog("option","minWidth",o),r!=null&&d.dialog("option","width",r),l!=null&&d.dialog("option","minHeight",l),a!=null&&d.dialog("option","height",a),i}t.dialogResizable=p;function n(i){return i.dialogExtend({closable:!0,maximizable:!0,dblclick:"maximize",icons:{maximize:"ui-icon-maximize-window"}}),i}t.dialogMaximizable=n;function e(i){return new Vi(i.closest(".ui-dialog"),{}),i}t.dialogFlexify=e})(He||(He={}));var V=class extends N{constructor(e){super(ao().addClass("s-TemplatedDialog hidden"),e);this.element.attr("id",this.uniqueName),this.initValidator(),this.initTabs(),this.initToolbar()}get isMarkedAsPanel(){var e=Zt(Qi(this),dt,!0);return e.length>0&&e[e.length-1].value!==!1}get isResponsive(){return eo.responsiveDialogs||Zt(Qi(this),pt,!0).length>0}static getCssSize(e,t){var i=e.css(t);if(i==null||!ro(i,"px"))return null;i=i.substr(0,i.length-2);let r=oo(i);return r==null||isNaN(r)||r==0?null:r}static applyCssSizes(e,t){let i,r=$("<div/>").hide().addClass(t).appendTo(document.body);try{var a=$("<div/>").addClass("size").appendTo(r);i=V.getCssSize(a,"minWidth"),i!=null&&(e.minWidth=i),i=V.getCssSize(a,"width"),i!=null&&(e.width=i),i=V.getCssSize(a,"height"),i!=null&&(e.height=i),i=V.getCssSize(a,"minHeight"),i!=null&&(e.minHeight=i)}finally{r.remove()}}destroy(){if(this.tabs&&this.tabs.tabs("destroy"),this.tabs=null,this.toolbar&&this.toolbar.destroy(),this.toolbar=null,this.validator&&this.byId("Form").remove(),this.validator=null,this.element!=null&&this.element.hasClass("ui-dialog-content"))this.element.dialog("destroy"),this.element.removeClass("ui-dialog-content");else if(this.element!=null&&this.element.hasClass("modal-body")){var e=this.element.closest(".modal").data("bs.modal",null);this.element&&this.element.removeClass("modal-body"),window.setTimeout(()=>e.remove(),0)}$(window).unbind("."+this.uniqueName),super.destroy()}initDialog(){if(this.element.hasClass("ui-dialog-content"))return;this.element.removeClass("hidden"),this.element.dialog(this.getDialogOptions()),this.element.closest(".ui-dialog").on("resize",i=>this.arrange());let e=Qi(this);this.isResponsive?(He.dialogResizable(this.element),$(window).bind("resize."+this.uniqueName,i=>{this.element&&this.element.is(":visible")&&this.handleResponsive()}),this.element.closest(".ui-dialog").addClass("flex-layout")):He.dialogFlexify&&Zt(e,at,!0).length>0&&(He.dialogFlexify(this.element),He.dialogResizable(this.element)),Zt(e,ot,!0).length>0&&He.dialogMaximizable(this.element);var t=this;this.element.bind("dialogopen."+this.uniqueName,()=>{$(document.body).addClass("modal-dialog-open"),this.isResponsive&&this.handleResponsive(),t.onDialogOpen()}),this.element.bind("dialogclose."+this.uniqueName,()=>{$(document.body).toggleClass("modal-dialog-open",$(".ui-dialog:visible").length>0),t.onDialogClose()})}getModalOptions(){return{backdrop:!1,keyboard:!1,size:"lg",modalClass:this.getCssClass()}}initModal(){var c,u;if(!this.element.hasClass("modal-body")){var e=(u=(c=this.element.data("dialogtitle"))!=null?c:this.getDialogTitle())!=null?u:"",t=this.getModalOptions();t.show=!1;var i="s-Modal";t.modalClass&&(i+=" "+t.modalClass);var r=Xa(e,"",i),a=$(r).eq(0).appendTo(document.body).addClass("flex-layout");a.one("shown.bs.modal."+this.uniqueName,()=>{this.element.triggerHandler("shown.bs.modal"),this.onDialogOpen()}),a.one("hidden.bs.modal."+this.uniqueName,()=>{$(document.body).toggleClass("modal-open",$(".modal.show").length+$(".modal.in").length>0),this.onDialogClose()}),t.size&&a.find(".modal-dialog").addClass("modal-"+t.size);var o=a.find(".modal-footer"),l=this.getDialogButtons();if(l!=null)for(var d of l)$(to(d)).appendTo(o).click(d.click);else o.hide();a.modal(t),a.find(".modal-body").replaceWith(this.element.removeClass("hidden").addClass("modal-body")),$(window).on("resize."+this.uniqueName,this.arrange.bind(this))}}initToolbar(){var e=this.byId("Toolbar");if(e.length!==0){var t=this.element.closest(".ui-dialog");t.length===0&&(t=this.element.closest(".modal"),t.length==0&&(t=this.element));var i={buttons:this.getToolbarButtons(),hotkeyContext:t[0]};this.toolbar=new A(e,i)}}getToolbarButtons(){return[]}getValidatorOptions(){return{}}initValidator(){var e=this.byId("Form");if(e.length>0){var t=this.getValidatorOptions();this.validator=e.validate(uo(t))}}resetValidation(){this.validator&&this.validator.resetAll()}validateForm(){return this.validator==null||!!this.validator.form()}dialogOpen(e){e=e!=null?e:this.isMarkedAsPanel,e?(this.element.hasClass("s-Panel")||(this.element.on("panelopen."+this.uniqueName,()=>{this.onDialogOpen()}),this.element.on("panelclose."+this.uniqueName,()=>{this.onDialogClose()})),V.openPanel(this.element,this.uniqueName),this.setupPanelTitle()):this.useBSModal()?(this.initModal(),this.element.closest(".modal").modal("show")):(this.initDialog(),this.element.dialog("open"))}useBSModal(){return!!(!$.ui||!$.ui.dialog||V.bootstrapModal)}static openPanel(e,t){var i=$(".panels-container");i.length||(i=$("section.content")),e.data("paneluniquename",t),i.length&&(i=i.last(),i.children().not(e).not(".panel-hidden").addClass("panel-hidden panel-hidden-"+t),e[0].parentElement!==i[0]&&e.appendTo(i)),$(".ui-dialog:visible, .ui-widget-overlay:visible, .modal.show, .modal.in").not(e).addClass("panel-hidden panel-hidden-"+t),e.removeClass("hidden").removeClass("panel-hidden").addClass("s-Panel").trigger("panelopen")}static closePanel(e,t){return Za(e,t)}onDialogOpen(){$(document.documentElement).hasClass("mobile-device")||$(":input",this.element).not("button").eq(0).focus(),this.arrange(),this.tabs&&this.tabs.tabs("option","active",0)}arrange(){this.element.find(".require-layout").filter(":visible").each(function(e,t){$(t).triggerHandler("layout")})}onDialogClose(){$(document).trigger("click"),$.qtip&&$(document.body).children(".qtip").each(function(e,t){$(t).qtip("hide")}),window.setTimeout(()=>{var e=this.element;this.destroy(),e.remove(),lo(!1,null)},0)}addCssClass(){this.isMarkedAsPanel&&(super.addCssClass(),this.isResponsive&&this.element.addClass("flex-layout"))}getDialogButtons(){}getDialogOptions(){var a,o;var e={},t="s-Dialog "+this.getCssClass();e.dialogClass=t;var i=this.getDialogButtons();i!=null&&(e.buttons=i.map(io)),e.width=920,V.applyCssSizes(e,t),e.autoOpen=!1;let r=Qi(this);return e.resizable=Zt(r,ut,!0).length>0,e.modal=!0,e.position={my:"center",at:"center",of:$(window.window)},e.title=(o=(a=this.element.data("dialogtitle"))!=null?a:this.getDialogTitle())!=null?o:"",e}getDialogTitle(){return""}dialogClose(){this.element.hasClass("ui-dialog-content")?this.element.dialog().dialog("close"):this.element.hasClass("modal-body")?this.element.closest(".modal").modal("hide"):this.element.hasClass("s-Panel")&&!this.element.hasClass("hidden")&&V.closePanel(this.element)}get dialogTitle(){return this.element.hasClass("ui-dialog-content")?this.element.dialog("option","title"):this.element.hasClass("modal-body")?this.element.closest(".modal").find(".modal-header").children("h5").text():this.element.data("dialogtitle")}setupPanelTitle(){var i;var e=(i=this.dialogTitle)!=null?i:this.getDialogTitle(),t=this.element.children(".panel-titlebar");so(e)?t.remove():(this.element.children(".panel-titlebar").length||(t=$("<div class='panel-titlebar'><div class='panel-titlebar-text'></div></div>").prependTo(this.element)),t.children(".panel-titlebar-text").text(e),this.element.hasClass("s-Panel")&&(t.children(".panel-titlebar-close").length||$('<button class="panel-titlebar-close">&nbsp;</button>').prependTo(t).click(r=>{V.closePanel(this.element,r)})))}set dialogTitle(e){var t=this.dialogTitle;this.element.data("dialogtitle",e),this.element.hasClass("ui-dialog-content")?this.element.dialog("option","title",e):this.element.hasClass("modal-body")?this.element.closest(".modal").find(".modal-header").children("h5").text(e!=null?e:""):this.element.hasClass("s-Panel")&&t!=this.dialogTitle&&(this.setupPanelTitle(),this.arrange())}set_dialogTitle(e){this.dialogTitle=e}initTabs(){var e=this.byId("Tabs");e.length!==0&&(this.tabs=e.tabs({}),this.tabs.bind("tabsactivate",()=>this.arrange()))}handleResponsive(){var e=this.element.dialog(),t=this.element.closest(".ui-dialog");if($(document.documentElement).hasClass("mobile-device")){var i=this.element.data("responsiveData");if(!i){i={},i.draggable=e.dialog("option","draggable"),i.resizable=e.dialog("option","resizable"),i.position=e.css("position");var r=t.position();i.left=r.left,i.top=r.top,i.width=t.width(),i.height=t.height(),i.contentHeight=this.element.height(),this.element.data("responsiveData",i),e.dialog("option","draggable",!1),e.dialog("option","resizable",!1)}t.addClass("mobile-layout"),t.css({left:"0px",top:"0px",width:$(window).width()+"px",height:$(window).height()+"px",position:"fixed"}),$(document.body).scrollTop(0),no(this.element)}else{var a=this.element.data("responsiveData");a&&(e.dialog("option","draggable",a.draggable),e.dialog("option","resizable",a.resizable),this.element.closest(".ui-dialog").css({left:"0px",top:"0px",width:a.width+"px",height:a.height+"px",position:a.position}),this.element.height(a.contentHeight),t.removeClass("mobile-layout"),this.element.removeData("responsiveData"))}}};V=h([m.registerClass("Serenity.TemplatedDialog",[ye])],V);import{validateOptions as po}from"@serenity-is/corelib/q";var wt=class extends N{constructor(e,t){super(e,t);this.initValidator(),this.initTabs(),this.initToolbar()}destroy(){this.tabs&&(this.tabs.tabs("destroy"),this.tabs=null),this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),this.validator&&(this.byId("Form").remove(),this.validator=null),super.destroy()}arrange(){this.element.find(".require-layout").filter(":visible").each(function(e,t){$(t).triggerHandler("layout")})}getToolbarButtons(){return[]}getValidatorOptions(){return{}}initTabs(){var e=this.byId("Tabs");e.length!==0&&(this.tabs=e.tabs({}))}initToolbar(){var e=this.byId("Toolbar");if(e.length!==0){var t={buttons:this.getToolbarButtons()};this.toolbar=new A(e,t)}}initValidator(){var e=this.byId("Form");if(e.length>0){var t=this.getValidatorOptions();this.validator=e.validate(po(t))}}resetValidation(){this.validator&&this.validator.resetAll()}validateForm(){return this.validator==null||!!this.validator.form()}};wt=h([m.registerClass("Serenity.TemplatedPanel")],wt);import{Exception as co,validatorAbortHandler as ho}from"@serenity-is/corelib/q";var Dt;(t=>{function p(i,r,a){var o=i.validate(),l=o.settings;return l.abortHandler||r!=null&&r()===!1?!1:(l.abortHandler=ho,l.submitHandler=function(){return a!=null&&a(),!1},i.trigger("submit"),!0)}t.asyncSubmit=p;function n(i,r,a){var o=i.validate(),l=o.settings;return l.abortHandler!=null||r!=null&&r()===!1||!o.form()?!1:(a!=null&&a(),!0)}t.submit=n;function e(i){var r=i.closest("form");return r.length===0?null:r.data("validator")}t.getValidator=e})(Dt||(Dt={}));var As;(t=>{function p(i,r,a){if(!i.length)return i;if(a==null)throw new co("rule is null!");return i.addClass("customValidate").bind("customValidate."+r,a),i}t.addValidationRule=p;function n(i,r){return i.unbind("customValidate."+r),i}t.removeValidationRule=n;function e(i,r){return i.element(r.element[0])}t.validateElement=e})(As||(As={}));import{findElementWithRelativeId as Ws,isEmptyOrNull as Js,notifyError as mo}from"@serenity-is/corelib/q";var Ue=class{constructor(n,e,t){this.parentType=n;this.widget=e;this.parentChange=t;this.bind(),this.widget.element.bind("remove."+e.uniqueName+"cwh",i=>{this.unbind(),this.widget=null,this.parentChange=null})}bind(){if(Js(this._parentID))return null;var n=Ws(this.widget.element,this._parentID).tryGetWidget(this.parentType);return n!=null?(n.element.bind("change."+this.widget.uniqueName,()=>{this.parentChange(n)}),n):(mo("Can't find cascaded parent element with ID: "+this._parentID+"!","",null),null)}unbind(){if(Js(this._parentID))return null;var n=Ws(this.widget.element,this._parentID).tryGetWidget(this.parentType);return n!=null&&n.element.unbind("."+this.widget.uniqueName),n}get_parentID(){return this._parentID}set_parentID(n){this._parentID!==n&&(this.unbind(),this._parentID=n,this.bind())}};Ue=h([m.registerClass("Serenity.CascadedWidgetLink")],Ue);var Bi;(r=>{function p(a,o,l){if(a){var d=t(a);if(d){var c=d[o];c!=null&&(l&&c===a.tabs("option","active")&&a.tabs("option","active",0),a.tabs(l?"disable":"enable",c))}}}r.setDisabled=p;function n(a,o,l){if(a){var d=t(a);if(d){var c=d[o];c!=null&&(!l&&c===a.tabs("option","active")&&a.tabs("option","active",0),a.children("ul").children("li").eq(c).toggle(l))}}}r.toggle=n;function e(a){var o=a.children("ul").children("li").eq(a.tabs("option","active")).children("a").attr("href").toString(),l="_Tab",d=o.lastIndexOf(l);return d>=0&&(o=o.substr(d+l.length)),o}r.activeTabKey=e;function t(a){var o=a.data("indexByKey");return o||(o={},a.children("ul").children("li").children("a").each(function(l,d){var c=d.getAttribute("href").toString(),u="_Tab",g=c.lastIndexOf(u);g>=0&&(c=c.substr(g+u.length)),o[c]=l}),a.data("indexByKey",o)),o}r.indexByKey=t;function i(a,o){var l=t(a);if(l){var d=l[o];d!=null&&d!==a.tabs("option","active")&&a.tabs("option","active",d)}}r.selectTab=i})(Bi||(Bi={}));import{getInstanceType as go,getMembers as qs,isInstanceOfType as Ni,MemberType as Ms}from"@serenity-is/corelib/q";var be;(n=>{function p(e,t){if(t!=null){var i=go(e);if(i!==Object){var r=i.__propByName,a=i.__fieldByName;if(r==null){var o=qs(i,Ms.property),l=o.filter(function(x){return!!x.setter&&((x.attr||[]).filter(function(I){return Ni(I,Me)}).length>0||(x.attr||[]).filter(function(I){return Ni(I,Fe)}).length>0)});r={};for(var d of l)r[re.makeCamelCase(d.name)]=d;i.__propByName=r}if(a==null){var c=qs(i,Ms.field),u=c.filter(function(x){return(x.attr||[]).filter(function(I){return Ni(I,Me)}).length>0||(x.attr||[]).filter(function(I){return Ni(I,Fe)}).length>0});a={};for(var g=0;g<u.length;g++){var y=u[g];a[re.makeCamelCase(y.name)]=y}i.__fieldByName=a}var f=Object.keys(t);for(var v of f){var C=t[v],S=re.makeCamelCase(v),O=r[S]||r[v];if(O!=null){var T=e[O.setter];T&&T.call(e,C)}else{var D=a[S]||a[v];D&&(e[D.name]=C)}}}}}n.set=p})(be||(be={}));import{any as zs,Authorization as es,Culture as bo,extend as Hs,getAttributes as Co,getTypeShortName as Us,isBS3 as ts,isBS5Plus as xo,isEmptyOrNull as Qe,startsWith as js,localText as Io,trimToEmpty as Ks,trimToNull as Ys,tryGetText as Xs}from"@serenity-is/corelib/q";import{cast as ei,isInstanceOfType as Zr,isTrimmedEmpty as fo,parseDecimal as yo,safeCast as Ce,localText as vo,tryGetText as $s}from"@serenity-is/corelib/q";var w;(c=>{function p(u){var v,C,S;var g=u.element.data("select2");if(g!=null){var y=u.element.select2("data");return y==null?"":(v=y.text)!=null?v:""}var f=e(u);return f==null?"":typeof f=="string"?f:f instanceof Boolean?f?(C=$s("Controls.FilterPanel.OperatorNames.true"))!=null?C:"True":(S=$s("Controls.FilterPanel.OperatorNames.true"))!=null?S:"False":f.toString()}c.getDisplayText=p;var n={name:"_"};function e(u){var g={};return t(u,n,g),g._}c.getValue=e;function t(u,g,y){var f=Ce(u,J);if(f!=null){f.getEditValue(g,y);return}var v=Ce(u,P);if(v!=null){y[g.name]=v.get_value();return}var C=Ce(u,_e);if(C!=null){y[g.name]=C.get_value();return}var S=Ce(u,Z);if(S!=null){var O=S.get_value();y[g.name]=isNaN(O)?null:O;return}if(u.getEditValue!=null){u.getEditValue(g,y);return}if(u.element.is(":input")){y[g.name]=u.element.val();return}}c.saveValue=t;function i(u,g){var y={_:g};r(u,n,y)}c.setValue=i;function r(u,g,y){var f=Ce(u,q);if(f!=null){f.setEditValue(y,g);return}var v=Ce(u,P);if(v!=null){var C=y[g.name];C!=null&&(C=C.toString()),v.set_value(ei(C,String));return}var S=Ce(u,_e);if(S!=null){var O=y[g.name];typeof O=="number"?S.set_value(O>0):S.set_value(!!O);return}var T=Ce(u,Z);if(T!=null){var D=y[g.name];D==null||Zr(D,String)&&fo(ei(D,String))?T.set_value(null):Zr(D,String)?T.set_value(ei(yo(ei(D,String)),Number)):Zr(D,Boolean)?T.set_value(D?1:0):T.set_value(ei(D,Number));return}if(u.setEditValue!=null){u.setEditValue(y,g);return}if(u.element.is(":input")){var x=y[g.name];x==null?u.element.val(""):u.element.val(x);return}}c.loadValue=r;function a(u,g){return u.each(function(y,f){var v=$(f),C=v.attr("type");return v.is("select")||C==="radio"||C==="checkbox"?g?v.addClass("readonly").attr("disabled","disabled"):v.removeClass("readonly").removeAttr("disabled"):g?v.addClass("readonly").attr("readonly","readonly"):v.removeClass("readonly").removeAttr("readonly"),!0}),u}c.setReadonly=a;function o(u,g){var y=Ce(u,E);y!=null?y.set_readOnly(g):u.element.is(":input")&&a(u.element,g)}c.setReadOnly=o;function l(u,g){var y=Ce(u,Ve);y!=null?y.set_required(g):u.element.is(":input")&&u.element.toggleClass("required",!!g);var f=u.element.closest(".field"),v=f.find("sup").get().length>0;g&&!v?$("<sup>*</sup>").attr("title",vo("Controls.PropertyGrid.RequiredHint")).prependTo(f.find(".caption")[0]):!g&&v&&$(f.find("sup")[0]).remove()}c.setRequired=l;function d(u,g){if(!g){if(!u.hasClass("readonly-container"))return;u.removeClass("readonly-container").find(".editor.container-readonly").removeClass("container-readonly").each((y,f)=>{var v=$(f).tryGetWidget(b);v!=null?c.setReadOnly(v,!1):c.setReadonly($(f),!1)});return}u.addClass("readonly-container").find(".editor").not(".container-readonly").each((y,f)=>{var v=$(f).tryGetWidget(b);if(v!=null){if(v.get_readOnly){if(v.get_readOnly())return}else if($(f).is("[readonly]")||$(f).is("[disabled]")||$(f).is(".readonly")||$(f).is(".disabled"))return;$(f).addClass("container-readonly"),c.setReadOnly(v,!0)}else{if($(f).is("[readonly]")||$(f).is("[disabled]")||$(f).is(".readonly")||$(f).is(".disabled"))return;c.setReadonly($(f).addClass("container-readonly"),!0)}})}c.setContainerReadOnly=d})(w||(w={}));var M=class extends b{constructor(e,t){var O;super(e,t);this.categoryLinkClick=e=>{e.preventDefault();var t=$("a[name="+e.target.getAttribute("href").toString().substr(1)+"]");t.closest(".category").hasClass("collapsed")&&t.closest(".category").children(".category-title").click();var i=function(){$.fn.fadeTo&&t.fadeTo(100,.5,function(){t.fadeTo(100,1,function(){})})},r=t.closest(".category");$.fn.scrollintoview?r.closest(":scrollable(both)").length===0?i():r.scrollintoview({duration:"fast",direction:"y",complete:i}):r&&r[0]&&r[0].scrollIntoView&&(r[0].scrollIntoView(),i())};this.idPrefix=this.options.idPrefix=(O=this.options.idPrefix)!=null?O:this.idPrefix,this.options.mode==null&&(this.options.mode=1),e.addClass("s-PropertyGrid"),this.editors=[];var i=this.options.items||[];this.items=[];var r=zs(i,function(T){return!Qe(T.tab)});if(r){var a=i.filter(T=>Qe(T.tab));a.length>0&&(this.createItems(this.element,a),$("<div class='pad'></div>").appendTo(this.element));for(var o=i.filter(T=>!Qe(T.tab)),l=$("<ul class='nav nav-tabs property-tabs' role='tablist'></ul>").appendTo(this.element),d=$("<div class='tab-content property-panes'></div>").appendTo(this.element),c=0,u=0;u<o.length;){var g={$:Ks(o[u].tab)},y=[],f=u;do y.push(o[f]);while(++f<o.length&&Ks(o[f].tab)===g.$);u=f;var v=$(ts()?'<li><a data-toggle="tab" role="tab"></a></li>':`<li class="nav-item"><a class="nav-link" data-${xo()?"bs-":""}toggle="tab" role="tab"></a></li>`).appendTo(l);c===0&&(ts()?v.addClass("active"):v.children("a").addClass("active"));var C=this.uniqueName+"_Tab"+c;v.children("a").attr("href","#"+C).text(this.determineText(g.$,function(T){return T+"Tabs."+this.tab.$}.bind({tab:g})));var S=$("<div class='tab-pane fade' role='tabpanel'>").appendTo(d);c===0&&S.addClass(ts()?"in active":"show active"),S.attr("id",C),this.createItems(S,y),c++}}else this.createItems(this.element,i);this.updateInterface()}destroy(){if(this.editors!=null){for(var e=0;e<this.editors.length;e++)this.editors[e].destroy();this.editors=null}this.element.find("a.category-link").unbind("click",this.categoryLinkClick).remove(),b.prototype.destroy.call(this)}createItems(e,t){var v,C;var i={},r=e,a=this.options.useCategories!==!1&&zs(t,function(S){return!Qe(S.category)});if(a){var o=$("<div/>").addClass("category-links");i=this.createCategoryLinks(o,t),Object.keys(i).length>1?o.appendTo(e):o.find("a.category-link").unbind("click",this.categoryLinkClick).remove()}r=$("<div/>").addClass("categories").appendTo(e);var l;a?l=r:l=$("<div/>").addClass("category").appendTo(r);for(var d=null,c=0;c<t.length;c++){var u=t[c],g=u.category;if(g==null&&(g=(v=this.options.defaultCategory)!=null?v:""),a&&d!==g){var y=this.createCategoryDiv(r,i,g,u.collapsible!==!0?null:(C=u.collapsed)!=null?C:!1);d==null&&y.addClass("first-category"),d=g,l=y}var f=this.createField(l,u);this.items.push(u),this.editors.push(f)}}createCategoryDiv(e,t,i,r){var a=$("<div/>").addClass("category").appendTo(e),o=$("<div/>").addClass("category-title").append($("<a/>").addClass("category-anchor").text(this.determineText(i,function(d){return d+"Categories."+i})).attr("name",this.idPrefix+"Category"+t[i].toString())).appendTo(a);if(r!=null){a.addClass(r===!0?"collapsible collapsed":"collapsible");var l=$("<i/>").addClass(r===!0?"fa fa-plus":"fa fa-minus").appendTo(o);o.click(function(d){a.toggleClass("collapsed"),l.toggleClass("fa-plus").toggleClass("fa-minus")})}return a}determineText(e,t){if(e!=null&&!js(e,"`")){var i=Xs(e);if(i!=null)return i}if(e!=null&&js(e,"`")&&(e=e.substr(1)),!Qe(this.options.localTextPrefix)){var r=Xs(t(this.options.localTextPrefix));if(r!=null)return r}return e}createField(e,t){var S,O;var i=$("<div/>").addClass("field").addClass(t.name).data("PropertyItem",t).appendTo(e);if(Qe(t.cssClass)||i.addClass(t.cssClass),!Qe(t.formCssClass)&&(i.addClass(t.formCssClass),t.formCssClass.indexOf("line-break-")>=0)){var r=t.formCssClass.split(String.fromCharCode(32));r.indexOf("line-break-xs")>=0?$("<div class='line-break' style='width: 100%' />").insertBefore(i):r.indexOf("line-break-sm")>=0?$("<div class='line-break hidden-xs' style='width: 100%' />").insertBefore(i):r.indexOf("line-break-md")>=0?$("<div class='line-break hidden-sm' style='width: 100%' />").insertBefore(i):r.indexOf("line-break-lg")>=0&&$("<div class='line-break hidden-md' style='width: 100%' />").insertBefore(i)}var a=this.idPrefix+t.name,o=this.determineText(t.title,function(T){return T+t.name}),l=this.determineText(t.hint,function(T){return T+t.name+"_Hint"}),d=this.determineText(t.placeholder,function(T){return T+t.name+"_Placeholder"});l==null&&(l=o!=null?o:"");var c=$("<label/>").addClass("caption").attr("for",a).attr("title",l).text(o!=null?o:"").appendTo(i);Qe(t.labelWidth)||(t.labelWidth==="0"?c.hide():c.css("width",t.labelWidth)),t.required===!0&&$("<sup>*</sup>").attr("title",Io("Controls.PropertyGrid.RequiredHint")).prependTo(c);var u=ht.get((S=t.editorType)!=null?S:"String"),g=b.elementFor(u).addClass("editor").attr("id",a).appendTo(i);g.is(":input")&&g.attr("name",(O=t.name)!=null?O:""),Qe(d)||g.attr("placeholder",d);var y=t.editorParams,f=null,v=Co(u,lt,!0);v!=null&&v.length>0&&(f=v[0].optionsType);var C;return f!=null?(y=Hs(new f,t.editorParams),C=new u(g,y)):(y=Hs(new Object,t.editorParams),C=new u(g,y)),C.initialize(),Us(C)=="BooleanEditor"&&(t.editorParams==null||!t.editorParams.labelFor)&&c.removeAttr("for"),Us(C)=="RadioButtonEditor"&&(t.editorParams==null||!t.editorParams.labelFor)&&c.removeAttr("for"),t.maxLength!=null&&M.setMaxLength(C,t.maxLength),t.editorParams!=null&&be.set(C,t.editorParams),$("<div/>").addClass("vx").appendTo(i),$("<div/>").addClass("clear").appendTo(i),C}getCategoryOrder(e){var u;var t=0,i={},r=Ys(this.options.categoryOrder);if(r!=null){var a=r.split(";");for(var o of a){var l=Ys(o);l!=null&&i[l]==null&&(i[l]=t++)}}for(var d of e){var c=d.category;c==null&&(c=(u=this.options.defaultCategory)!=null?u:""),i[c]==null&&(i[c]=t++)}return i}createCategoryLinks(e,t){var S;var i=0,r={},a={};for(var o of t){var l=o.name,d=o.category;d==null&&(d=(S=this.options.defaultCategory)!=null?S:""),a[l]=d,r[o.name]=i++}var c=this,u=this.getCategoryOrder(t);t.sort(function(O,T){var D=0,x=a[O.name],I=a[T.name];if(x!=I){var R=u[x],Y=u[I];R!=null&&Y!=null?D=R-Y:R!=null?D=-1:Y!=null&&(D=1)}return D===0&&(D=bo.stringCompare(x,I)),D===0&&(D=r[O.name]<r[T.name]?-1:r[O.name]>r[T.name]?1:0),D});for(var g={},y=0;y<t.length;y++){var f=t[y],v={$:a[f.name]};if(g[v.$]==null){var C=Object.keys(g).length+1;g[v.$]=C,C>1&&$("<span/>").addClass("separator").text("|").prependTo(e),$("<a/>").addClass("category-link").text(this.determineText(v.$,function(O){return O+"Categories."+this.category.$}.bind({category:v}))).attr("tabindex","-1").attr("href","#"+this.idPrefix+"Category"+C.toString()).click(this.categoryLinkClick).prependTo(e)}}return $("<div/>").addClass("clear").appendTo(e),g}get_editors(){return this.editors}get_items(){return this.items}get_idPrefix(){return this.idPrefix}get_mode(){return this.options.mode}set_mode(e){this.options.mode!==e&&(this.options.mode=e,this.updateInterface())}static loadEditorValue(e,t,i){}static saveEditorValue(e,t,i){w.saveValue(e,t,i)}static setReadOnly(e,t){w.setReadOnly(e,t)}static setReadonly(e,t){return w.setReadonly(e,t)}static setRequired(e,t){w.setRequired(e,t)}static setMaxLength(e,t){e.element.is(":input")&&(t>0?e.element.attr("maxlength",t):e.element.removeAttr("maxlength"))}load(e){for(var t=0;t<this.editors.length;t++){var i=this.items[t],r=this.editors[t];this.get_mode()===1&&i.defaultValue!=null&&typeof e[i.name]=="undefined"&&(e[i.name]=i.defaultValue),w.loadValue(r,i,e)}}save(e){e==null&&(e=Object.create(null));for(var t=0;t<this.editors.length;t++){var i=this.items[t];if(i.oneWay!==!0&&this.canModifyItem(i)){var r=this.editors[t];w.saveValue(r,i,e)}}return e}get value(){return this.save()}set value(e){e==null&&(e=Object.create(null)),this.load(e)}canModifyItem(e){return this.get_mode()===ti.insert?e.insertable===!1?!1:e.insertPermission==null?!0:es.hasPermission(e.insertPermission):this.get_mode()===ti.update?e.updatable===!1?!1:e.updatePermission==null?!0:es.hasPermission(e.updatePermission):!0}updateInterface(){for(var e=0;e<this.editors.length;e++){var t=this.items[e],i=this.editors[e],r=t.readOnly===!0||!this.canModifyItem(t);if(w.setReadOnly(i,r),w.setRequired(i,!r&&!!t.required&&t.editorType!=="Boolean"),t.visible===!1||t.readPermission!=null||t.insertPermission!=null||t.updatePermission!=null||t.hideOnInsert===!0||t.hideOnUpdate===!0){var a=t.readPermission!=null&&!es.hasPermission(t.readPermission)||t.visible===!1||this.get_mode()===ti.insert&&t.hideOnInsert===!0||this.get_mode()===2&&t.hideOnUpdate===!0;i.getGridField().toggle(!a)}}}enumerateItems(e){for(var t=0;t<this.editors.length;t++){var i=this.items[t],r=this.editors[t];e(i,r)}}};M=h([m.registerClass("Serenity.PropertyGrid")],M);var ti=(e=>(e[e.insert=1]="insert",e[e.update=2]="update",e))(ti||{});import{endsWith as Zs,getAttributes as So,getForm as To,getInstanceType as en,getTypeFullName as ko}from"@serenity-is/corelib/q";var Li=class extends wt{constructor(e,t){super(e,t);this.initPropertyGrid(),this.loadInitialEntity()}destroy(){this.propertyGrid&&(this.propertyGrid.destroy(),this.propertyGrid=null),this.validator&&(this.byId("Form").remove(),this.validator=null),super.destroy()}initPropertyGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.propertyGrid=new M(e,t).init(null),this.element.closest(".ui-Panel").hasClass("s-Flexify")&&this.propertyGrid.element.children(".categories").flexHeightOnly(1)}}loadInitialEntity(){this.propertyGrid&&this.propertyGrid.load(new Object)}getFormKey(){var e=So(en(this),fe,!0);if(e.length>=1)return e[0].value;var t=ko(en(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),Zs(t,"Panel")?t=t.substr(0,t.length-6):Zs(t,"Panel")&&(t=t.substr(0,t.length-5)),t}getPropertyGridOptions(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,useCategories:!1,localTextPrefix:"Forms."+this.getFormKey()+"."}}getPropertyItems(){var e=this.getFormKey();return To(e)}getSaveEntity(){var e=new Object;return this.propertyGrid&&this.propertyGrid.save(e),e}get_entity(){return this._entity}get_entityId(){return this._entityId}set_entity(e){this._entity=e!=null?e:new Object}set_entityId(e){this._entityId=e}validateBeforeSave(){return this.validator.form()}};Li=h([m.registerClass("Serenity.PropertyPanel")],Li);var xe;(a=>{function p(o,l,d,c){var u=l.widgetName;return o.element.bind("ondatachange."+u,function(g,y){c?window.setTimeout(function(){d(g,y)},0):d(g,y)}).bind("remove."+u,function(){o.element.unbind("ondatachange."+u)}),o}a.bindToDataChange=p;function n(o){return o.element.triggerHandler("ondatachange"),o}a.triggerDataChange=n;function e(o){return o.triggerHandler("ondatachange"),o}a.triggerDataChanged=e;function t(o,l,d){return p(o,l,function(c,u){l.element.triggerHandler("ondatachange")},d)}a.bubbleDataChange=t;function i(o,l){return o.element.one("dialogopen",function(d){o.element.dialog().dialog("option","position",r(l))}),o}a.cascade=i;function r(o){return{my:"left top",at:"left+20 top+20",of:o[0]}}a.cascadedDialogOffset=r})(xe||(xe={}));import{endsWith as tn,getAttributes as Oo,getFormData as wo,getFormDataAsync as Do,getInstanceType as rn,getTypeFullName as Fo,isEmptyOrNull as sn,ScriptData as Po,localText as nn}from"@serenity-is/corelib/q";var gt=class extends V{constructor(e){super(e);this.useAsync()?this.initAsync():this.initSync()}internalInit(){this.initPropertyGrid(),this.loadInitialEntity()}initSync(){this.propertyItemsData=this.getPropertyItemsData(),this.internalInit(),this.afterInit()}initAsync(){return De(this,null,function*(){this.propertyItemsData=yield this.getPropertyItemsDataAsync(),this.internalInit(),this.afterInit()})}afterInit(){}useAsync(){return!1}destroy(){this.propertyGrid&&(this.propertyGrid.destroy(),this.propertyGrid=null),this.validator&&(this.byId("Form").remove(),this.validator=null),super.destroy()}getDialogOptions(){var e=super.getDialogOptions();return e.width=400,e}getDialogButtons(){return super.getDialogButtons(),[{text:nn("Dialogs.OkButton"),cssClass:"btn btn-primary",click:()=>this.okClick()},{text:nn("Dialogs.CancelButton"),click:()=>this.cancelClick()}]}okClick(){this.validateBeforeSave()&&this.okClickValidated()}okClickValidated(){this.dialogClose()}cancelClick(){this.dialogClose()}initPropertyGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.propertyGrid=new M(e,t).init(null),this.element.closest(".ui-dialog").hasClass("s-Flexify")&&this.propertyGrid.element.children(".categories").flexHeightOnly(1)}}getFormKey(){var e=Oo(rn(this),fe,!0);if(e.length>=1)return e[0].value;var t=Fo(rn(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),tn(t,"Dialog")?t=t.substr(0,t.length-6):tn(t,"Panel")&&(t=t.substr(0,t.length-5)),t}getPropertyGridOptions(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,useCategories:!1,localTextPrefix:"Forms."+this.getFormKey()+"."}}getPropertyItems(){var e;return((e=this.propertyItemsData)==null?void 0:e.items)||[]}getPropertyItemsData(){var e=this.getFormKey();return this.getFormKey===gt.prototype.getFormKey&&this.getPropertyItems!==gt.prototype.getPropertyItems&&!Po.canLoad("Form."+e)?{items:this.getPropertyItems(),additionalItems:[]}:sn(e)?{items:[],additionalItems:[]}:wo(e)}getPropertyItemsDataAsync(){return De(this,null,function*(){var e=this.getFormKey();return sn(e)?{items:[],additionalItems:[]}:yield Do(e)})}getSaveEntity(){var e=new Object;return this.propertyGrid&&this.propertyGrid.save(e),e}loadInitialEntity(){this.propertyGrid&&this.propertyGrid.load(new Object)}get_entity(){return this.entity}set_entity(e){this.entity=e!=null?e:new Object}get_entityId(){return this.entityId}set_entityId(e){this.entityId=e}validateBeforeSave(){return this.validator.form()}updateTitle(){}getFallbackTemplate(){return`<div>
    <div class="s-Form">
        <form id="~_Form" action="">
            <div class="fieldset">
                <div id="~_PropertyGrid"></div>
                <div class="clear"></div>
            </div>
        </form> 
    </div>
</div>`}};gt=h([m.registerClass("Serenity.PropertyDialog")],gt);var se=class extends b{constructor(n){super(n)}get value(){return this.element.val()}get_value(){return this.value}set value(n){this.element.val(n)}set_value(n){this.value=n}};se=h([m.registerEditor("Serenity.StringEditor",[P]),m.element('<input type="text"/>')],se);var Gi=class extends se{constructor(n){super(n),n.attr("type","password")}};Gi=h([m.registerEditor("Serenity.PasswordEditor")],Gi);var Ai=class extends b{constructor(n,e){var t,i;super(n,e),this.options.cols!==0&&n.attr("cols",(t=this.options.cols)!=null?t:80),this.options.rows!==0&&n.attr("rows",(i=this.options.rows)!=null?i:6)}get value(){return this.element.val()}get_value(){return this.value}set value(n){this.element.val(n)}set_value(n){this.value=n}};Ai=h([m.registerEditor("Serenity.TextAreaEditor",[P]),m.element("<textarea />")],Ai);var Wi=class extends b{get value(){return this.element.is(":checked")}get_value(){return this.value}set value(n){this.element.prop("checked",!!n)}set_value(n){this.value=n}};Wi=h([m.registerEditor("Serenity.BooleanEditor",[_e]),m.element('<input type="checkbox"/>')],Wi);import{Culture as is,extend as Eo,formatNumber as _o,parseDecimal as Ro}from"@serenity-is/corelib/q";var Ie=class extends b{constructor(n,e){var i,r;super(n,e),n.addClass("decimalQ");var t=Eo(Ie.defaultAutoNumericOptions(),{vMin:(i=this.options.minValue)!=null?i:this.options.allowNegatives?this.options.maxValue!=null?"-"+this.options.maxValue:"-999999999999.99":"0.00",vMax:(r=this.options.maxValue)!=null?r:"999999999999.99"});this.options.decimals!=null&&(t.mDec=this.options.decimals),this.options.padDecimals!=null&&(t.aPad=this.options.padDecimals),$.fn.autoNumeric&&n.autoNumeric(t)}get_value(){if($.fn.autoNumeric){var n=this.element.autoNumeric("get");return n==null||n===""?null:parseFloat(n)}var n=this.element.val();return Ro(n)}get value(){return this.get_value()}set_value(n){n==null||n===""?this.element.val(""):$.fn.autoNumeric?this.element.autoNumeric("set",n):this.element.val(_o(n))}set value(n){this.set_value(n)}get_isValid(){return!isNaN(this.get_value())}static defaultAutoNumericOptions(){return{aDec:is.decimalSeparator,altDec:is.decimalSeparator==="."?",":".",aSep:is.decimalSeparator==="."?",":".",aPad:!0}}};Ie=h([m.registerEditor("Serenity.DecimalEditor",[Z]),m.element('<input type="text"/>')],Ie);import{extend as Vo,formatNumber as Qo,isTrimmedEmpty as Bo,parseInteger as No,trimToNull as Lo}from"@serenity-is/corelib/q";var Ft=class extends b{constructor(n,e){var i,r;super(n,e),n.addClass("integerQ");var t=Vo(Ie.defaultAutoNumericOptions(),{vMin:((i=this.options.minValue)!=null?i:this.options.allowNegatives)?this.options.maxValue!=null?"-"+this.options.maxValue:"-2147483647":"0",vMax:(r=this.options.maxValue)!=null?r:2147483647,aSep:null});$.fn.autoNumeric&&n.autoNumeric(t)}get_value(){if($.fn.autoNumeric){var n=this.element.autoNumeric("get");return Bo(n)?null:parseInt(n,10)}else{var n=Lo(this.element.val());return n==null?null:No(n)}}get value(){return this.get_value()}set_value(n){n==null||n===""?this.element.val(""):$.fn.autoNumeric?this.element.autoNumeric("set",n):this.element.val(Qo(n))}set value(n){this.set_value(n)}get_isValid(){return!isNaN(this.get_value())}};Ft=h([m.registerEditor("Serenity.IntegerEditor",[Z]),m.element('<input type="text"/>')],Ft);import{addValidationRule as Go,Culture as _,format as an,formatDate as ee,Invariant as on,isEmptyOrNull as Ji,parseDate as ln,parseISODateTime as rs,replaceAll as Ao,localText as dn,today as ss}from"@serenity-is/corelib/q";var pn='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 17 17"><g></g><path d="M14 2v-1h-3v1h-5v-1h-3v1h-3v15h17v-15h-3zM12 2h1v2h-1v-2zM4 2h1v2h-1v-2zM16 16h-15v-8.921h15v8.921zM1 6.079v-3.079h2v2h3v-2h5v2h3v-2h2v3.079h-15z" fill="currentColor"></path></svg>',Q=class extends b{constructor(e){var t;super(e);typeof flatpickr!="undefined"&&(Q.useFlatpickr||!$.fn.datepicker)?flatpickr(e[0],Q.flatPickrOptions(e)):$.fn.datepicker?e.datepicker({showOn:"button",beforeShow:(i,r)=>!e.hasClass("readonly"),yearRange:(t=this.yearRange)!=null?t:"-100:+50"}):e.attr("type","date"),e.on("keyup."+this.uniqueName,i=>{i.which===32&&!this.get_readOnly()?this.get_valueAsDate()!=ss()&&(this.set_valueAsDate(ss()),this.element.trigger("change")):Q.dateInputKeyup(i)}),e.on("change."+this.uniqueName,Q.dateInputChange),Go(e,this.uniqueName,i=>{var r=this.get_value();return Ji(r)?null:!Ji(this.get_minValue())&&on.stringCompare(ee(r,"yyyy-MM-dd"),ee(this.get_minValue(),"yyyy-MM-dd"))<0?an(dn("Validation.MinDate"),ee(this.get_minValue(),null)):!Ji(this.get_maxValue())&&on.stringCompare(ee(r,"yyyy-MM-dd"),ee(this.get_maxValue(),"yyyy-MM-dd"))>0?an(dn("Validation.MaxDate"),ee(this.get_maxValue(),null)):null}),this.set_sqlMinMax(!0)}static flatPickrOptions(e){return{clickOpens:!0,allowInput:!0,dateFormat:_.dateOrder.split("").join(_.dateSeparator).replace("y","Y"),onChange:function(){e.triggerHandler("change")}}}get_value(){var e=this.element.val().trim();return e!=null&&e.length===0?null:ee(e,"yyyy-MM-dd")}get value(){return this.get_value()}set_value(e){e==null?this.element.val(""):e.toLowerCase()==="today"||e.toLowerCase()==="now"?this.element.val(ee(ss(),null)):this.element.val(ee(e,null))}set value(e){this.set_value(e)}get_valueAsDate(){return Ji(this.get_value())?null:rs(this.get_value())}get valueAsDate(){return this.get_valueAsDate()}set_valueAsDate(e){e==null&&this.set_value(null),this.set_value(ee(e,"yyyy-MM-dd"))}set valueAsDate(e){this.set_valueAsDate(e)}get_readOnly(){return this.element.hasClass("readonly")}set_readOnly(e){e!==this.get_readOnly()&&(e?(this.element.addClass("readonly").attr("readonly","readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1")):(this.element.removeClass("readonly").removeAttr("readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","1")))}get_minValue(){return this.minValue}set_minValue(e){this.minValue=e}get_maxValue(){return this.maxValue}set_maxValue(e){this.maxValue=e}get_minDate(){return rs(this.get_minValue())}set_minDate(e){this.set_minValue(ee(e,"yyyy-MM-dd"))}get_maxDate(){return rs(this.get_maxValue())}set_maxDate(e){this.set_maxValue(ee(e,"yyyy-MM-dd"))}get_sqlMinMax(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"}set_sqlMinMax(e){e?(this.set_minValue("1753-01-01"),this.set_maxValue("9999-12-31")):(this.set_minValue(null),this.set_maxValue(null))}static flatPickrTrigger(e){return $('<i class="ui-datepicker-trigger" href="javascript:;">'+pn+"</i>").insertAfter(e).click(()=>{e.hasClass("readonly")||e[0]._flatpickr.open()})}static dateInputKeyup(e){var a;if(_.dateOrder!=="dmy")return;var t=$(e.target);if(!t.is(":input")||t.attr("type")=="date"||t.is("[readonly]")||t.is(":disabled"))return;var i=(a=t.val())!=null?a:"";if(i.length===0||t[0].selectionEnd!==i.length)return;if(i.indexOf(_.dateSeparator+_.dateSeparator)!==-1){t.val(Ao(i,_.dateSeparator+_.dateSeparator,_.dateSeparator));return}function r(o){return o>=48&&o<=57}if(e.which===47||e.which===111){if(i.length>=2&&i.charAt(i.length-1)===_.dateSeparator&&i.charAt(i.length-2)===_.dateSeparator){t.val(i.substr(0,i.length-1));return}if(i.charAt(i.length-1)!==_.dateSeparator)return;switch(i.length){case 2:if(r(i.charCodeAt(0))){i="0"+i;break}else return;case 4:if(r(i.charCodeAt(0))&&r(i.charCodeAt(2))&&i.charAt(1)==_.dateSeparator){i="0"+i.charAt(0)+_.dateSeparator+"0"+i.charAt(2)+_.dateSeparator;break}else return;case 5:if(r(i.charCodeAt(0))&&r(i.charCodeAt(2))&&r(i.charCodeAt(3))&&i.charAt(1)===_.dateSeparator){i="0"+i;break}else if(r(i.charCodeAt(0))&&r(i.charCodeAt(1))&&r(i.charCodeAt(3))&&i.charAt(2)===_.dateSeparator){i=i.charAt(0)+i.charAt(1)+_.dateSeparator+"0"+i.charAt(3)+_.dateSeparator;break}else break;default:return}t.val(i)}if(i.length<6&&(e.which>=48&&e.which<=57||e.which>=96&&e.which<=105)&&r(i.charCodeAt(i.length-1))){switch(i.length){case 1:{if(i.charCodeAt(0)<=51)return;i="0"+i;break}case 2:{if(!r(i.charCodeAt(0)))return;break}case 3:{if(!r(i.charCodeAt(0))||i.charAt(1)!==_.dateSeparator||i.charCodeAt(2)<=49)return;i="0"+i.charAt(0)+_.dateSeparator+"0"+i.charAt(2);break}case 4:if(i.charAt(1)==_.dateSeparator){if(!r(i.charCodeAt(0))||!r(i.charCodeAt(2)))return;i="0"+i;break}else if(i.charAt(2)==_.dateSeparator){if(!r(i.charCodeAt(0))||!r(i.charCodeAt(1))||i.charCodeAt(3)<=49)return;i=i.charAt(0)+i.charAt(1)+_.dateSeparator+"0"+i.charAt(3);break}else return;case 5:{if(i.charAt(2)!==_.dateSeparator||!r(i.charCodeAt(0))||!r(i.charCodeAt(1))||!r(i.charCodeAt(3)))return;break}default:return}t.val(i+_.dateSeparator)}}};Q.dateInputChange=function(e){var o,l;if(_.dateOrder==="dmy"){var t=$(e.target);if(!(!t.is(":input")||t.attr("type")=="date")){var i=(o=t.val())!=null?o:"",r={};if(i.length>=6&&/^[0-9]*$/g.test(i)&&t.val(i.substr(0,2)+_.dateSeparator+i.substr(2,2)+_.dateSeparator+i.substr(4)),i=(l=t.val())!=null?l:"",i.length>=5&&ln(i)!==!1){var a=ln(i);t.val(ee(a,null))}}}},h([m.option()],Q.prototype,"yearRange",2),h([m.option()],Q.prototype,"get_minValue",1),h([m.option()],Q.prototype,"get_maxValue",1),h([m.option()],Q.prototype,"get_maxDate",1),h([m.option()],Q.prototype,"get_sqlMinMax",1),Q=h([m.registerEditor("Serenity.DateEditor",[P,E]),m.element('<input type="text"/>')],Q);function un(){if(!$.datepicker||!$.datepicker.regional||!$.datepicker.regional.en)return!1;let p=_.dateOrder,n=_.dateSeparator,e=($("html").attr("lang")||"en").toLowerCase();return $.datepicker.regional[e]||(e=e.split("-")[0],$.datepicker.regional[e]||(e="en")),$.datepicker.setDefaults($.datepicker.regional.en),$.datepicker.setDefaults($.datepicker.regional[e]),$.datepicker.setDefaults({dateFormat:p=="mdy"?"mm"+n+"dd"+n+"yy":p=="ymd"?"yy"+n+"mm"+n+"dd":"dd"+n+"mm"+n+"yy",buttonImage:"data:image/svg+xml,"+encodeURIComponent(pn),buttonImageOnly:!0,showOn:"both",showButtonPanel:!0,changeMonth:!0,changeYear:!0}),$.ui&&$.ui.version<="1.12.1"&&$.datepicker.setDefaults({buttonImage:null,buttonImageOnly:!1,buttonText:'<i class="fa fa-calendar"></i>'}),!0}typeof $!="undefined"&&$.fn&&!un()&&$(un);import{addOption as Wo,addValidationRule as Jo,Culture as qi,format as cn,formatDate as ue,formatISODateTimeUTC as qo,Invariant as hn,isEmptyOrNull as Pt,parseDate as Mo,parseISODateTime as ii,round as $o,localText as mn,today as zo,trunc as Ho,tryGetText as Uo}from"@serenity-is/corelib/q";var G=class extends b{constructor(e,t){var o,l,d,c;super(e,t);if(e.addClass("s-DateTimeEditor"),this.options.inputOnly)e.addClass("dateTimeQ");else if(typeof flatpickr!="undefined"&&(Q.useFlatpickr||!$.fn.datepicker||this.options.seconds))e.addClass("dateTimeQ"),flatpickr(e[0],this.getFlatpickrOptions());else if($.fn.datepicker){e.addClass("dateQ"),e.datepicker({showOn:"button",beforeShow:function(){return!e.hasClass("readonly")},yearRange:(o=this.options.yearRange)!=null?o:"-100:+50"}),e.bind("change."+this.uniqueName,u=>{this.lastSetValue=null,Q.dateInputChange(u)}),this.time=$("<select/>").addClass("editor s-DateTimeEditor time");var i=e.next(".ui-datepicker-trigger");i.length>0?this.time.insertAfter(i):(i=e.prev(".ui-datepicker-trigger"),i.length>0?this.time.insertBefore(i):this.time.insertAfter(e)),this.time.on("change",function(u){this.lastSetValue=null,e.triggerHandler("change")});var r=G.getTimeOptions((l=this.options.startHour)!=null?l:0,0,(d=this.options.endHour)!=null?d:23,59,(c=this.options.intervalMinutes)!=null?c:5);for(var a of r)Wo(this.time,a,a);Jo(e,this.uniqueName,u=>{var g=this.get_value();return Pt(g)?null:!Pt(this.get_minValue())&&hn.stringCompare(g,this.get_minValue())<0?cn(mn("Validation.MinDate"),ue(this.get_minValue(),null)):!Pt(this.get_maxValue())&&hn.stringCompare(g,this.get_maxValue())>0?cn(mn("Validation.MaxDate"),ue(this.get_maxValue(),null)):null})}else e.attr("type","datetime").addClass("dateTimeQ");e.bind("keyup."+this.uniqueName,u=>{if(!this.get_readOnly()&&this.time)if(u.which===32)this.get_valueAsDate()!==new Date&&(this.set_valueAsDate(new Date),this.element.trigger("change"));else{var g=this.element.val();Q.dateInputKeyup(u),g!=this.element.val()&&(this.lastSetValue=null)}}),this.set_sqlMinMax(!0),this.options.inputOnly||$("<i class='inplace-button inplace-now'><b></b></div>").attr("title",this.getInplaceNowText()).insertAfter(this.time).click(u=>{this.element.hasClass("readonly")||(this.lastSetValue=null,this.set_valueAsDate(new Date),e.triggerHandler("change"))})}getFlatpickrOptions(){var e;return{clickOpens:!0,allowInput:!0,enableTime:!0,time_24hr:!0,enableSeconds:!!this.options.seconds,minuteIncrement:(e=this.options.intervalMinutes)!=null?e:5,dateFormat:qi.dateOrder.split("").join(qi.dateSeparator).replace("y","Y")+" H:i"+(this.options.seconds?":S":""),onChange:()=>{this.lastSetValue=null,this.element&&this.element.triggerHandler("change")}}}get_value(){var e=this.element.val().trim();if(e!=null&&e.length===0)return null;var t;if(this.time){var i=ue(e,"yyyy-MM-dd"),r=this.time.val();t=i+"T"+r+":00.000"}else t=ue(Mo(this.element.val()),"yyyy-MM-ddTHH:mm:ss.fff");return this.options.useUtc&&(t=qo(ii(t))),this.lastSetValue!=null&&this.lastSetValueGet==t?this.lastSetValue:t}get value(){return this.get_value()}set_value(e){var i;if(Pt(e))this.element.val(""),this.time&&this.time.val("00:00");else if(e.toLowerCase()==="today")this.time?(this.element.val(ue(zo(),null)),this.time.val("00:00")):this.element.val(this.getDisplayFormat());else{var t=e.toLowerCase()==="now"?new Date:ii(e);this.time?(t=G.roundToMinutes(t,(i=this.options.intervalMinutes)!=null?i:5),this.element.val(ue(t,null)),this.time.val(ue(t,"HH:mm"))):this.element.val(ue(t,this.getDisplayFormat()))}this.lastSetValue=null,!Pt(e)&&e.toLowerCase()!="today"&&e.toLowerCase()!="now"&&(this.lastSetValueGet=this.get_value(),this.lastSetValue=e)}getInplaceNowText(){var e;return(e=Uo("Controls.DateTimeEditor.SetToNow"))!=null?e:"set to now"}getDisplayFormat(){return this.options.seconds?qi.dateTimeFormat:qi.dateTimeFormat.replace(":ss","")}set value(e){this.set_value(e)}get_valueAsDate(){return Pt(this.get_value())?null:ii(this.get_value())}get valueAsDate(){return this.get_valueAsDate()}set_valueAsDate(e){e==null&&this.set_value(null),this.set_value(ue(e,"yyyy-MM-ddTHH:mm"+(this.options.seconds?":ss":"")))}set valueAsDate(e){this.set_valueAsDate(e)}get_minValue(){return this.minValue}set_minValue(e){this.minValue=e}get_maxValue(){return this.maxValue}set_maxValue(e){this.maxValue=e}get_minDate(){return ii(this.get_minValue())}set_minDate(e){this.set_minValue(ue(e,"yyyy-MM-ddTHH:mm:ss"))}get_maxDate(){return ii(this.get_maxValue())}set_maxDate(e){this.set_maxValue(ue(e,"yyyy-MM-ddTHH:mm:ss"))}get_sqlMinMax(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"}set_sqlMinMax(e){e?(this.set_minValue("1753-01-01"),this.set_maxValue("9999-12-31")):(this.set_minValue(null),this.set_maxValue(null))}get_readOnly(){return this.element.hasClass("readonly")}set_readOnly(e){e!==this.get_readOnly()&&(e?(this.element.addClass("readonly").attr("readonly","readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1"),this.element.nextAll(".inplace-now").css("opacity","0.1")):(this.element.removeClass("readonly").removeAttr("readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","1"),this.element.nextAll(".inplace-now").css("opacity","1")),this.time&&w.setReadonly(this.time,e))}static roundToMinutes(e,t){e=new Date(e.getTime());var i=Ho($o(e.getMinutes()/t)*t);return e.setMinutes(i),e.setSeconds(0),e.setMilliseconds(0),e}};G.getTimeOptions=function(e,t,i,r,a){var o=[];i>=23&&(i=23),r>=60&&(r=59);for(var l=e,d=t;!(l>i||l===i&&d>r);){var c=(l>=10?"":"0")+l+":"+(d>=10?"":"0")+d;o.push(c),d+=a,d>=60&&(d-=60,l++)}return o},h([m.option()],G.prototype,"get_minValue",1),h([m.option()],G.prototype,"get_maxValue",1),h([m.option()],G.prototype,"get_maxDate",1),h([m.option()],G.prototype,"get_sqlMinMax",1),G=h([m.registerEditor("Serenity.DateTimeEditor",[P,E]),m.element('<input type="text"/>')],G);import{addOption as ns,toId as gn}from"@serenity-is/corelib/q";var Mi=class extends b{constructor(e,t){super(e,t);e.addClass("editor s-TimeEditor hour"),this.options.noEmptyOption||ns(e,"","--");for(var i=this.options.startHour||0;i<=(this.options.endHour||23);i++)ns(e,i.toString(),i<10?"0"+i:i.toString());this.minutes=$("<select/>").addClass("editor s-TimeEditor minute").insertAfter(e),this.minutes.change(()=>this.element.trigger("change"));for(var r=0;r<=59;r+=this.options.intervalMinutes||5)ns(this.minutes,r.toString(),r<10?"0"+r:r.toString())}get value(){var e=gn(this.element.val()),t=gn(this.minutes.val());return e==null||t==null?null:e*60+t}get_value(){return this.value}set value(e){e?(this.element.val(Math.floor(e/60).toString()),this.minutes.val(e%60)):this.options.noEmptyOption?(this.element.val(this.options.startHour),this.minutes.val("0")):(this.element.val(""),this.minutes.val("0"))}set_value(e){this.value=e}get_readOnly(){return this.element.hasClass("readonly")}set_readOnly(e){e!==this.get_readOnly()&&(e?this.element.addClass("readonly").attr("readonly","readonly"):this.element.removeClass("readonly").removeAttr("readonly"),w.setReadonly(this.minutes,e))}};Mi=h([m.registerEditor("Serenity.TimeEditor",[Z,E]),m.element("<select />")],Mi);import{isEmptyOrNull as $i,trimToNull as jo,tryGetText as Ko}from"@serenity-is/corelib/q";var Et=class extends b{constructor(n,e){super(n,e),Et.registerValidationMethods(),n.addClass("emailuser");var t=$("<span/>").text("@").addClass("emailat").insertAfter(n),i=$('<input type="text"/>').addClass("emaildomain").insertAfter(t);i.bind("blur."+this.uniqueName,function(){var r=i.closest("form").data("validator");r!=null&&r.element(n[0])}),$i(this.options.domain)||i.val(this.options.domain),this.options.readOnlyDomain&&i.attr("readonly","readonly").addClass("disabled").attr("tabindex","-1"),n.bind("keypress."+this.uniqueName,r=>{r.which===64&&(r.preventDefault(),this.options.readOnlyDomain||(i.focus(),i.select()))}),i.bind("keypress."+this.uniqueName,function(r){r.which===64&&r.preventDefault()}),this.options.readOnlyDomain||n.change(r=>this.set_value(n.val()))}static registerValidationMethods(){var n;!$.validator||!$.validator.methods||$.validator.methods.emailuser!=null||$.validator.addMethod("emailuser",function(e,t){var i=$(t).nextAll(".emaildomain");return i.length>0&&i.attr("readonly")==null?this.optional(t)&&this.optional(i[0])?!0:$.validator.methods.email.call(this,e+"@"+i.val(),t):$.validator.methods.email.call(this,e+"@dummy.com",t)},(n=Ko("Validation.Email"))!=null?n:$.validator.messages.email)}get_value(){var n=this.element.nextAll(".emaildomain"),e=this.element.val(),t=n.val();return $i(e)?this.options.readOnlyDomain||$i(t)?"":"@"+t:e+"@"+t}get value(){return this.get_value()}set_value(n){var e=this.element.nextAll(".emaildomain");if(n=jo(n),n==null)this.options.readOnlyDomain||e.val(""),this.element.val("");else{var t=n.split("@");t.length>1?this.options.readOnlyDomain?$i(this.options.domain)?this.element.val(t[0]):t[1]!==this.options.domain?this.element.val(n):this.element.val(t[0]):(e.val(t[1]),this.element.val(t[0])):this.element.val(t[0])}}set value(n){this.set_value(n)}get_readOnly(){var n=this.element.nextAll(".emaildomain");return!(this.element.attr("readonly")==null&&(!this.options.readOnlyDomain||n.attr("readonly")==null))}set_readOnly(n){var e=this.element.nextAll(".emaildomain");n?(this.element.attr("readonly","readonly").addClass("readonly"),this.options.readOnlyDomain||e.attr("readonly","readonly").addClass("readonly")):(this.element.removeAttr("readonly").removeClass("readonly"),this.options.readOnlyDomain||e.removeAttr("readonly").removeClass("readonly"))}};Et=h([m.registerEditor("Serenity.EmailEditor",[P,E]),m.element('<input type="text"/>')],Et);var zi=class extends se{constructor(n){super(n),n.attr("type","email").addClass("email")}};zi=h([m.registerEditor("Serenity.EmailAddressEditor")],zi);import{trimToNull as Yo}from"@serenity-is/corelib/q";var Hi=class extends se{constructor(n){super(n),n.addClass("url").attr("title","URL should be entered in format: 'http://www.site.com/page'."),n.on("blur."+this.uniqueName,e=>{var t=n.closest("form").data("validator");if(t!=null&&n.hasClass("error")){var i=Yo(n.val());i&&(i="http://"+i,$.validator.methods.url.call(t,i,n[0])==!0&&(n.val(i),t.element(n)))}})}};Hi=h([m.registerEditor("Serenity.URLEditor",[P])],Hi);import{Enum as fn,getAttributes as Xo,getLookup as Zo,isEmptyOrNull as Ui,tryGetText as el}from"@serenity-is/corelib/q";var ji=class extends b{constructor(n,e){var v;if(super(n,e),!(Ui(this.options.enumKey)&&this.options.enumType==null&&Ui(this.options.lookupKey)))if(Ui(this.options.lookupKey)){var d=this.options.enumType||ze.get(this.options.enumKey),c=this.options.enumKey;if(c==null&&d!=null){var u=Xo(d,U,!1);u.length>0&&(c=u[0].value)}var g=fn.getValues(d);for(var y of g){var f=fn.toString(d,y);this.addRadio(y.toString(),(v=el("Enums."+c+"."+f))!=null?v:f)}}else{var t=Zo(this.options.lookupKey);for(var i of t.items){var r=i[t.textField],a=r==null?"":r.toString(),o=i[t.idField],l=o==null?"":o.toString();this.addRadio(l,a)}}}addRadio(n,e){var t=$("<label/>").text(e);$('<input type="radio"/>').attr("name",this.uniqueName).attr("id",this.uniqueName+"_"+n).attr("value",n).prependTo(t),t.appendTo(this.element)}get_value(){return this.element.find("input:checked").first().val()}get value(){return this.get_value()}set_value(n){if(n!==this.get_value()){var e=this.element.find("input"),t=e.filter(":checked");t.length>0&&(t[0].checked=!1),Ui(n)||(t=e.filter("[value="+n+"]"),t.length>0&&(t[0].checked=!0))}}set value(n){this.set_value(n)}get_readOnly(){return this.element.attr("disabled")!=null}set_readOnly(n){this.get_readOnly()!==n&&(n?this.element.attr("disabled","disabled").find("input").attr("disabled","disabled"):this.element.removeAttr("disabled").find("input").removeAttr("disabled"))}};ji=h([m.registerEditor("Serenity.RadioButtonEditor",[P,E]),m.element("<div/>")],ji);import{any as as,Authorization as tl,isArray as os,isEmptyOrNull as Se,isTrimmedEmpty as il,startsWith as rl,localText as _t,trimToEmpty as sl,trimToNull as yn}from"@serenity-is/corelib/q";var L=class extends b{constructor(e,t){super(e,t);this._items=[],this._itemById={};var i=this.emptyItemText();i!=null&&e.attr("placeholder",i);var r=this.getSelect2Options();e.select2(r),e.attr("type","text"),e.on("change."+this.uniqueName,(a,o)=>{o!==!0&&e.closest("form").data("validator")&&e.valid()}),this.setCascadeFrom(this.options.cascadeFrom),this.useInplaceAdd()&&this.addInplaceCreate(_t("Controls.SelectEditor.InplaceAdd"),null)}destroy(){this.element!=null&&this.element.select2("destroy"),super.destroy()}hasAsyncSource(){return!1}asyncSearch(e,t){return t({items:[],more:!1}),null}getTypeDelay(){var e;return(e=this.options.typeDelay)!=null?e:200}emptyItemText(){var e;return(e=this.element.attr("placeholder"))!=null?e:_t("Controls.SelectEditor.EmptyItemText")}getPageSize(){var e;return(e=this.options.pageSize)!=null?e:100}getIdField(){return this.options.idField}itemId(e){var t=e[this.getIdField()];return t==null?"":t.toString()}getTextField(){var e;return(e=this.options.textField)!=null?e:this.getIdField()}itemText(e){var t=e[this.getTextField()];return t==null?"":t.toString()}itemDisabled(e){return!1}mapItem(e){return{id:this.itemId(e),text:this.itemText(e),disabled:this.itemDisabled(e),source:e}}mapItems(e){return e.map(this.mapItem.bind(this))}allowClear(){return this.options.allowClear!=null?!!this.options.allowClear:this.emptyItemText()!=null}isMultiple(){return!!this.options.multiple}getSelect2Options(){var e=this.emptyItemText(),t={multiple:this.isMultiple(),placeHolder:Se(e)?null:e,allowClear:this.allowClear(),createSearchChoicePosition:"bottom"};if(this.hasAsyncSource()){var i=0,r=null;t.query=o=>{var l=this.getPageSize(),d={searchTerm:yn(o.term),skip:(o.page-1)*l,take:l,checkMore:!0};r&&r.abort&&r.abort(),r=null,i!=null&&clearTimeout(i);var c=$(this.element).data("select2");c&&c.search&&c.search.removeClass("select2-active").parent().removeClass("select2-active"),i=setTimeout(()=>{r&&r.abort&&r.abort(),c&&c.search.addClass("select2-active").parent().addClass("select2-active"),r=this.asyncSearch(d,u=>{r=null,o.callback({results:this.mapItems(u.items),more:u.more})}),(r&&(r.catch||r.fail)).call(r,()=>{r=null,c&&c.search&&c.search.removeClass("select2-active").parent().removeClass("select2-active")})},o.term?this.getTypeDelay():0)};var a=null;t.initSelection=(o,l)=>{var d=o.val();if(d==null||d==""){l(null);return}var c=this.isMultiple(),u=c?d.split(","):[d],g={idList:u};a&&a.abort&&a.abort(),a=this.asyncSearch(g,y=>{if(a=null,c){var f=(y.items||[]).map(S=>this.mapItem(S));this._itemById=this._itemById||{};for(var v of f)this._itemById[v.id]=v;if(this.isAutoComplete&&f.length!=u.length)for(var C of u)as(f,S=>S.id==C)||f.push({id:C,text:C});l(f)}else if(!y.items||!y.items.length)this.isAutoComplete?l({id:d,text:d}):l(null);else{var v=this.mapItem(y.items[0]);this._itemById=this._itemById||{},this._itemById[v.id]=v,l(v)}}),(a&&(a.catch||a.fail)).call(a,()=>{a=null})}}else t.data=this._items,t.query=o=>{var l=L.filterByText(this._items,c=>c.text,o.term),d=this.getPageSize();o.callback({results:l.slice((o.page-1)*d,o.page*d),more:l.length>=o.page*d})},t.initSelection=(o,l)=>{var d=o.val(),c=this.isAutoComplete();if(this.isMultiple()){var u=[];for(var g of d.split(",")){var y=this._itemById[g];y==null&&c&&(y={id:g,text:g},this.addItem(y)),y!=null&&u.push(y)}l(u);return}var f=this._itemById[d];f==null&&c&&(f={id:d,text:d},this.addItem(f)),l(f)};return this.options.minimumResultsForSearch!=null&&(t.minimumResultsForSearch=this.options.minimumResultsForSearch),(this.isAutoComplete()||this.useInplaceAdd())&&(t.createSearchChoice=this.getCreateSearchChoice(null)),t}get_delimited(){return!!this.options.delimited}get items(){if(this.hasAsyncSource())throw new Error("Can't read items property of an async select editor!");return this._items||[]}set items(e){if(this.hasAsyncSource())throw new Error("Can't set items of an async select editor!");this._items=e||[],this._itemById={};for(var t of this._items)this._itemById[t.id]=t}get itemById(){if(this.hasAsyncSource())throw new Error("Can't read items property of an async select editor!");return this._itemById}set itemById(e){if(this.hasAsyncSource())throw new Error("Can't set itemById of an async select editor!");this._itemById=e||{}}clearItems(){if(this.hasAsyncSource())throw new Error("Can't clear items of an async select editor!");this._items.length=0,this._itemById={}}addItem(e){if(this.hasAsyncSource())throw new Error("Can't add item to an async select editor!");this._items.push(e),this._itemById[e.id]=e}addOption(e,t,i,r){this.addItem({id:e,text:t,source:i,disabled:r})}addInplaceCreate(e,t){var i=this;e=e!=null?e:_t("Controls.SelectEditor.InplaceAdd"),t=t!=null?t:_t("Controls.SelectEditor.InplaceEdit");var r=$("<a><b/></a>").addClass("inplace-button inplace-create").attr("title",e).insertAfter(this.element).click(function(a){i.inplaceCreateClick(a)});this.get_select2Container().add(this.element).addClass("has-inplace-button"),this.element.change(()=>{var a=this.isMultiple()||Se(this.get_value());r.attr("title",a?e:t).toggleClass("edit",!a)}),this.element.change((a,o)=>{if(o!==!0)if(this.isMultiple()){var l=this.get_values();l.length>0&&l[l.length-1]==(-2147483648).toString()&&(this.set_values(l.slice(0,l.length-1)),this.inplaceCreateClick(a))}else this.get_value()==(-2147483648).toString()&&(this.set_value(null),this.inplaceCreateClick(a))}),this.isMultiple()&&this.get_select2Container().on("dblclick."+this.uniqueName,".select2-search-choice",a=>{var o=$(a.target);o.hasClass("select2-search-choice")||(o=o.closest(".select2-search-choice"));var l=o.index(),d=this.get_values();l<0||l>=this.get_values().length||(a.editItem=d[l],this.inplaceCreateClick(a))})}useInplaceAdd(){return!this.isAutoComplete()&&this.options.inplaceAdd&&(this.options.inplaceAddPermission==null||tl.hasPermission(this.options.inplaceAddPermission))}isAutoComplete(){return!!this.options.autoComplete}getCreateSearchChoice(e){return t=>{var r;if(this.lastCreateTerm=t,t=((r=Select2.util.stripDiacritics(t))!=null?r:"").toLowerCase(),il(t))return null;var i=!1;return as(this._items||[],a=>{var o=e?e(a.source):a.text;return Select2.util.stripDiacritics(o!=null?o:"").toLowerCase()==t})?null:as(this._items||[],a=>{var o;return((o=Select2.util.stripDiacritics(a.text))!=null?o:"").toLowerCase().indexOf(t)!==-1})?this.isAutoComplete()?{id:this.lastCreateTerm,text:this.lastCreateTerm}:{id:(-2147483648).toString(),text:_t("Controls.SelectEditor.ClickToDefine")}:this.isAutoComplete()?{id:this.lastCreateTerm,text:this.lastCreateTerm}:{id:(-2147483648).toString(),text:_t("Controls.SelectEditor.NoResultsClickToDefine")}}}setEditValue(e,t){var i=e[t.name];os(i)?this.set_values(i):this.set_value(i==null?null:i.toString())}getEditValue(e,t){!this.isMultiple()||this.get_delimited()?t[e.name]=this.get_value():t[e.name]=this.get_values()}get_select2Container(){return this.element.prevAll(".select2-container")}get_items(){return this.items}get_itemByKey(){return this.itemById}static filterByText(e,t,i){if(i==null||i.length==0)return e;i=Select2.util.stripDiacritics(i).toUpperCase();var r=[];function a(o){var l=t(o);return l==null||!l.length?!1:(l=Select2.util.stripDiacritics(l).toUpperCase(),rl(l,i)?!0:(l.indexOf(i)>=0&&r.push(o),!1))}return e.filter(a).concat(r)}get_value(){var e;if(this.element.data("select2")){if(e=this.element.select2("val"),e!=null&&os(e))return e.join(",")}else e=this.element.val();return e}get value(){return this.get_value()}set_value(e){if(e!=this.get_value()){var t=e;!Se(e)&&this.isMultiple()&&(t=e.split(String.fromCharCode(44)).map(function(r){return yn(r)}).filter(function(r){return r!=null}));var i=this.element;i.select2("val",t),i.data("select2-change-triggered",!0);try{i.triggerHandler("change",[!0])}finally{i.data("select2-change-triggered",!1)}this.updateInplaceReadOnly()}}set value(e){this.set_value(e)}get selectedItem(){let e=this.get_value();if(e&&this._itemById){let t=this._itemById[e];if(t)return t.source}return null}get selectedItems(){let e=this.values;var t=[];for(var i of e)if(i&&this._itemById){let r=this._itemById[i];r&&r.source?t.push(r.source):t.push(null)}return t}get_values(){var e=this.element.select2("val");if(e==null)return[];if(os(e))return e;var t=e;return Se(t)?[]:[t]}get values(){return this.get_values()}set_values(e){if(e==null||e.length===0){this.set_value(null);return}this.set_value(e.join(","))}set values(e){this.set_values(e)}get_text(){var e;return((e=this.element.select2("data"))!=null?e:{}).text}get text(){return this.get_text()}get_readOnly(){return!Se(this.element.attr("readonly"))}get readOnly(){return this.get_readOnly()}updateInplaceReadOnly(){var e=this.get_readOnly()&&(this.isMultiple()||!this.value);this.element.nextAll(".inplace-create").attr("disabled",e?"disabled":"").css("opacity",e?"0.1":"").css("cursor",e?"default":"")}set_readOnly(e){e!==this.get_readOnly()&&(this.element.attr("readonly",e?"readonly":null),this.updateInplaceReadOnly())}set readOnly(e){this.set_readOnly(e)}getCascadeFromValue(e){return w.getValue(e)}setCascadeFrom(e){if(Se(e)){this.cascadeLink!=null&&(this.cascadeLink.set_parentID(null),this.cascadeLink=null),this.options.cascadeFrom=null;return}this.cascadeLink=new Ue(b,this,t=>{this.set_cascadeValue(this.getCascadeFromValue(t))}),this.cascadeLink.set_parentID(e),this.options.cascadeFrom=e}get_cascadeFrom(){return this.options.cascadeFrom}get cascadeFrom(){return this.get_cascadeFrom()}set_cascadeFrom(e){e!==this.options.cascadeFrom&&(this.setCascadeFrom(e),this.updateItems())}set cascadeFrom(e){this.set_cascadeFrom(e)}get_cascadeField(){var e;return(e=this.options.cascadeField)!=null?e:this.options.cascadeFrom}get cascadeField(){return this.get_cascadeField()}set_cascadeField(e){this.options.cascadeField=e}set cascadeField(e){this.set_cascadeField(e)}get_cascadeValue(){return this.options.cascadeValue}get cascadeValue(){return this.get_cascadeValue()}set_cascadeValue(e){this.options.cascadeValue!==e&&(this.options.cascadeValue=e,this.set_value(null),this.updateItems())}set cascadeValue(e){this.set_cascadeValue(e)}get_filterField(){return this.options.filterField}get filterField(){return this.get_filterField()}set_filterField(e){this.options.filterField=e}set filterField(e){this.set_filterField(e)}get_filterValue(){return this.options.filterValue}get filterValue(){return this.get_filterValue()}set_filterValue(e){this.options.filterValue!==e&&(this.options.filterValue=e,this.set_value(null),this.updateItems())}set filterValue(e){this.set_filterValue(e)}cascadeItems(e){var t=this.get_cascadeValue();if(t==null||t==="")return Se(this.get_cascadeField())?e:[];var i=t.toString(),r=this.get_cascadeField();return e.filter(a=>{var l;var o=(l=a[r])!=null?l:re.getPropertyValue(a,r);return o!=null&&o.toString()===i})}filterItems(e){var t=this.get_filterValue();if(t==null||t==="")return e;var i=t.toString(),r=this.get_filterField();return e.filter(a=>{var l;var o=(l=a[r])!=null?l:re.getPropertyValue(a,r);return o!=null&&o.toString()===i})}updateItems(){}getDialogTypeKey(){return this.options.dialogType!=null?this.options.dialogType:null}createEditDialog(e){var t=this.getDialogTypeKey(),i=ct.get(t);b.create({type:i,init:r=>e(r)})}initNewEntity(e){Se(this.get_cascadeField())||(e[this.get_cascadeField()]=this.get_cascadeValue()),Se(this.get_filterField())||(e[this.get_filterField()]=this.get_filterValue()),this.onInitNewEntity!=null&&this.onInitNewEntity(e)}setEditDialogReadOnly(e){e.element&&e.element.find(".tool-button.delete-button").addClass("disabled").unbind("click")}editDialogDataChange(){}setTermOnNewEntity(e,t){}inplaceCreateClick(e){this.get_readOnly()&&(this.isMultiple()&&!e.editItem||!this.value)||this.createEditDialog(t=>{this.get_readOnly()&&this.setEditDialogReadOnly(t),xe.bindToDataChange(t,this,(a,o)=>{if(this.editDialogDataChange(),this.updateItems(),this.lastCreateTerm=null,(o.type==="create"||o.type==="update")&&o.entityId!=null){var l=o.entityId.toString();if(this.isMultiple()){var d=this.get_values().slice();d.indexOf(l)<0&&d.push(l),this.set_values(null),this.set_values(d.slice())}else this.set_value(null),this.set_value(l)}else if(this.isMultiple()&&o.type==="delete"&&o.entityId!=null){var c=o.entityId.toString(),u=this.get_values().slice(),g=u.indexOf(c);g>=0&&u.splice(g,1),this.set_values(u.slice())}else this.isMultiple()||this.set_value(null)},!0);var i=e.editItem;if(i!=null)t.load(i,()=>{t.dialogOpen(this.openDialogAsPanel)},null);else if(this.isMultiple()||Se(this.get_value())){var r={};this.setTermOnNewEntity(r,sl(this.lastCreateTerm)),this.initNewEntity(r),t.load(r,()=>{t.dialogOpen(this.openDialogAsPanel)},null)}else t.load(this.get_value(),()=>{t.dialogOpen(this.openDialogAsPanel)},null)})}};L=h([m.registerClass("Serenity.Select2Editor",[q,J,P,E]),m.element('<input type="hidden"/>')],L);import{isEmptyOrNull as nl}from"@serenity-is/corelib/q";var je=class extends L{constructor(n,e){super(n,e),this.updateItems()}getItems(){return this.options.items||[]}emptyItemText(){return nl(this.options.emptyOptionText)?super.emptyItemText():this.options.emptyOptionText}updateItems(){var a;var n=this.getItems();if(this.clearItems(),n.length>0){var e=typeof n[0]=="string";for(var t of n){var i=e?t:t[0],r=e?t:(a=t[1])!=null?a:t[0];this.addOption(i,r,t,!1)}}}};je=h([m.registerClass("Serenity.SelectEditor")],je);import{startsWith as Ki}from"@serenity-is/corelib/q";var Yi=class extends je{constructor(n,e){super(n,e),this.updateItems()}getItems(){var o,l;var n=this.options;if(n.items!=null&&n.items.length>=1)return n.items;var e=[],t=new Date().getFullYear(),i=new Date().getFullYear();if(n.minYear=((o=n.minYear)!=null?o:"-10").toString(),Ki(n.minYear,"-")?t-=parseInt(n.minYear.substr(1),10):Ki(n.minYear,"+")?t+=parseInt(n.minYear.substr(1),10):t=parseInt(n.minYear,10),n.maxYear=((l=n.maxYear)!=null?l:"+10").toString(),Ki(n.maxYear,"-")?i-=parseInt(n.maxYear.substr(1),10):Ki(n.maxYear,"+")?i+=parseInt(n.maxYear.substr(1),10):i=parseInt(n.maxYear,10),n.descending)for(var r=i;r>=t;r--)e.push(r.toString());else for(var a=t;a<=i;a++)e.push(a.toString());return e}};Yi=h([m.registerEditor("Serenity.DateYearEditor")],Yi);import{Enum as vn,getAttributes as al,tryGetText as ol}from"@serenity-is/corelib/q";var Rt=class extends L{constructor(n,e){super(n,e),this.updateItems()}updateItems(){var o;this.clearItems();var n=this.options.enumType||ze.get(this.options.enumKey),e=this.options.enumKey;if(e==null&&n!=null){var t=al(n,U,!1);t.length>0&&(e=t[0].value)}var i=vn.getValues(n);for(var r of i){var a=vn.toString(n,r);this.addOption(parseInt(r,10).toString(),(o=ol("Enums."+e+"."+a))!=null?o:a,null,!1)}}allowClear(){var n;return(n=this.options.allowClear)!=null?n:!0}};Rt=h([m.registerEditor("Serenity.EnumEditor")],Rt);import{endsWith as ll,getInstanceType as dl,getLookup as ul,getLookupAsync as pl,getTypeFullName as cl,reloadLookup as hl,ScriptData as bn}from"@serenity-is/corelib/q";var ft=class extends L{constructor(e,t){super(e,t);if(!this.hasAsyncSource()){this.updateItems();var i=this;bn.bindToChange("Lookup."+this.getLookupKey(),this.uniqueName,function(){i.updateItems()})}}hasAsyncSource(){return!!this.options.async}destroy(){this.hasAsyncSource()||bn.unbindFromChange(this.uniqueName),super.destroy()}getLookupKey(){if(this.options.lookupKey!=null)return this.options.lookupKey;var e=cl(dl(this)),t=e.indexOf(".");return t>=0&&(e=e.substring(t+1)),ll(e,"Editor")&&(e=e.substr(0,e.length-6)),e}getLookupAsync(){return pl(this.getLookupKey())}getLookup(){return ul(this.getLookupKey())}getItems(e){return this.filterItems(this.cascadeItems(e.items))}getIdField(){return this.lookup!=null?this.lookup.idField:super.getIdField()}getItemText(e,t){if(t==null)return super.itemText(e);var i=t.textFormatter?t.textFormatter(e):e[t.textField];return i==null?"":i.toString()}mapItem(e){return{id:this.itemId(e),text:this.getItemText(e,this.lookup),disabled:this.getItemDisabled(e,this.lookup),source:e}}getItemDisabled(e,t){return super.itemDisabled(e)}updateItems(){this.clearItems(),this.lookup=this.getLookup();var e=this.getItems(this.lookup);for(var t of e)this.addItem(this.mapItem(t))}asyncSearch(e,t){return this.getLookupAsync().then(i=>{this.lookup=i;var r=this.getItems(this.lookup);e.idList!=null&&(r=r.filter(o=>e.idList.indexOf(this.itemId(o))>=0));function a(o){return this.getItemText(o,this.lookup)}r=L.filterByText(r,a.bind(this),e.searchTerm),t({items:r.slice(e.skip,e.take),more:r.length>=e.take})})}getDialogTypeKey(){var e=super.getDialogTypeKey();return e||this.getLookupKey()}setCreateTermOnNewEntity(e,t){e[this.getLookup().textField]=t}editDialogDataChange(){hl(this.getLookupKey())}};ft=h([m.registerEditor("Serenity.LookupEditorBase")],ft);var Vt=class extends ft{constructor(n,e){super(n,e)}};Vt=h([m.registerEditor("Serenity.LookupEditor")],Vt);import{ColumnSelection as ml,Criteria as ls,isEmptyOrNull as gl,resolveUrl as fl,serviceCall as yl,startsWith as Xi}from"@serenity-is/corelib/q";var ri=class extends L{constructor(n,e){super(n,e)}getDialogTypeKey(){var n=super.getDialogTypeKey();if(n)return n;var e=this.getService();return Xi(e,"~/Services/")&&(e=e.substr(11)),e.split("/").length==3&&(e=e.substr(0,e.lastIndexOf("/"))),e.replace("/",".")}getService(){return this.options.service}getServiceUrl(){var n=this.getService();if(n==null)throw new Error("ServiceLookupEditor requires 'service' option to be configured!");return!Xi(n,"~")&&!Xi(n,"/")&&n.indexOf("://")<0&&(n="~/Services/"+n),Xi(n,"~")&&(n=fl(n)),n}getIncludeColumns(){var n=this.options.includeColumns||[],e=this.getIdField();e&&n.indexOf(e)<0&&n.push(e);var t=this.getTextField();return t&&n.indexOf(t)<0&&n.push(t),n}getSort(){return this.options.sort||(this.getTextField()?[this.getTextField()]:null)}getCascadeCriteria(){var n=this.get_cascadeValue();if(n==null||n==="")return gl(this.get_cascadeField())?null:["1","=","0"];var e=this.get_cascadeField();return[[e],"=",n]}getFilterCriteria(){var n=this.get_filterValue();if(n==null||n==="")return null;var e=this.get_filterField();return[[e],"=",n]}getIdListCriteria(n){if(n==null)return null;if(n.length==0)return["0","=","1"];var e=this.getIdField();if(e==null)throw new Error("ServiceLookupEditor requires 'idField' option to be configured!");return[[e],"in",[n]]}getCriteria(n){return ls.and(ls.and(this.getIdListCriteria(n.idList),this.options.criteria),ls.and(this.getCascadeCriteria(),this.getFilterCriteria()))}getListRequest(n){var e={};return n.searchTerm&&(e.ContainsText=n.searchTerm),e.Sort=this.getSort(),e.ColumnSelection=this.options.columnSelection||ml.KeyOnly,e.IncludeColumns=this.getIncludeColumns(),e.ExcludeColumns=this.options.excludeColumns,e.ContainsField=this.options.containsField,e.EqualityFilter=this.options.equalityFilter,e.Criteria=this.getCriteria(n),e.Skip=n.skip||0,e.Take=n.take?n.checkMore?n.take+1:n.take:0,e.IncludeDeleted=this.options.includeDeleted,e.ExcludeTotalCount=!0,e}getServiceCallOptions(n,e){return{blockUI:!1,url:this.getServiceUrl(),request:this.getListRequest(n),onSuccess:t=>{var i=t.Entities||[];i&&n.take&&n.checkMore&&t.Entities.length>i.length&&(i=i.slice(0,n.take)),e({items:i.slice(0,n.take),more:n.checkMore&&n.take&&i.length>n.take})}}}hasAsyncSource(){return!0}asyncSearch(n,e){var t=this.getServiceCallOptions(n,e);return yl(t)}};ri=h([m.registerEditor("Serenity.ServiceLookupEditorBase")],ri);var Qt=class extends ri{constructor(n,e){super(n,e)}};Qt=h([m.registerEditor("Serenity.ServiceLookupEditor")],Qt);import{endsWith as vl,isEmptyOrNull as bl,isTrimmedEmpty as Cl,resolveUrl as Cn,localText as xl,trimToNull as xn}from"@serenity-is/corelib/q";var ne=class extends b{constructor(e,t){super(e,t);this._instanceReady=!1,ne.includeCKEditor();var i=e.attr("id");Cl(i)&&(e.attr("id",this.uniqueName),i=this.uniqueName),this.options.cols!=null&&e.attr("cols",this.options.cols),this.options.rows!=null&&e.attr("rows",this.options.rows),this.addValidationRule(this.uniqueName,r=>{if(r.hasClass("required")){var a=xn(this.get_value());if(a==null)return xl("Validation.Required")}return null}),ve.executeOnceWhenShown(this.element,()=>{var r=this.getConfig();window.CKEDITOR&&window.CKEDITOR.replace(i,r)})}instanceReady(e){this._instanceReady=!0,$(e.editor.container.$).addClass(this.element.attr("class")),this.element.addClass("select2-offscreen").css("display","block"),e.editor.setData(this.element.val()),e.editor.setReadOnly(this.get_readOnly())}getLanguage(){var i;if(!window.CKEDITOR)return"en";var e=window.CKEDITOR,t=(i=xn($("html").attr("lang")))!=null?i:"en";return e.lang.languages[t]||(t.indexOf(String.fromCharCode(45))>=0&&(t=t.split(String.fromCharCode(45))[0]),e.lang.languages[t])?t:"en"}getConfig(){return{customConfig:"",language:this.getLanguage(),bodyClass:"s-HtmlContentBody",on:{instanceReady:e=>this.instanceReady(e),change:e=>{e.editor.updateElement(),this.element.triggerHandler("change")}},toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"insert",groups:["links","insert","blocks","bidi","list","indent"]},{name:"forms",groups:["forms","mode","document","doctools","others","about","tools"]},{name:"colors"},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"align"},{name:"styles"}],removeButtons:"SpecialChar,Anchor,Subscript,Styles",format_tags:"p;h1;h2;h3;pre",removeDialogTabs:"image:advanced;link:advanced",removePlugins:"uploadimage,image2",contentsCss:Cn("~/Content/site/site.htmlcontent.css"),entities:!1,entities_latin:!1,entities_greek:!1,autoUpdateElement:!0,height:this.options.rows==null||this.options.rows===0?null:this.options.rows*20+"px"}}getEditorInstance(){var e=this.element.attr("id");return window.CKEDITOR.instances[e]}destroy(){var e=this.getEditorInstance();e&&e.destroy(!0),super.destroy()}get_value(){var e=this.getEditorInstance();return this._instanceReady&&e?e.getData():this.element.val()}get value(){return this.get_value()}set_value(e){var t=this.getEditorInstance();this.element.val(e),this._instanceReady&&t&&t.setData(e)}set value(e){this.set_value(e)}get_readOnly(){return!bl(this.element.attr("disabled"))}set_readOnly(e){if(this.get_readOnly()!==e){e?this.element.attr("disabled","disabled"):this.element.removeAttr("disabled");var t=this.getEditorInstance();this._instanceReady&&t&&t.setReadOnly(e)}}static getCKEditorBasePath(){var e=ne.CKEditorBasePath;if(e==null)if(typeof CKEDITOR_BASEPATH!="undefined"&&CKEDITOR_BASEPATH)e=CKEDITOR_BASEPATH;else return"~/Scripts/ckeditor/";return vl(e,"/")?e:e+"/"}static includeCKEditor(){if(!window.CKEDITOR){var e=$("#CKEditorScript");e.length>0||$("<script/>").attr("type","text/javascript").attr("id","CKEditorScript").attr("src",Cn(ne.getCKEditorBasePath()+"ckeditor.js?v="+ne.CKEditorVer)).appendTo(window.document.head)}}};ne.CKEditorVer="4.7.1",ne=h([m.registerEditor("Serenity.HtmlContentEditor",[P,E]),m.element("<textarea/>")],ne);var Zi=class extends ne{constructor(n,e){super(n,e)}getConfig(){var n=super.getConfig();return n.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,PasteText,PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,Image,Table,HorizontalRule,Source,Maximize,Format,Font,FontSize,Anchor,Blockquote,CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,JustifyRight,JustifyBlock,Superscript,RemoveFormat",n.removePlugins="elementspath,uploadimage,image2",n}};Zi=h([m.registerEditor("Serenity.HtmlNoteContentEditor")],Zi);var er=class extends ne{constructor(n,e){super(n,e)}getConfig(){var n=super.getConfig();return n.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,PasteText,PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,Image,Table,HorizontalRule,Source,Maximize,Format,Font,FontSize,Anchor,Blockquote,CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,JustifyRight,JustifyBlock,Superscript,RemoveFormat",n.removePlugins="elementspath,uploadimage,image2",n}};er=h([m.registerEditor("Serenity.HtmlReportContentEditor")],er);var tr=class extends b{constructor(n,e){var t;super(n,e),n.mask(this.options.mask||"",{placeholder:(t=this.options.placeholder)!=null?t:"_"})}get value(){return this.element.triggerHandler("blur.mask"),this.element.val()}get_value(){return this.value}set value(n){this.element.val(n)}set_value(n){this.value=n}};tr=h([m.registerEditor("Serenity.MaskedEditor",[P]),m.element('<input type="text"/>')],tr);import{addValidationRule as Il,isEmptyOrNull as Sl,localText as Tl}from"@serenity-is/corelib/q";var ir=class extends b{constructor(n,e){var d;if(super(n,e),this.element.addClass("g-recaptcha").attr("data-sitekey",this.options.siteKey),window.grecaptcha==null&&$("script#RecaptchaInclude").length===0){var t="https://www.google.com/recaptcha/api.js",i=this.options.language;i==null&&(i=(d=$("html").attr("lang"))!=null?d:""),t+="?hl="+i,$("<script/>").attr("id","RecaptchaInclude").attr("src",t).appendTo(document.body)}var r=$("<input />").insertBefore(this.element).attr("id",this.uniqueName+"_validate").val("x"),a={};a.visibility="hidden",a.width="0px",a.height="0px",a.padding="0px";var o=r.css(a),l=this;Il(o,this.uniqueName,c=>Sl(this.get_value())?Tl("Validation.Required"):null)}get_value(){return this.element.find(".g-recaptcha-response").val()}set_value(n){}};ir=h([m.registerEditor("Serenity.Recaptcha",[P]),m.element("<div/>")],ir);import{alertDialog as yt,htmlEncode as rr,blockUI as kl,blockUndo as Ol,endsWith as sr,format as Bt,iframeDialog as wl,isEmptyOrNull as In,notifyError as Nt,replaceAll as Dl,resolveUrl as Sn,round as Tn,startsWith as Fl,localText as pe}from"@serenity-is/corelib/q";var Te;(d=>{function p(c){c.container.addClass("fileinput-button");var u=c.uploadUrl||"~/File/TemporaryUpload";c.uploadIntent&&(u.indexOf("?")<0?u+="?":u+="&",u+="uploadIntent=",u+=encodeURIComponent(c.uploadIntent));var g=$("<input/>").attr("type","file").attr("name",c.inputName+"[]").attr("data-url",Sn(u)).appendTo(c.container);return c.allowMultiple&&g.attr("multiple","multiple"),g.fileupload({dataType:"json",dropZone:c.zone,pasteZone:c.zone,done:function(y,f){var v=f.result;if(v.Error){Nt(v.Error.Message);return}c.fileDone!=null&&c.fileDone(v,f.files[0].name,f)},fail:function(y,f){var O;var v=(O=f==null?void 0:f._response)==null?void 0:O.jqXHR;if(!v){Nt("An error occurred during file upload.");return}if((v.getResponseHeader("content-type")||"").toLowerCase().indexOf("application/json")>=0){var C=$.parseJSON(v.responseText);if(C&&C.Error&&C.Error.Message){Nt(C.Error.Message);return}}var S=v.responseText;if(S){wl({html:S});return}if(!v.status){v.statusText!="abort"&&Nt("An unknown connection error occurred! Check browser console for details.");return}if(v.status==500){Nt("HTTP 500: Connection refused! Check browser console for details.");return}Nt("HTTP "+v.status+" error! Check browser console for details.")},start:function(){kl(null),c.progress!=null&&c.progress.show()},stop:function(){Ol(),c.progress!=null&&c.progress.hide()},progress:function(y,f){if(c.progress!=null){var v=f.loaded/f.total*100;c.progress.children().css("width",v.toString()+"%")}}}),g}d.addUploadInput=p;function n(c,u){return!c.IsImage&&!u.allowNonImage?(yt(pe("Controls.ImageUpload.NotAnImageFile")),!1):u.minSize>0&&c.Size<u.minSize?(yt(Bt(pe("Controls.ImageUpload.UploadFileTooSmall"),t(u.minSize))),!1):u.maxSize>0&&c.Size>u.maxSize?(yt(Bt(pe("Controls.ImageUpload.UploadFileTooBig"),t(u.maxSize))),!1):c.IsImage?u.minWidth>0&&c.Width<u.minWidth?(yt(Bt(pe("Controls.ImageUpload.MinWidth"),u.minWidth)),!1):u.maxWidth>0&&c.Width>u.maxWidth?(yt(Bt(pe("Controls.ImageUpload.MaxWidth"),u.maxWidth)),!1):u.minHeight>0&&c.Height<u.minHeight?(yt(Bt(pe("Controls.ImageUpload.MinHeight"),u.minHeight)),!1):u.maxHeight>0&&c.Height>u.maxHeight?(yt(Bt(pe("Controls.ImageUpload.MaxHeight"),u.maxHeight)),!1):!0:!0}d.checkImageConstraints=n;function e(c,u){return c+" ("+t(u)+")"}d.fileNameSizeDisplay=e;function t(c){var u=Tn(c*100/1024)*.01,g="KB";u>=1024&&(u=Tn(u*100/1024)*.01,g="MB");var y=u.toString().split(String.fromCharCode(46)),f;return y.length>1?f=y[0]+"."+y[1].substr(0,2):f=y[0],f+" "+g}d.fileSizeDisplay=t;function i(c){return In(c)?!1:(c=c.toLowerCase(),sr(c,".jpg")||sr(c,".jpeg")||sr(c,".gif")||sr(c,".png"))}d.hasImageExtension=i;function r(c){c=c!=null?c:"";var u=c.lastIndexOf(".");return u>=0&&(c=c.substr(0,u)),c+"_t.jpg"}d.thumbFileName=r;function a(c){return c=Dl(c!=null?c:"","\\","/"),Sn("~/upload/")+c}d.dbFileUrl=a;function o(c,u){c.colorbox({current:rr(pe("Controls.ImageUpload.ColorboxCurrent")),previous:rr(pe("Controls.ImageUpload.ColorboxPrior")),next:rr(pe("Controls.ImageUpload.ColorboxNext")),close:rr(pe("Controls.ImageUpload.ColorboxClose"))})}d.colorBox=o;function l(c,u,g,y){var I;u=u||[],c.html("");for(var f=0;f<u.length;f++){var v=u[f],C=$("<li/>").addClass("file-item").data("index",f),S=i(v.Filename);S?C.addClass("file-image"):C.addClass("file-binary");var O="#"+f,T=$("<a/>").addClass("thumb").appendTo(C),D=(I=v.OriginalName)!=null?I:"",x=v.Filename;y!=null&&x!=null&&!Fl(x,"temporary/")&&(x=y+x),T.attr("href",a(x)),T.attr("target","_blank"),In(D)||T.attr("title",D),S&&(T.css("backgroundImage","url('"+a(r(v.Filename))+"')"),o(T,new Object)),g&&$("<div/>").addClass("filename").text(D).attr("title",D).appendTo(C),C.appendTo(c)}}d.populateFileSymbols=l})(Te||(Te={}));import{endsWith as Pl,extend as or,isEmptyOrNull as kn,isInstanceOfType as El,isTrimmedEmpty as On,replaceAll as _l,startsWith as Rl,localText as ds,trimToNull as ni}from"@serenity-is/corelib/q";var si=class extends b{constructor(e,t){super(e,t);(!t||t.allowNonImage==null)&&(this.options.allowNonImage=!0),e.addClass("s-FileUploadEditor"),kn(this.options.originalNameProperty)&&e.addClass("hide-original-name"),this.toolbar=new A($("<div/>").appendTo(this.element),{buttons:this.getToolButtons()}),this.progress=$("<div><div></div></div>").addClass("upload-progress").prependTo(this.toolbar.element);var i=this.getUploadInputOptions();this.uploadInput=Te.addUploadInput(i),this.fileSymbols=$("<ul/>").appendTo(this.element),this.element.attr("id")||this.element.attr("id",this.uniqueName),this.hiddenInput=$('<input type="text" class="s-offscreen" name="'+this.uniqueName+'_Validator" data-vx-highlight="'+this.element.attr("id")+'"/>').appendTo(this.element),this.updateInterface()}getUploadInputOptions(){return{container:this.toolbar.findButton("add-file-button"),zone:this.element,inputName:this.uniqueName,progress:this.progress,uploadIntent:this.options.uploadIntent,uploadUrl:this.options.uploadUrl,fileDone:(e,t,i)=>{if(Te.checkImageConstraints(e,this.options)){var r={OriginalName:t,Filename:e.TemporaryFile};this.entity=r,this.populate(),this.updateInterface();var a=this.hiddenInput.closest("form").data("validator");a!=null&&a.element(this.hiddenInput)}}}}addFileButtonText(){return ds("Controls.ImageUpload.AddFileButton")}getToolButtons(){return[{title:this.addFileButtonText(),cssClass:"add-file-button",onClick:function(){}},{title:"",hint:ds("Controls.ImageUpload.DeleteButtonHint"),cssClass:"delete-button",onClick:()=>{this.entity=null,this.populate(),this.updateInterface();var e=this.hiddenInput.closest("form").data("validator");e!=null&&e.element(this.hiddenInput)}}]}populate(){var e=this.options.displayFileName||!On(this.options.originalNameProperty);this.entity==null?Te.populateFileSymbols(this.fileSymbols,null,e,this.options.urlPrefix):Te.populateFileSymbols(this.fileSymbols,[this.entity],e,this.options.urlPrefix),this.hiddenInput.val(ni((this.get_value()||{}).Filename))}updateInterface(){var e=this.toolbar.findButton("add-file-button"),t=this.toolbar.findButton("delete-button");e.toggleClass("disabled",this.get_readOnly()),t.toggleClass("disabled",this.get_readOnly()||this.entity==null)}get_readOnly(){return this.uploadInput.attr("disabled")!=null}set_readOnly(e){if(this.get_readOnly()!==e){if(e){this.uploadInput.attr("disabled","disabled");try{this.uploadInput.fileupload("disable")}catch(t){}}else{this.uploadInput.removeAttr("disabled");try{this.uploadInput.fileupload("enable")}catch(t){}}this.updateInterface()}}get_required(){return this.hiddenInput.hasClass("required")}set_required(e){this.hiddenInput.toggleClass("required",!!e)}get_value(){if(this.entity==null)return null;var e=or({},this.entity);return e}get value(){return this.get_value()}set_value(e){var t=e;if(typeof t=="string"){var t=ni(t);if(e!=null){var i=t.indexOf("/");i<0&&(i=t.indexOf("\\")),e={Filename:e,OriginalName:t.substring(i+1)}}}else e!=null&&On(e.Filename)&&(e=null);e!=null?e.Filename==null?this.entity=null:this.entity=or({},e):this.entity=null,this.populate();var r=this.hiddenInput.closest("form").data("validator");r!=null&&r.element(this.hiddenInput),this.updateInterface()}set value(e){this.set_value(e)}getEditValue(e,t){t[e.name]=this.entity==null?null:ni(this.entity.Filename)}setEditValue(e,t){var o;var i={};if(i.Filename=e[t.name],kn(this.options.originalNameProperty)){if(this.options.displayFileName){var r=(o=i.Filename)!=null?o:"",a=_l(r,"\\","/").lastIndexOf("/");a>=0?i.OriginalName=r.substr(a+1):i.OriginalName=r}}else i.OriginalName=e[this.options.originalNameProperty];this.set_value(i)}};si=h([m.registerEditor("Serenity.FileUploadEditor",[E,J,q,Ve]),m.element("<div/>")],si);var nr=class extends si{constructor(n,e){super(n,e),e&&e.allowNonImage==null&&(this.options.allowNonImage=!1),n.addClass("s-ImageUploadEditor")}};nr=h([m.registerEditor("Serenity.ImageUploadEditor")],nr);var Lt=class extends b{constructor(e,t){super(e,t);this.entities=[],e.addClass("s-MultipleFileUploadEditor");var i=this;this.toolbar=new A($("<div/>").appendTo(this.element),{buttons:this.getToolButtons()}),this.progress=$("<div><div></div></div>").addClass("upload-progress").prependTo(this.toolbar.element),this.uploadInput=Te.addUploadInput(this.getUploadInputOptions()),this.fileSymbols=$("<ul/>").appendTo(this.element),this.element.attr("id")||this.element.attr("id",this.uniqueName),this.hiddenInput=$('<input type="text" class="s-offscreen" name="'+this.uniqueName+'_Validator" data-vx-highlight="'+this.element.attr("id")+'"/>').appendTo(this.element),this.updateInterface()}getUploadInputOptions(){var e=this.toolbar.findButton("add-file-button");return{container:e,zone:this.element,inputName:this.uniqueName,progress:this.progress,uploadIntent:this.options.uploadIntent,uploadUrl:this.options.uploadUrl,fileDone:(t,i)=>{if(Te.checkImageConstraints(t,this.options)){var r={OriginalName:i,Filename:t.TemporaryFile};this.entities.push(r),this.populate();var a=this.hiddenInput.closest("form").data("validator");a!=null&&a.element(this.hiddenInput),this.updateInterface()}}}}addFileButtonText(){return ds("Controls.ImageUpload.AddFileButton")}getToolButtons(){return[{title:this.addFileButtonText(),cssClass:"add-file-button",onClick:function(){}}]}populate(){Te.populateFileSymbols(this.fileSymbols,this.entities,!0,this.options.urlPrefix),this.fileSymbols.children().each((e,t)=>{var i=e;$("<a class='delete'></a>").appendTo($(t).children(".filename")).click(r=>{r.preventDefault(),this.entities.splice(i,1),this.populate();var a=this.hiddenInput.closest("form").data("validator");a!=null&&a.element(this.hiddenInput)})}),this.hiddenInput.val(ni((this.get_value()[0]||{}).Filename))}updateInterface(){var e=this.toolbar.findButton("add-file-button");e.toggleClass("disabled",this.get_readOnly()),this.fileSymbols.find("a.delete").toggle(!this.get_readOnly())}get_readOnly(){return this.uploadInput.attr("disabled")!=null}set_readOnly(e){if(this.get_readOnly()!==e){if(e){this.uploadInput.attr("disabled","disabled");try{this.uploadInput.fileupload("disable")}catch(t){}}else{this.uploadInput.removeAttr("disabled");try{this.uploadInput.fileupload("enable")}catch(t){}}this.updateInterface()}}get_required(){return this.hiddenInput.hasClass("required")}set_required(e){this.hiddenInput&&this.hiddenInput.toggleClass("required",!!e)}get_value(){return this.entities.map(function(e){return or({},e)})}get value(){return this.get_value()}set_value(e){this.entities=(e||[]).map(function(t){return or({},t)}),this.populate(),this.updateInterface()}set value(e){this.set_value(e)}getEditValue(e,t){this.jsonEncodeValue?t[e.name]=JSON.stringify(this.get_value()):t[e.name]=this.get_value()}setEditValue(e,t){var a;var i=e[t.name];if(El(i,String)){var r=(a=ni(i))!=null?a:"[]";Rl(r,"[")&&Pl(r,"]")?this.set_value($.parseJSON(r)):this.set_value([{Filename:r,OriginalName:"UnknownFile"}])}else this.set_value(i)}};h([m.option()],Lt.prototype,"jsonEncodeValue",2),Lt=h([m.registerEditor("Serenity.MultipleFileUploadEditor",[E,J,q,Ve]),m.element("<div/>")],Lt);var ar=class extends Lt{constructor(n,e){super(n,e),n.addClass("s-MultipleImageUploadEditor")}};ar=h([m.registerEditor("Serenity.MultipleImageUploadEditor")],ar);import{ArgumentNullException as Vl,Criteria as lr,delegateCombine as Ql,delegateRemove as Bl,formatDate as Nl,isArray as wn,isEmptyOrNull as j,isTrimmedEmpty as dr,notifyWarning as ur,parseDate as pr,localText as Gt,toId as Ll,tryGetText as Dn}from"@serenity-is/corelib/q";var W=class extends b{constructor(e,t){var o;super(e,t);e.addClass("quick-filters-bar").addClass("clear");for(var i=this.options.filters,r=0;r<i.length;r++){var a=i[r];this.add(a)}this.options.idPrefix=(o=this.options.idPrefix)!=null?o:this.uniqueName+"_"}addSeparator(){this.element.append($("<hr/>"))}add(e){if(e==null)throw new Vl("opt");e.separator&&this.addSeparator();var t=$("<div class='quick-filter-item'><span class='quick-filter-label'></span></div>").appendTo(this.element).data("qffield",e.field).children(),i=e.title;i==null&&(i=this.options.getTitle?this.options.getTitle(e):null,i==null&&(i=e.field));var r=t.text(i).parent();e.displayText!=null&&r.data("qfdisplaytext",e.displayText),e.saveState!=null&&r.data("qfsavestate",e.saveState),e.loadState!=null&&r.data("qfloadstate",e.loadState),j(e.cssClass)||r.addClass(e.cssClass);var a=b.create({type:e.type,element:l=>{j(e.field)||l.attr("id",this.options.idPrefix+e.field),l.attr("placeholder"," "),l.appendTo(r),e.element!=null&&e.element(l)},options:e.options,init:e.init}),o=l=>{if(!r.hasClass("ignore")){l.EqualityFilter=l.EqualityFilter||{};var d=w.getValue(a),c=d!=null&&!j(d.toString());if(e.handler!=null){var u={field:e.field,request:l,equalityFilter:l.EqualityFilter,value:d,active:c,widget:a,handled:!0};e.handler(u),r.toggleClass("quick-filter-active",u.active),u.handled||(l.EqualityFilter[e.field]=d)}else l.EqualityFilter[e.field]=d,r.toggleClass("quick-filter-active",c)}};return a.changeSelect2(l=>{window.setTimeout(()=>this.onChange&&this.onChange(l),0)}),this.add_submitHandlers(o),a.element.bind("remove."+this.uniqueName,l=>{this.remove_submitHandlers(o)}),a}addDateRange(e,t){return this.add(W.dateRange(e,t))}static dateRange(e,t){var i=null;return{field:e,type:Q,title:t,element:function(r){i=b.create({type:Q,element:function(a){a.insertAfter(r)},options:null,init:null}),i.element.change(function(a){r.triggerHandler("change")}),$("<span/>").addClass("range-separator").text("-").insertAfter(r)},handler:function(r){var a=!dr(r.widget.value),o=!dr(i.value);if(a&&!pr(r.widget.element.val())&&(a=!1,ur(Gt("Validation.DateInvalid"),"",null),r.widget.element.val("")),o&&!pr(i.element.val())&&(o=!1,ur(Gt("Validation.DateInvalid"),"",null),i.element.val("")),r.active=a||o,a&&(r.request.Criteria=lr.join(r.request.Criteria,"and",[[r.field],">=",r.widget.value])),o){var l=new Date(i.valueAsDate.valueOf());l.setDate(l.getDate()+1),r.request.Criteria=lr.join(r.request.Criteria,"and",[[r.field],"<",Nl(l,"yyyy-MM-dd")])}},displayText:function(r,a){var u;var o=w.getDisplayText(r),l=w.getDisplayText(i);if(j(o)&&j(l))return null;var d=a+" >= "+o,c=a+" <= "+l;return!j(o)&&!j(l)?d+" "+((u=Dn("Controls.FilterPanel.And"))!=null?u:"and")+" "+c:j(o)?c:d},saveState:function(r){return[w.getValue(r),w.getValue(i)]},loadState:function(r,a){(a==null||!wn(a)||a.length!==2)&&(a=[null,null]),w.setValue(r,a[0]),w.setValue(i,a[1])}}}addDateTimeRange(e,t){return this.add(W.dateTimeRange(e,t))}static dateTimeRange(e,t,i){var r=null;return{field:e,type:G,title:t,element:function(a){r=b.create({type:G,element:function(o){o.insertAfter(a)},options:i==null?null:{useUtc:i},init:null}),r.element.change(function(o){a.triggerHandler("change")}),$("<span/>").addClass("range-separator").text("-").insertAfter(a)},init:function(a){a.element.parent().find(".time").change(function(o){a.element.triggerHandler("change")})},handler:function(a){var o=!dr(a.widget.value),l=!dr(r.value);o&&!pr(a.widget.element.val())&&(o=!1,ur(Gt("Validation.DateInvalid"),"",null),a.widget.element.val("")),l&&!pr(r.element.val())&&(l=!1,ur(Gt("Validation.DateInvalid"),"",null),r.element.val("")),a.active=o||l,o&&(a.request.Criteria=lr.join(a.request.Criteria,"and",[[a.field],">=",a.widget.value])),l&&(a.request.Criteria=lr.join(a.request.Criteria,"and",[[a.field],"<=",r.value]))},displayText:function(a,o){var g;var l=w.getDisplayText(a),d=w.getDisplayText(r);if(j(l)&&j(d))return null;var c=o+" >= "+l,u=o+" <= "+d;return!j(l)&&!j(d)?c+" "+((g=Dn("Controls.FilterPanel.And"))!=null?g:"and")+" "+u:j(l)?u:c},saveState:function(a){return[w.getValue(a),w.getValue(r)]},loadState:function(a,o){(o==null||!wn(o)||o.length!==2)&&(o=[null,null]),w.setValue(a,o[0]),w.setValue(r,o[1])},options:i==null?null:{useUtc:i}}}addBoolean(e,t,i,r){return this.add(W.boolean(e,t,i,r))}static boolean(e,t,i,r){var a={},o=[],l=i;l==null&&(l=Gt("Controls.FilterPanel.OperatorNames.true")),o.push(["1",l]);var d=r;return d==null&&(d=Gt("Controls.FilterPanel.OperatorNames.false")),o.push(["0",d]),a.items=o,{field:e,type:je,title:t,options:a,handler:function(c){c.equalityFilter[c.field]=c.value==null||j(c.value.toString())?null:!!Ll(c.value)}}}destroy(){this.submitHandlers=null,super.destroy()}onSubmit(e){this.submitHandlers&&this.submitHandlers(e)}add_submitHandlers(e){this.submitHandlers=Ql(this.submitHandlers,e)}remove_submitHandlers(e){this.submitHandlers=Bl(this.submitHandlers,e)}clear_submitHandlers(){}find(e,t){return $("#"+this.options.idPrefix+t).getWidget(e)}tryFind(e,t){var i=$("#"+this.options.idPrefix+t);return i.length?i.tryGetWidget(e):null}};W=h([m.registerClass("Serenity.QuickFilterBar"),m.element("<div/>")],W);import{isEmptyOrNull as Fn,isValue as Gl,localText as us,trim as cr}from"@serenity-is/corelib/q";var te=class extends b{constructor(e,t){var d,c;super(e,t);e.attr("title",us("Controls.QuickSearch.Hint")).attr("placeholder",us("Controls.QuickSearch.Placeholder")),this.lastValue=cr((d=e.val())!=null?d:"");var i=this;if(this.element.bind("keyup."+this.uniqueName,function(){i.checkIfValueChanged()}),this.element.bind("change."+this.uniqueName,function(){i.checkIfValueChanged()}),$("<span><i></i></span>").addClass("quick-search-icon").insertBefore(e),Gl(this.options.fields)&&this.options.fields.length>0){var r=$("<a/>").addClass("quick-search-field").attr("title",us("Controls.QuickSearch.FieldSelection")).insertBefore(e),a=$("<ul></ul>").css("width","120px");for(var o of this.options.fields){var l={$:o};$("<li><a/></li>").appendTo(a).children().attr("href","#").text((c=o.title)!=null?c:"").click(function(u){u.preventDefault(),this.$this.fieldChanged=i.field!==this.field.$,i.field=this.field.$,this.$this.updateInputPlaceHolder(),this.$this.checkIfValueChanged()}.bind({field:l,$this:this}))}new mt(r,{positionMy:"right top",positionAt:"right bottom",menu:a}),this.field=this.options.fields[0],this.updateInputPlaceHolder()}this.element.bind("execute-search."+this.uniqueName,u=>{var g;this.timer&&window.clearTimeout(this.timer),this.searchNow(cr((g=this.element.val())!=null?g:""))})}checkIfValueChanged(){var i;if(!this.element.hasClass("ignore-change")){var e=this.get_value();if(e==this.lastValue&&(!this.fieldChanged||Fn(e))){this.fieldChanged=!1;return}this.fieldChanged=!1,this.timer&&window.clearTimeout(this.timer);var t=this;this.timer=window.setTimeout(function(){t.searchNow(e)},(i=this.options.typeDelay)!=null?i:500),this.lastValue=e}}get_value(){var e;return cr((e=this.element.val())!=null?e:"")}get_field(){return this.field}set_field(e){this.field!==e&&(this.fieldChanged=!0,this.field=e,this.updateInputPlaceHolder(),this.checkIfValueChanged())}updateInputPlaceHolder(){var e=this.element.prevAll(".quick-search-field");this.field?e.text(this.field.title):e.text("")}restoreState(i,t){this.fieldChanged=!1,this.field=t;var i=cr(i!=null?i:"");this.element.val(i),this.lastValue=i,this.timer&&(window.clearTimeout(this.timer),this.timer=null),this.updateInputPlaceHolder()}searchNow(e){var i,r,a;this.element.parent().toggleClass((i=this.options.filteredParentClass)!=null?i:"s-QuickSearchFiltered",e.length>0),this.element.parent().addClass((r=this.options.loadingParentClass)!=null?r:"s-QuickSearchLoading").addClass((a=this.options.loadingParentClass)!=null?a:"s-QuickSearchLoading");var t=o=>{var d,c;if(this.element.removeClass((d=this.options.loadingParentClass)!=null?d:"s-QuickSearchLoading").parent().removeClass((c=this.options.loadingParentClass)!=null?c:"s-QuickSearchLoading"),!o){var l=this.element.closest(".s-QuickSearchBar").find(".quick-search-icon i")[0];l&&(l.classList.add("s-shake-effect"),setTimeout(()=>l.classList.remove("s-shake-effect"),2e3))}};this.options.onSearch!=null?this.options.onSearch(this.field!=null&&!Fn(this.field.name)?this.field.name:null,e,t):t(!0)}};te=h([m.registerClass("Serenity.QuickSearchInput")],te);var k;(v=>(v.isTrue="true",v.isFalse="false",v.contains="contains",v.startsWith="startswith",v.EQ="eq",v.NE="ne",v.GT="gt",v.GE="ge",v.LT="lt",v.LE="le",v.BW="bw",v.IN="in",v.isNull="isnull",v.isNotNull="isnotnull",v.toCriteriaOperator={eq:"=",ne:"!=",gt:">",ge:">=",lt:"<",le:"<="}))(k||(k={}));import{ArgumentNullException as Al,Criteria as ce,Culture as Wl,delegateCombine as Jl,delegateRemove as ql,localText as Ml,tryGetText as Pn}from"@serenity-is/corelib/q";var ae=class{constructor(n){if(this.items=[],n==null)throw new Al("source");this.fields=n.slice(),this.get_fields().sort(function(t,i){var r=Pn(t.title);r==null&&(r=t.title,r==null&&(r=t.name));var a=Pn(i.title);return a==null&&(a=i.title,a==null&&(a=i.name)),Wl.stringCompare(r,a)}),this.fieldByName={};for(var e of n)this.get_fieldByName()[e.name]=e}static getCriteriaFor(n){if(n==null)return[""];for(var e=!1,t=[""],i=!1,r=[""],a=0;a<n.length;a++){var o=n[a];(o.leftParen||e&&o.rightParen)&&(ce.isEmpty(t)||(e&&(t=ce.paren(t)),i?r=ce.join(r,"or",t):r=ce.join(r,"and",t),t=[""]),e=!1),o.leftParen&&(i=o.isOr,e=!0),o.isOr?t=ce.join(t,"or",o.criteria):t=ce.join(t,"and",o.criteria)}return ce.isEmpty(t)||(i?r=ce.join(r,"or",ce.paren(t)):r=ce.join(r,"and",ce.paren(t))),r}static getDisplayTextFor(n){if(n==null)return"";for(var e=!1,t="",i=0;i<n.length;i++){var r=n[i];e&&(r.rightParen||r.leftParen)&&(t+=")",e=!1),t.length>0&&(t+=" "+Ml("Controls.FilterPanel."+(r.isOr?"Or":"And"))+" "),r.leftParen&&(t+="(",e=!0),t+=r.displayText}return e&&(t+=")"),t}get_fields(){return this.fields}get_fieldByName(){return this.fieldByName}get_items(){return this.items}raiseChanged(){this.displayText=null,this.changed&&this.changed(this,{})}add_changed(n){this.changed=Jl(this.changed,n)}remove_changed(n){this.changed=ql(this.changed,n)}get_activeCriteria(){return ae.getCriteriaFor(this.items)}get_displayText(){return this.displayText==null&&(this.displayText=ae.getDisplayTextFor(this.items)),this.displayText}};ae=h([m.registerClass("Serenity.FilterStore")],ae);import{ArgumentNullException as Vn,Config as $l,Criteria as ps,deepClone as br,endsWith as zl,Exception as Cr,extend as xr,format as bt,formatDate as En,getInstanceType as _n,getTypeFullName as cs,getTypes as Hl,isAssignableFrom as Ul,isEmptyOrNull as hs,parseISODateTime as jl,startsWith as Kl,localText as Yl,tryGetText as Rn}from"@serenity-is/corelib/q";var Ke=class{};Ke=h([m.registerInterface("Serenity.IFiltering")],Ke);var Ct=class{};Ct=h([m.registerInterface("Serenity.IQuickFiltering")],Ct);var xt=class{get_field(){return this.field}set_field(n){this.field=n}get_container(){return this.container}set_container(n){this.container=n}get_operator(){return this.operator}set_operator(n){this.operator=n}appendNullableOperators(n){return this.isNullable()&&(n.push({key:k.isNotNull}),n.push({key:k.isNull})),n}appendComparisonOperators(n){return n.push({key:k.EQ}),n.push({key:k.NE}),n.push({key:k.LT}),n.push({key:k.LE}),n.push({key:k.GT}),n.push({key:k.GE}),n}isNullable(){return this.get_field().required!==!0}createEditor(){switch(this.get_operator().key){case"true":case"false":case"isnull":case"isnotnull":return;case"contains":case"startswith":case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{this.get_container().html('<input type="text"/>');return}}throw new Cr(bt("Filtering '{0}' has no editor for '{1}' operator",cs(_n(this)),this.get_operator().key))}operatorFormat(n){var e,t;return(t=(e=n.format)!=null?e:Rn("Controls.FilterPanel.OperatorFormats."+n.key))!=null?t:n.key}getTitle(n){var e,t;return(t=Rn(n.title))!=null?t:(e=n.title)!=null?e:n.name}displayText(n,e){return!e||e.length===0?bt(this.operatorFormat(n),this.getTitle(this.field)):e.length===1?bt(this.operatorFormat(n),this.getTitle(this.field),e[0]):bt(this.operatorFormat(n),this.getTitle(this.field),e[0],e[1])}getCriteriaField(){return this.field.name}getCriteria(){var n={},e;switch(this.get_operator().key){case"true":return n.displayText=this.displayText(this.get_operator(),[]),n.criteria=[[this.getCriteriaField()],"=",!0],n;case"false":return n.displayText=this.displayText(this.get_operator(),[]),n.criteria=[[this.getCriteriaField()],"=",!1],n;case"isnull":return n.displayText=this.displayText(this.get_operator(),[]),n.criteria=["is null",[this.getCriteriaField()]],n;case"isnotnull":return n.displayText=this.displayText(this.get_operator(),[]),n.criteria=["is not null",[this.getCriteriaField()]],n;case"contains":return e=this.getEditorText(),n.displayText=this.displayText(this.get_operator(),[e]),n.criteria=[[this.getCriteriaField()],"like","%"+e+"%"],n;case"startswith":return e=this.getEditorText(),n.displayText=this.displayText(this.get_operator(),[e]),n.criteria=[[this.getCriteriaField()],"like",e+"%"],n;case"eq":case"ne":case"lt":case"le":case"gt":case"ge":return e=this.getEditorText(),n.displayText=this.displayText(this.get_operator(),[e]),n.criteria=[[this.getCriteriaField()],k.toCriteriaOperator[this.get_operator().key],this.getEditorValue()],n}throw new Cr(bt("Filtering '{0}' has no handler for '{1}' operator",cs(_n(this)),this.get_operator().key))}loadState(n){var e=this.get_container().find(":input").first();e.val(n)}saveState(){switch(this.get_operator().key){case"contains":case"startswith":case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{var n=this.get_container().find(":input").first();return n.val()}}return null}argumentNull(){return new Vn("value",Yl("Controls.FilterPanel.ValueRequired"))}validateEditorValue(n){if(n.length===0)throw this.argumentNull();return n}getEditorValue(){var t;var n=this.get_container().find(":input").not(".select2-focusser").first();if(n.length!==1)throw new Cr(bt("Couldn't find input in filter container for {0}",(t=this.field.title)!=null?t:this.field.name));var e;return n.data("select2")!=null?e=n.select2("val"):e=n.val(),e=(e!=null?e:"").trim(),this.validateEditorValue(e)}getEditorText(){var t;var n=this.get_container().find(":input").not(".select2-focusser").not(".select2-input").first();if(n.length===0)return this.get_container().text().trim();var e;return n.data("select2")!=null?e=((t=n.select2("data"))!=null?t:{}).text:e=n.val(),e}initQuickFilter(n){n.field=this.getCriteriaField(),n.type=se,n.title=this.getTitle(this.field),n.options=br(this.get_field().quickFilterParams)}};xt=h([m.registerClass("Serenity.BaseFiltering",[Ke,Ct])],xt);function he(p){return m.registerClass("Serenity."+p+"Filtering")}var oe=class extends xt{constructor(e){super();this.editorType=e}useEditor(){switch(this.get_operator().key){case"eq":case"ne":case"lt":case"le":case"gt":case"ge":return!0}return!1}createEditor(){if(this.useEditor()){this.editor=b.create({type:this.editorType,container:this.get_container(),options:this.getEditorOptions(),init:null});return}this.editor=null,super.createEditor()}useIdField(){return!1}getCriteriaField(){return this.useEditor()&&this.useIdField()&&!hs(this.get_field().filteringIdField)?this.get_field().filteringIdField:super.getCriteriaField()}getEditorOptions(){var e=br(this.get_field().editorParams||{});return delete e.cascadeFrom,xr(e,this.get_field().filteringParams)}loadState(e){if(this.useEditor()){if(e==null)return;w.setValue(this.editor,e);return}super.loadState(e)}saveState(){return this.useEditor()?w.getValue(this.editor):super.saveState()}getEditorValue(){if(this.useEditor()){var e=w.getValue(this.editor);if(e==null||typeof e=="string"&&e.trim().length===0)throw this.argumentNull();return e}return super.getEditorValue()}initQuickFilter(e){super.initQuickFilter(e),e.type=this.editorType,e.options=xr(xr({},br(this.getEditorOptions())),br(this.get_field().quickFilterParams))}};oe=h([he("BaseEditor")],oe);var At=class extends oe{constructor(){super(Q)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}};At=h([he("Date")],At);var Wt=class extends xt{getOperators(){return this.appendNullableOperators([{key:k.isTrue},{key:k.isFalse}])}};Wt=h([he("Boolean")],Wt);var Jt=class extends oe{constructor(){super(G)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}getCriteria(){var n={};switch(this.get_operator().key){case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{{var e=this.getEditorText();n.displayText=this.displayText(this.get_operator(),[e]);var t=jl(this.getEditorValue());t=new Date(t.getFullYear(),t.getMonth(),t.getDate());var i=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1),r=[this.getCriteriaField()],a=En(t,"yyyy-MM-dd"),o=En(i,"yyyy-MM-dd");switch(this.get_operator().key){case"eq":return n.criteria=ps.join([r,">=",a],"and",[r,"<",o]),n;case"ne":return n.criteria=ps.paren(ps.join([r,"<",a],"or",[r,">",o])),n;case"lt":return n.criteria=[r,"<",a],n;case"le":return n.criteria=[r,"<",o],n;case"gt":return n.criteria=[r,">=",o],n;case"ge":return n.criteria=[r,">=",a],n}}break}}return super.getCriteria()}};Jt=h([he("DateTime")],Jt);var hr=class extends oe{constructor(){super(Ie)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}};hr=h([he("Decimal")],hr);var vt=class extends oe{constructor(){super(b)}getOperators(){var e=[];return e.push({key:k.EQ}),e.push({key:k.NE}),this.useRelative&&(e.push({key:k.LT}),e.push({key:k.LE}),e.push({key:k.GT}),e.push({key:k.GE})),this.useLike&&(e.push({key:k.contains}),e.push({key:k.startsWith})),this.appendNullableOperators(e),e}useEditor(){var e=this.get_operator().key;return e===k.EQ||e===k.NE||this.useRelative&&(e===k.LT||e===k.LE||e===k.GT||e===k.GE)}getEditorOptions(){var t;var e=super.getEditorOptions();return this.useEditor()&&this.editorType===((t=this.get_field().editorType)!=null?t:"String")&&(e=xr(e,this.get_field().editorParams)),e}createEditor(){if(this.useEditor()){var e=ht.get(this.editorType);this.editor=b.create({type:e,element:t=>t.appendTo(this.get_container()),options:this.getEditorOptions()});return}super.createEditor()}useIdField(){return this.useEditor()}initQuickFilter(e){super.initQuickFilter(e),e.type=ht.get(this.editorType)}};h([m.option()],vt.prototype,"editorType",2),h([m.option()],vt.prototype,"useRelative",2),h([m.option()],vt.prototype,"useLike",2),vt=h([he("Editor")],vt);var mr=class extends oe{constructor(){super(Rt)}getOperators(){var n=[{key:k.EQ},{key:k.NE}];return this.appendNullableOperators(n)}};mr=h([he("Enum")],mr);var gr=class extends oe{constructor(){super(Ft)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}};gr=h([he("Integer")],gr);var fr=class extends oe{constructor(){super(Vt)}getOperators(){var n=[{key:k.EQ},{key:k.NE},{key:k.contains},{key:k.startsWith}];return this.appendNullableOperators(n)}useEditor(){var n=this.get_operator().key;return n==k.EQ||n==k.NE}useIdField(){return this.useEditor()}getEditorText(){return this.useEditor()?this.editor.text:super.getEditorText()}};fr=h([he("Lookup")],fr);var yr=class extends oe{constructor(){super(Qt)}getOperators(){var n=[{key:k.EQ},{key:k.NE},{key:k.contains},{key:k.startsWith}];return this.appendNullableOperators(n)}useEditor(){var n=this.get_operator().key;return n==k.EQ||n==k.NE}useIdField(){return this.useEditor()}getEditorText(){return this.useEditor()?this.editor.text:super.getEditorText()}};yr=h([he("ServiceLookup")],yr);var vr=class extends xt{getOperators(){var n=[{key:k.contains},{key:k.startsWith},{key:k.EQ},{key:k.NE}];return this.appendNullableOperators(n)}validateEditorValue(n){return n.length===0?n:super.validateEditorValue(n)}};vr=h([he("String")],vr);var qt;(r=>{let p;function n(){if(p==null){p={};for(var a of Hl())if(Ul(Ke,a)){var o=cs(a).toLowerCase();p[o]=a;for(var l of $l.rootNamespaces)if(Kl(o,l.toLowerCase()+".")){var d=o.substr(l.length+1).toLowerCase();p[d]==null&&(p[d]=a)}}e()}}function e(){var a="filtering";for(var o of Object.keys(p))if(zl(o,a)){var l=o.substr(0,o.length-a.length);hs(l)||p[l]==null&&(p[l]=p[o])}}function t(){p=null}function i(a){if(hs(a))throw new Vn("key");n();var o=p[a.toLowerCase()];if(o==null)throw new Cr(bt("Can't find {0} filter handler type!",a));return o}r.get=i})(qt||(qt={}));var Ye=class extends N{constructor(e,t){super(e,t);this.store=new ae([]),this.onFilterStoreChanged=()=>this.filterStoreChanged(),this.store.add_changed(this.onFilterStoreChanged)}destroy(){this.store&&(this.store.remove_changed(this.onFilterStoreChanged),this.onFilterStoreChanged=null,this.store=null),super.destroy()}filterStoreChanged(){}get_store(){return this.store}set_store(e){this.store!==e&&(this.store!=null&&this.store.remove_changed(this.onFilterStoreChanged),this.store=e||new ae([]),this.store.add_changed(this.onFilterStoreChanged),this.filterStoreChanged())}};Ye=h([m.registerClass("Serenity.FilterWidgetBase")],Ye);import{cast as Xl,isEmptyOrNull as ms,localText as me,tryGetText as Qn}from"@serenity-is/corelib/q";var Xe=class extends L{constructor(n,e){var i,r;super(n);for(var t of e)this.addOption(t.name,(r=(i=Qn(t.title))!=null?i:t.title)!=null?r:t.name,t)}emptyItemText(){return ms(this.value)?me("Controls.FilterPanel.SelectField"):null}getSelect2Options(){var n=super.getSelect2Options();return n.allowClear=!1,n}};Xe=h([m.registerClass("Serenity.FilterFieldSelect")],Xe);var Ze=class extends L{constructor(n,e){var r,a;super(n);for(var t of e){var i=(a=t.title)!=null?a:(r=Qn("Controls.FilterPanel.OperatorNames."+t.key))!=null?r:t.key;this.addOption(t.key,i,t)}e.length&&e[0]&&(this.value=e[0].key)}emptyItemText(){return null}getSelect2Options(){var n=super.getSelect2Options();return n.allowClear=!1,n}};Ze=h([m.registerClass("Serenity.FilterOperatorSelect")],Ze);var Mt=class extends Ye{constructor(e){super(e);this.element.addClass("s-FilterPanel"),this.rowsDiv=this.byId("Rows"),this.initButtons(),this.updateButtons()}get_showInitialLine(){return this.showInitialLine}set_showInitialLine(e){this.showInitialLine!==e&&(this.showInitialLine=e,this.showInitialLine&&this.rowsDiv.children().length===0&&this.addEmptyRow(!1))}filterStoreChanged(){super.filterStoreChanged(),this.updateRowsFromStore()}updateRowsFromStore(){this.rowsDiv.empty();var e=this.get_store().get_items();for(var t of e){this.addEmptyRow(!1);var i=this.rowsDiv.children().last(),r=i.children("div.l");r.children(".leftparen").toggleClass("active",!!t.leftParen),r.children(".rightparen").toggleClass("active",!!t.rightParen),r.children(".andor").toggleClass("or",!!t.isOr).text(me(t.isOr?"Controls.FilterPanel.Or":"Controls.FilterPanel.And"));var a=i.children("div.f").find("input.field-select").getWidget(Xe);a.value=t.field,this.rowFieldChange(i);var o=i.children("div.o").find("input.op-select").getWidget(Ze);o.set_value(t.operator),this.rowOperatorChange(i);var l=this.getFilteringFor(i);l!=null&&(l.set_operator({key:t.operator}),l.loadState(t.state))}this.get_showInitialLine()&&this.rowsDiv.children().length===0&&this.addEmptyRow(!1),this.updateParens()}get_showSearchButton(){return this.showSearchButton}set_showSearchButton(e){this.showSearchButton!==e&&(this.showSearchButton=e,this.updateButtons())}get_updateStoreOnReset(){return this.updateStoreOnReset}set_updateStoreOnReset(e){this.updateStoreOnReset!==e&&(this.updateStoreOnReset=e)}getTemplate(){return"<div id='~_Rows' class='filter-lines'></div><div id='~_Buttons' class='buttons'><button id='~_AddButton' class='btn btn-primary add'></button><button id='~_SearchButton' class='btn btn-success search'></button><button id='~_ResetButton' class='btn btn-danger reset'></button></div><div style='clear: both'></div>"}initButtons(){this.byId("AddButton").text(me("Controls.FilterPanel.AddFilter")).click(e=>this.addButtonClick(e)),this.byId("SearchButton").text(me("Controls.FilterPanel.SearchButton")).click(e=>this.searchButtonClick(e)),this.byId("ResetButton").text(me("Controls.FilterPanel.ResetButton")).click(e=>this.resetButtonClick(e))}searchButtonClick(e){e.preventDefault(),this.search()}get_hasErrors(){return this.rowsDiv.children().children("div.v").children("span.error").length>0}search(){this.rowsDiv.children().children("div.v").children("span.error").remove();for(var e=[],t=null,i=null,r=0;r<this.rowsDiv.children().length;r++){i=this.rowsDiv.children().eq(r);var a=this.getFilteringFor(i);if(a!=null){var o=this.getFieldFor(i),l=i.children("div.o").find("input.op-select").getWidget(Ze).value;if(l==null||l.length===0){t=me("Controls.FilterPanel.InvalidOperator");break}var d={};d.field=o.name,d.operator=l,d.isOr=i.children("div.l").children("a.andor").hasClass("or"),d.leftParen=i.children("div.l").children("a.leftparen").hasClass("active"),d.rightParen=i.children("div.l").children("a.rightparen").hasClass("active"),a.set_operator({key:l});var c=a.getCriteria();d.criteria=c.criteria,d.state=a.saveState(),d.displayText=c.displayText,e.push(d)}}if(t!=null){$("<span/>").addClass("error").attr("title",t).appendTo(i.children("div.v")),i.children("div.v").find("input:first").focus();return}var u=this.get_store().get_items();u.length=0,u.push.apply(u,e),this.get_store().raiseChanged()}addButtonClick(e){this.addEmptyRow(!0),e.preventDefault()}resetButtonClick(e){e.preventDefault(),this.get_updateStoreOnReset()&&this.get_store().get_items().length>0&&(this.get_store().get_items().length=0,this.get_store().raiseChanged()),this.rowsDiv.empty(),this.updateButtons(),this.get_showInitialLine()&&this.addEmptyRow(!1)}findEmptyRow(){var e=null;return this.rowsDiv.children().each(function(t,i){var r=$(i).children("div.f").children("input.field-select").first();if(r.length===0)return!0;var a=r.val();return a==null||a.length===0?(e=$(i),!1):!0}),e}addEmptyRow(e){var t=this.findEmptyRow();if(t!=null)return t.find("input.field-select").select2("focus"),e&&t.find("input.field-select").select2("open"),t;var i=this.rowsDiv.children().last().children("a.andor").hasClass("or"),r=$("<div class='filter-line'><a class='delete'><span></span></a><div class='l'><a class='rightparen' href='#'>)</a><a class='andor' href='#'></a><a class='leftparen' href='#'>(</a></div><div class='f'><input type='hidden' class='field-select'></div><div class='o'></div><div class='v'></div><div style='clear: both'></div></div>").appendTo(this.rowsDiv),a=r.children("div.l").hide();a.children("a.leftparen, a.rightparen").click(d=>this.leftRightParenClick(d));var o=a.children("a.andor").attr("title",me("Controls.FilterPanel.ChangeAndOr"));i?o.addClass("or").text(me("Controls.FilterPanel.Or")):o.text(me("Controls.FilterPanel.And")),o.click(d=>this.andOrClick(d)),r.children("a.delete").attr("title",me("Controls.FilterPanel.RemoveField")).click(d=>this.deleteRowClick(d));var l=new Xe(r.children("div.f").children("input"),this.get_store().get_fields()).changeSelect2(d=>this.onRowFieldChange(d));return this.updateParens(),this.updateButtons(),r.find("input.field-select").select2("focus"),e&&r.find("input.field-select").select2("open"),r}onRowFieldChange(e){var t=$(e.target).closest("div.filter-line");this.rowFieldChange(t);var i=t.children("div.o").find("input.op-select");i.select2("focus")}rowFieldChange(e){e.removeData("Filtering");var t=e.children("div.f").find("input.field-select").getWidget(Xe),i=t.get_value(),r=i==null||i==="";this.removeFiltering(e),this.populateOperatorList(e),this.rowOperatorChange(e),this.updateParens(),this.updateButtons()}removeFiltering(e){e.data("Filtering",null),e.data("FilteringField",null)}populateOperatorList(e){e.children("div.o").html("");var t=this.getFilteringFor(e);if(t!=null){var i=e.children("div.o").html("<input/>").children().attr("type","hidden").addClass("op-select"),r=t.getOperators(),a=new Ze(i,r);a.changeSelect2(o=>this.onRowOperatorChange(o))}}getFieldFor(e){if(e.length===0)return null;var t=e.children("div.f").find("input.field-select").getWidget(Xe);return ms(t.value)?null:this.get_store().get_fieldByName()[t.get_value()]}getFilteringFor(e){var o;var t=this.getFieldFor(e);if(t==null)return null;var i=Xl(e.data("Filtering"),Ke);if(i!=null)return i;var r=qt.get((o=t.filteringType)!=null?o:"String"),a=e.children("div.v");return i=new r,be.set(i,t.filteringParams),i.set_container(a),i.set_field(t),e.data("Filtering",i),i}onRowOperatorChange(e){var t=$(e.target).closest("div.filter-line");this.rowOperatorChange(t);var i=t.children("div.v").find(":input:visible").first();try{i.focus()}catch(r){}}rowOperatorChange(e){if(e.length!==0){var t=e.children("div.v");t.html("");var i=this.getFilteringFor(e);if(i!=null){var r=e.children("div.o").find("input.op-select").getWidget(Ze);if(!ms(r.get_value())){var a=i.getOperators().filter(function(l){return l.key===r.value}),o=a.length>0?a[0]:null;o!=null&&(i.set_operator(o),i.createEditor())}}}}deleteRowClick(e){e.preventDefault();var t=$(e.target).closest("div.filter-line");t.remove(),this.rowsDiv.children().length===0&&this.search(),this.updateParens(),this.updateButtons()}updateButtons(){this.byId("SearchButton").toggle(this.rowsDiv.children().length>=1&&this.showSearchButton),this.byId("ResetButton").toggle(this.rowsDiv.children().length>=1)}andOrClick(e){e.preventDefault();var t=$(e.target).toggleClass("or");t.text(me("Controls.FilterPanel."+(t.hasClass("or")?"Or":"And")))}leftRightParenClick(e){e.preventDefault(),$(e.target).toggleClass("active"),this.updateParens()}updateParens(){var e=this.rowsDiv.children();if(e.length!==0){e.removeClass("paren-start"),e.removeClass("paren-end"),e.children("div.l").css("display",e.length===1?"none":"block"),e.first().children("div.l").children("a.rightparen, a.andor").css("visibility","hidden");for(var t=1;t<e.length;t++){var i=e.eq(t);i.children("div.l").css("display","block").children("a.lefparen, a.andor").css("visibility","visible")}for(var r=!1,a=0;a<e.length;a++){var o=e.eq(a),l=o.children("div.l"),d=l.children("a.leftparen"),c=l.children("a.rightparen");c.hasClass("active")&&r&&(r=!1,a>0&&e.eq(a-1).addClass("paren-end")),d.hasClass("active")&&(r=!0,a>0&&o.addClass("paren-start"))}}}};Mt=h([m.registerClass("Serenity.FilterPanel")],Mt);import{notifyError as Zl,localText as Ir}from"@serenity-is/corelib/q";var $t=class extends V{constructor(){super();this.filterPanel=new Mt(this.byId("FilterPanel")),this.filterPanel.set_showInitialLine(!0),this.filterPanel.set_showSearchButton(!1),this.filterPanel.set_updateStoreOnReset(!1),this.dialogTitle=Ir("Controls.FilterPanel.DialogTitle")}get_filterPanel(){return this.filterPanel}getTemplate(){return'<div id="~_FilterPanel"/>'}getDialogButtons(){return[{text:Ir("Dialogs.OkButton"),click:()=>{if(this.filterPanel.search(),this.filterPanel.get_hasErrors()){Zl(Ir("Controls.FilterPanel.FixErrorsMessage"),"",null);return}this.dialogClose()}},{text:Ir("Dialogs.CancelButton"),click:()=>this.dialogClose()}]}};$t=h([m.registerClass("Serenity.FilterDialog")],$t);import{localText as Sr,trimToNull as ed}from"@serenity-is/corelib/q";var zt=class extends Ye{constructor(n){super(n),this.element.find(".cap").text(Sr("Controls.FilterPanel.EffectiveFilter")),this.element.find(".edit").text(Sr("Controls.FilterPanel.EditFilter")),this.element.find(".reset").attr("title",Sr("Controls.FilterPanel.ResetFilterHint"));var e=t=>{t.preventDefault();var i=new $t;i.get_filterPanel().set_store(this.get_store()),i.dialogOpen(null)};this.element.find(".edit").click(e),this.element.find(".txt").click(e),this.element.find(".reset").click(t=>{t.preventDefault(),this.get_store().get_items().length=0,this.get_store().raiseChanged()})}filterStoreChanged(){super.filterStoreChanged();var n=ed(this.get_store().get_displayText());this.element.find(".current").toggle(n!=null),this.element.find(".reset").toggle(n!=null),n==null&&(n=Sr("Controls.FilterPanel.EffectiveEmpty")),this.element.find(".txt").text("["+n+"]")}getTemplate(){return"<div><a class='reset'></a><a class='edit'></a><div class='current'><span class='cap'></span><a class='txt'></a></div></div>"}};zt=h([m.registerClass("Serenity.FilterDisplayBar")],zt);import{htmlEncode as Tr,extend as td,localText as kr}from"@serenity-is/corelib/q";var Ht=class extends b{constructor(n,e){super(n,td({showRowsPerPage:!0,rowsPerPageOptions:[20,100,500,2e3]},e)),e=this.options;var t=e.view;if(!t)throw"SlickPager requires view option to be set!";this.element.addClass("s-SlickPager slick-pg").html('<div class="slick-pg-in"><div class="slick-pg-grp"><div class="slick-pg-first slick-pg-btn"><span class="slick-pg-btn-span"></span></div><div class="slick-pg-prev slick-pg-btn"><span class="slick-pg-btn-span"></span></div></div><div class="slick-pg-sep"></div><div class="slick-pg-grp"><span class="slick-pg-control">&nbsp;'+Tr(kr("Controls.Pager.Page"))+'&nbsp;<input class="slick-pg-current" type="text" size="4" value="1" /> / <span class="slick-pg-total"> 1 </span></span></div><div class="slick-pg-sep"></div><div class="slick-pg-grp"><div class="slick-pg-next slick-pg-btn"><span class="slick-pg-btn-span"></span></div><div class="slick-pg-last slick-pg-btn"><span class="slick-pg-btn-span"></span></div></div><div class="slick-pg-sep"></div><div class="slick-pg-grp"><div class="slick-pg-reload slick-pg-btn"><span class="slick-pg-btn-span"></span></div></div><div class="slick-pg-sep"></div><div class="slick-pg-grp"><span class="slick-pg-stat"></span></div></div>');var i=this;if($(".slick-pg-reload",this.element).click(function(){t.populate()}),$(".slick-pg-first",this.element).click(function(){i._changePage("first")}),$(".slick-pg-prev",this.element).click(function(){i._changePage("prev")}),$(".slick-pg-next",this.element).click(function(){i._changePage("next")}),$(".slick-pg-last",this.element).click(function(){i._changePage("last")}),$(".slick-pg-current",this.element).keydown(function(l){l.keyCode==13&&i._changePage("input")}),i.options.showRowsPerPage){for(var r="",a="",o=0;o<e.rowsPerPageOptions.length;o++)t.rowsPerPage==e.rowsPerPageOptions[o]?a='selected="selected"':a="",r+="<option value='"+e.rowsPerPageOptions[o]+"' "+a+" >"+e.rowsPerPageOptions[o]+"&nbsp;&nbsp;</option>";$(".slick-pg-in",this.element).prepend('<div class="slick-pg-grp"><select class="slick-pg-size" name="rp">'+r+'</select></div><div class="slick-pg-sep"></div>'),$("select.slick-pg-size",this.element).change(function(){e.onRowsPerPageChange?e.onRowsPerPageChange(+this.value):(t.newp=1,t.setPagingOptions({page:1,rowsPerPage:+this.value}))})}t.onPagingInfoChanged.subscribe(function(){i._updatePager()})}_changePage(n){var e=this.options.view;if(!e||e.loading)return!0;var t=e.getPagingInfo(),i=!t.rowsPerPage||!t.totalCount?1:Math.ceil(t.totalCount/t.rowsPerPage),r;switch(n){case"first":r=1;break;case"prev":t.page>1&&(r=parseInt(t.page)-1);break;case"next":t.page<i&&(r=parseInt(t.page)+1);break;case"last":r=i;break;case"input":var a=parseInt($("input.slick-pg-current",this.element).val());isNaN(a)||a<1?a=1:a>i&&(a=i),$(".slick-pg-current",this.element).val(a),r=a;break}if(r==t.page)return!1;this.options.onChangePage?this.options.onChangePage(r):e.setPagingOptions({page:r})}_updatePager(){var n=this.options.view,e=n.getPagingInfo(),t=!e.rowsPerPage||!e.totalCount?1:Math.ceil(e.totalCount/e.rowsPerPage);$(".slick-pg-current",this.element).val(e.page),$(".slick-pg-total",this.element).html(t);var i=(e.page-1)*e.rowsPerPage+1,r=i+e.rowsPerPage-1;e.totalCount<r&&(r=e.totalCount);var a;e.loading?a=Tr(kr("Controls.Pager.LoadingStatus")):e.error?a=e.error:e.totalCount>0?(a=Tr(kr("Controls.Pager.PageStatus")),a=a.replace(/{from}/,i),a=a.replace(/{to}/,r),a=a.replace(/{total}/,e.totalCount)):a=Tr(kr("Controls.Pager.NoRowStatus")),$(".slick-pg-stat",this.element).html(a),$(".slick-pg-size",this.element).val((e.rowsPerPage||0).toString())}};Ht=h([m.registerClass("Serenity.SlickPager")],Ht);import{Authorization as yd,clearKeys as oi,Culture as Wn,htmlEncode as Kt,isEmptyOrNull as qn,replaceAll as Jn,safeCast as vd,serviceCall as bd,startsWith as Cd,localText as Mn,tryGetText as $n}from"@serenity-is/corelib/q";import{Culture as Ln,Enum as Bn,format as Dr,formatDate as id,formatNumber as rd,getAttributes as sd,getTypeFullName as nd,htmlEncode as Oe,isEmptyOrNull as le,ISlickFormatter as Gn,parseDecimal as ad,parseISODateTime as od,replaceAll as ld,resolveUrl as An,safeCast as Nn,startsWith as dd,tryGetText as ai}from"@serenity-is/corelib/q";var tt=class{};tt=h([m.registerInterface("Serenity.IInitializeColumn")],tt);var Ut=class{format(n){var t,i;if(n.value==null)return"";var e;return n.value?(e=ai(this.trueText),e==null&&(e=this.trueText,e==null&&(e=(t=ai("Dialogs.YesButton"))!=null?t:"Yes"))):(e=ai(this.falseText),e==null&&(e=this.falseText,e==null&&(e=(i=ai("Dialogs.NoButton"))!=null?i:"No"))),Oe(e)}};h([m.option()],Ut.prototype,"falseText",2),h([m.option()],Ut.prototype,"trueText",2),Ut=h([m.registerFormatter("Serenity.BooleanFormatter")],Ut);var Or=class{format(n){return'<span class="check-box no-float readonly slick-edit-preclick '+(n.value?" checked":"")+'"></span>'}};Or=h([m.registerFormatter("Serenity.CheckboxFormatter")],Or);var ge=class{constructor(){this.displayFormat=Ln.dateFormat}static format(n,e){if(n==null)return"";var t;if(n instanceof Date)t=n;else if(typeof n=="string"){if(t=od(n),t==null)return Oe(n)}else return n.toString();return Oe(id(t,e))}format(n){return ge.format(n.value,this.displayFormat)}};h([m.option()],ge.prototype,"displayFormat",2),ge=h([m.registerFormatter("Serenity.DateFormatter")],ge);var wr=class extends ge{constructor(){super(),this.displayFormat=Ln.dateTimeFormat}};wr=h([m.registerFormatter("Serenity.DateTimeFormatter")],wr);var ke=class{format(n){return ke.format(ze.get(this.enumKey),n.value)}static format(n,e){if(e==null)return"";var t=Bn.toString(n,e),i=sd(n,U,!1),r=i.length>0?i[0].value:nd(n);return ke.getText(r,t)}static getText(n,e){var t;return le(e)?"":Oe((t=ai("Enums."+n+"."+e))!=null?t:e)}static getName(n,e){return e==null?"":Bn.toString(n,e)}};h([m.option()],ke.prototype,"enumKey",2),ke=h([m.registerFormatter("Serenity.EnumFormatter")],ke);var et=class{format(n){var a;var e=Nn(n.value,String);if(le(e))return"";var t=et.dbFileUrl(e),i=le(this.originalNameProperty)?null:Nn(n.item[this.originalNameProperty],String);i=i!=null?i:"";var r=Dr((a=this.displayFormat)!=null?a:"{0}",i,e,t);return"<a class='file-download-link' target='_blank' href='"+Oe(t)+"'>"+Oe(r)+"</a>"}static dbFileUrl(n){return n=ld(n!=null?n:"","\\","/"),An("~/upload/")+n}initializeColumn(n){if(n.referencedFields=n.referencedFields||[],!le(this.originalNameProperty)){n.referencedFields.push(this.originalNameProperty);return}}};h([m.option()],et.prototype,"displayFormat",2),h([m.option()],et.prototype,"originalNameProperty",2),et=h([m.registerFormatter("Serenity.FileDownloadFormatter",[Gn,tt])],et);var jt=class{format(n){return jt.format(n.value)}static format(n){var e=Math.floor(n/60),t=n-e*60,i,r;return n==null||isNaN(n)?"":(e<10?i="0"+e:i=e.toString(),t<10?r="0"+t:r=t.toString(),Dr("{0}:{1}",i,r))}};jt=h([m.registerFormatter("Serenity.MinuteFormatter")],jt);var Ne=class{format(n){return Ne.format(n.value,this.displayFormat)}static format(n,e){if(e=e!=null?e:"0.##",n==null)return"";if(typeof n=="number")return isNaN(n)?"":Oe(rd(n,e));var t=ad(n.toString());return t==null?"":Oe(n.toString())}};h([m.option()],Ne.prototype,"displayFormat",2),Ne=h([m.registerFormatter("Serenity.NumberFormatter")],Ne);var Be=class{format(n){var r,a,o,l;var e=le(this.urlProperty)?((a=n.value)!=null?a:"").toString():((r=n.item[this.urlProperty])!=null?r:"").toString();if(le(e))return"";le(this.urlFormat)||(e=Dr(this.urlFormat,e)),e!=null&&dd(e,"~/")&&(e=An(e));var t=le(this.displayProperty)?((l=n.value)!=null?l:"").toString():((o=n.item[this.displayProperty])!=null?o:"").toString();le(this.displayFormat)||(t=Dr(this.displayFormat,t));var i="<a href='"+Oe(e)+"'";return le(this.target)||(i+=" target='"+this.target+"'"),i+=">"+Oe(t)+"</a>",i}initializeColumn(n){if(n.referencedFields=n.referencedFields||[],!le(this.displayProperty)){n.referencedFields.push(this.displayProperty);return}if(!le(this.urlProperty)){n.referencedFields.push(this.urlProperty);return}}};h([m.option()],Be.prototype,"displayProperty",2),h([m.option()],Be.prototype,"displayFormat",2),h([m.option()],Be.prototype,"urlProperty",2),h([m.option()],Be.prototype,"urlFormat",2),h([m.option()],Be.prototype,"target",2),Be=h([m.registerFormatter("Serenity.UrlFormatter",[Gn,tt])],Be);import{ArgumentNullException as ud,Exception as pd,htmlEncode as cd,isAssignableFrom as hd,isEmptyOrNull as md,ISlickFormatter as gd,notifyError as fd}from"@serenity-is/corelib/q";var Fr;(i=>{let p=$e(r=>hd(gd,r),null,"Formatter");function n(r){if(md(r))throw new ud("key");var a=p.tryGet(r);if(a)return a;var o=`"${cd(r)}" formatter class not found! 
Make sure there is such a formatter type under the project root namespace,
and its namespace parts start with capital letters like MyProject.MyModule.MyFormatter.

If using ES modules, make sure the formatter type has a decorator like 
@Decorators.registerFormatter('MyProject.MyModule.MyFormatter') with the full name 
of your formatter type and "side-effect-import" this formatter class from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyFormatter.ts").

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw fd(o.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new pd(o)}i.get=n;function e(){p.reset()}i.reset=e;function t(r){return p.tryGet(r)}i.tryGet=t})(Fr||(Fr={}));var Pr=class{constructor(n,e){this.include={},this.grid=n,this.idField=n.getView().idField,this.options=e||{},n.getGrid().onClick.subscribe((t,i)=>{if($(t.target).hasClass("select-item")){t.preventDefault();var r=n.getView().getItem(i.row),a=r[this.idField].toString();this.include[a]?delete this.include[a]:this.include[a]=!0;for(var o=0;o<n.getView().getLength();o++)n.getGrid().updateRow(o);this.updateSelectAll()}}),n.getGrid().onHeaderClick.subscribe((t,i)=>{if(!t.isDefaultPrevented()&&$(t.target).hasClass("select-all-items")){if(t.preventDefault(),Object.keys(this.include).length>0)oi(this.include);else{var r=n.getView().getItems();for(var a of r.filter(this.isSelectable.bind(this))){var o=a[this.idField];this.include[o]=!0}}this.updateSelectAll(),n.getView().setItems(n.getView().getItems(),!0),setTimeout(this.updateSelectAll.bind(this),0)}}),n.getView().onRowsChanged.subscribe(()=>this.updateSelectAll())}updateSelectAll(){var n=this.grid.getElement().find(".select-all-header .slick-column-name .select-all-items");if(n){var e=Object.keys(this.include);n.toggleClass("checked",e.length>0&&this.grid.getView().getItems().filter(this.isSelectable.bind(this)).length<=e.length)}}clear(){oi(this.include),this.updateSelectAll()}resetCheckedAndRefresh(){this.include={},this.updateSelectAll(),this.grid.getView().populate()}selectKeys(n){for(var e of n)this.include[e]=!0;this.updateSelectAll()}getSelectedKeys(){return Object.keys(this.include)}getSelectedAsInt32(){return Object.keys(this.include).map(function(n){return parseInt(n,10)})}getSelectedAsInt64(){return Object.keys(this.include).map(function(n){return parseInt(n,10)})}setSelectedKeys(n){this.clear();for(var e of n)this.include[e]=!0;this.updateSelectAll()}isSelectable(n){return n&&(this.options.selectable==null||this.options.selectable(n))}static createSelectColumn(n){return{name:'<span class="select-all-items check-box no-float "></span>',nameIsHtml:!0,toolTip:" ",field:"__select__",width:27,minWidth:27,headerCssClass:"select-all-header",sortable:!1,format:function(e){var t=e.item,i=n();if(!i||!i.isSelectable(t))return"";var r=i.include[e.item[i.idField]];return'<span class="select-item check-box no-float '+(r?" checked":"")+'"></span>'}}}};Pr=h([m.registerClass("Serenity.GridRowSelectionMixin")],Pr);var Er=class{constructor(n,e){this.include={},this.grid=n,this.idField=n.getView().idField,this.options=e||{},n.getGrid().onClick.subscribe((t,i)=>{if($(t.target).hasClass("rad-select-item")){t.preventDefault();var r=n.getView().getItem(i.row);if(!this.isSelectable(r))return;var a=r[this.idField].toString();this.include[a]==!0?oi(this.include):(oi(this.include),this.include[a]=!0);for(var o=0;o<n.getView().getLength();o++)n.getGrid().updateRow(o)}})}isSelectable(n){return n&&(this.options.selectable==null||this.options.selectable(n))}clear(){oi(this.include)}resetCheckedAndRefresh(){this.include={},this.grid.getView().populate()}getSelectedKey(){var n=Object.keys(this.include);return n!=null&&n.length>0?n[0]:null}getSelectedAsInt32(){var n=Object.keys(this.include).map(function(e){return parseInt(e,10)});return n!=null&&n.length>0?n[0]:null}getSelectedAsInt64(){var n=Object.keys(this.include).map(function(e){return parseInt(e,10)});return n!=null&&n.length>0?n[0]:null}setSelectedKey(n){this.clear(),this.include[n]=!0}static createSelectColumn(n){return{name:"",toolTip:" ",field:"__select__",width:27,minWidth:27,headerCssClass:"",sortable:!1,formatter:function(e,t,i,r,a){var o=n();if(!o||!o.isSelectable(a))return"";var l=o.include[a[o.idField]];return'<input type="radio" name="radio-selection-group" class="rad-select-item no-float" style="cursor: pointer;width: 13px; height:13px;" '+(l?" checked":"")+" /> "}}}};Er=h([m.registerClass("GridRadioSelectionMixin")],Er);var li;(e=>{function p(t,i){var r=t.element.children(".s-Toolbar");if(r.length!==0){var a=r.getWidget(A).findButton("select-all-button"),o=t.getView().getItems();a.toggleClass("checked",o.length>0&&!o.some(function(l){return!i(l)}))}}e.update=p;function n(t,i,r,a,o,l){var d;return o==null&&(o=(d=$n("Controls.CheckTreeEditor.SelectAll"))!=null?d:"Select All"),{title:o,cssClass:"select-all-button",onClick:function(){var c=t(),u=c.getView(),g=c.element.children(".s-Toolbar").getWidget(A).findButton("select-all-button"),y=!g.hasClass("checked");u.beginUpdate();try{for(var f of u.getItems())a(f,y),u.updateItem(i(f),f);l&&l()}finally{u.endUpdate()}g.toggleClass("checked",y)}}}e.define=n})(li||(li={}));var It;(a=>{function p(o,l,d,c,u){var g=$('<div><a href="#"></a></div>').addClass("s-ToggleButton").addClass(l).prependTo(o);g.children("a").click(function(y){y.preventDefault(),g.toggleClass("pressed");var f=g.hasClass("pressed");d&&d(f)}).attr("title",c!=null?c:""),u&&g.addClass("pressed")}a.addToggleButton=p;function n(o,l,d,c){var u=!1,g=l.onSubmit;l.onSubmit=function(y){return y.params.IncludeDeleted=u,g!=null?g(y):!0},d==null&&(d=Mn("Controls.EntityGrid.IncludeDeletedToggle")),p(o,"s-IncludeDeletedToggle",function(y){u=y,l.seekToPage=1,l.populate()},d,c),o.bind("remove",function(){l.onSubmit=null,g=null})}a.addIncludeDeletedToggle=n;function e(o,l,d,c){var u=l.onSubmit,g;l.onSubmit=function(f){var S;if(g){var v=g.get_value();v&&v.length>0?f.params.ContainsText=v:delete f.params.ContainsText;var C=(S=g.get_field())==null?void 0:S.name;C!=null&&C.length>0?f.params.ContainsField=C:delete f.params.ContainsField}return u!=null?u(f):!0};var y=null;g=t(o,(f,v,C)=>{c&&c(),l.seekToPage=1,y=C,l.populate()},d),l.onDataLoaded.subscribe(function(f,v){y!=null&&(y(l.getLength()>0),y=null)})}a.addQuickSearchInput=e;function t(o,l,d){var c=$('<div><input type="text"/></div>').addClass("s-QuickSearchBar").prependTo(o);return d!=null&&d.length>0&&c.addClass("has-quick-search-fields"),new te(c.children(),{fields:d,onSearch:l})}a.addQuickSearchInputCustom=t;function i(o,l){var d=new Slick.RowMoveManager({cancelEditOnDrag:!0});d.onBeforeMoveRows.subscribe(function(c,u){for(var g=0;g<u.rows.length;g++)if(u.rows[g]===u.insertBefore||u.rows[g]===u.insertBefore-1)return c.stopPropagation(),!1;return!0}),d.onMoveRows.subscribe(function(c,u){l(u.rows,u.insertBefore);try{o.setSelectedRows([])}catch(g){}}),o.registerPlugin(d)}a.makeOrderable=i;function r(o,l,d,c,u){i(o.getGrid(),function(g,y){var O,T;if(g.length!==0){var f,v=y;v<0?f=1:y>=o.getGrid().getDataLength()?(f=(O=d(o.getGrid().getDataItem(o.getGrid().getDataLength()-1)))!=null?O:0,f===0?f=y+1:f=f+1):(f=(T=d(o.getGrid().getDataItem(y)))!=null?T:0,f===0&&(f=y+1));var C=0,S=null;S=function(){bd({service:c,request:u(l(o.getGrid().getDataItem(g[C])),f++),onSuccess:function(D){C++,C<g.length?S():o.getView().populate()}})},S()}})}a.makeOrderableWithUpdateRequest=r})(It||(It={}));var _r;(e=>{function p(t){var i=[];if(t==null)return i;for(var r=0;r<t.length;r++)i.push(e.toSlickColumn(t[r]));return i}e.toSlickColumns=p;function n(t){var d,c;var i={field:t.name,sourceItem:t,cssClass:t.cssClass,headerCssClass:t.headerCssClass,sortable:t.sortable!==!1,sortOrder:(d=t.sortOrder)!=null?d:0,width:t.width!=null?t.width:80,minWidth:(c=t.minWidth)!=null?c:30,maxWidth:t.maxWidth==null||t.maxWidth===0?null:t.maxWidth,resizable:t.resizable==null||!!t.resizable};i.visible=t.visible!==!1&&t.filterOnly!==!0&&(t.readPermission==null||yd.hasPermission(t.readPermission));var r=$n(t.title);if(r==null&&(r=t.title),i.name=r,t.alignment!=null&&t.alignment.length>0&&(qn(i.cssClass)?i.cssClass="align-"+t.alignment:i.cssClass+=" align-"+t.alignment),t.formatterType!=null&&t.formatterType.length>0){var a=Fr.get(t.formatterType),o=new a;t.formatterParams!=null&&be.set(o,t.formatterParams);var l=vd(o,tt);l!=null&&l.initializeColumn(i),i.format=u=>o.format(u)}return i}e.toSlickColumn=n})(_r||(_r={}));var we;(c=>{function p(u,g){return ke.getText(u,g)}c.getEnumText=p;function n(u,g,y){return function(f){var R,Y;var v=y(f),C=u(),S=(R=f.item._indent)!=null?R:0,O='<span class="s-TreeIndent" style="width:'+15*S+'px"></span>',T=g(f.item),D=C.getIdxById(T),x=C.getItemByIdx(D+1);if(x!=null){var I=(Y=x._indent)!=null?Y:0;if(I>S)return f.item._collapsed?O+'<span class="s-TreeToggle s-TreeExpand"></span>'+v:O+'<span class="s-TreeToggle s-TreeCollapse"></span>'+v}return O+'<span class="s-TreeToggle"></span>'+v}}c.treeToggle=n;function e(u){return u==null&&(u=Wn.dateFormat),function(g){return Kt(ge.format(g.value,u))}}c.date=e;function t(u){return u==null&&(u=Wn.dateTimeFormat),function(g){return Kt(ge.format(g.value,u))}}c.dateTime=t;function i(){return function(u){return'<span class="check-box no-float '+(u.value?" checked":"")+'"></span>'}}c.checkBox=i;function r(u){return function(g){return Ne.format(g.value,u)}}c.number=r;function a(u){return u.data("item-type")}c.getItemType=a;function o(u){var g=u.data("item-id");return g==null?null:g.toString()}c.getItemId=o;function l(u,g,y,f,v){return"<a"+(g!=null?' href="#'+Jn(u,".","-")+"/"+g+'"':"")+' data-item-type="'+Kt(u)+'" data-item-id="'+Kt(g)+'" class="s-EditLink s-'+Jn(u,".","-")+"Link"+(qn(f)?"":" "+f)+'">'+(v?Kt(y!=null?y:""):y!=null?y:"")+"</a>"}c.itemLinkText=l;function d(u,g,y,f,v){return function(C){var O,T;var S=(O=y==null?C.value:y(C))!=null?O:"";return(T=C.item)!=null&&T.__nonDataRow?v?Kt(S):S:l(u,C.item[g],y==null?C.value:y(C),f==null?"":f(C),v)}}c.itemLink=d})(we||(we={}));var Rr;(n=>{function p(e,t){for(var i of e){i.sortable=i.sortable!=null?i.sortable:!0;var r=i.id;if(r==null&&(r=i.field),i.id=r,t!=null&&i.id!=null&&(i.name==null||Cd(i.name,"~"))){var a=i.name!=null?i.name.substr(1):i.id;i.name=Mn(t+a)}}return e}n.setDefaults=p})(Rr||(Rr={}));var ie;(a=>{function p(o,l){for(var d=l(o),c=0;d!=null;){if(d._collapsed)return!1;if(d=l(d),c++>1e3)throw new Error("Possible infinite loop, check parents has no circular reference!")}return!0}a.filterCustom=p;function n(o,l,d){return p(o,function(c){var u=d(c);return u==null?null:l.getItemById(u)})}a.filterById=n;function e(o,l){if(o!=null)for(var d of o)d._collapsed=l}a.setCollapsed=e;function t(o,l){o._collapsed=l}a.setCollapsedFlag=t;function i(o,l,d,c){for(var u=0,g={},y=0;y<o.length;y++){var f=o[y];if(y>0){var v=d(f);v!=null&&v===l(o[y-1])?u+=1:v==null?u=0:v!==d(o[y-1])&&(g[v]!=null?u=g[v]+1:u=0)}g[l(f)]=u,f._indent=u,c!=null&&(f._collapsed=c)}}a.setIndents=i;function r(o,l,d,c,u){var g=$(o.target);if(g.hasClass("s-TreeToggle")&&(g.hasClass("s-TreeCollapse")||g.hasClass("s-TreeExpand"))){var y=c.getItem(l);if(y!=null&&(y._collapsed?y._collapsed=!1:y._collapsed=!0,c.updateItem(u(y),y)),o.shiftKey){c.beginUpdate();try{e(c.getItems(),!!y._collapsed),c.setItems(c.getItems(),!0)}finally{c.endUpdate()}}}}a.toggleClick=r})(ie||(ie={}));import{Authorization as gs,Criteria as xd,debounce as Id,deepClone as Sd,endsWith as fs,extend as Td,getAttributes as kd,getColumnsData as Od,getColumnsDataAsync as wd,getInstanceType as zn,getTypeFullName as Dd,htmlEncode as Fd,indexOf as Pd,isEmptyOrNull as K,isInstanceOfType as Ed,layoutFillHeight as _d,LayoutTimer as ys,ScriptData as Rd,setEquality as Vd,startsWith as Qd,trimEnd as Bd,trimToNull as Nd,tryGetText as Vr}from"@serenity-is/corelib/q";import{RemoteView as Ld}from"@serenity-is/corelib/slick";import{AutoTooltips as Gd,Grid as Ad}from"@serenity-is/sleekgrid";var B=class extends b{constructor(e,t){super(e,t);this.restoringSettings=0;var i=this;this.element.addClass("s-DataGrid").html("");var r=function(){i.layout(),i.layoutTimer!=null&&ys.store(i.layoutTimer)};this.element.addClass("require-layout").on("layout."+this.uniqueName,r),this.useLayoutTimer()&&(this.layoutTimer=ys.onSizeChange(()=>this.element&&this.element[0],Id(r,50))),this.setTitle(this.getInitialTitle());var a=this.getButtons();a!=null&&this.createToolbar(a),this.slickContainer=this.createSlickContainer(),this.view=this.createView(),this.useAsync()?this.initAsync():this.initSync()}internalInit(){var e;this.allColumns=(e=this.allColumns)!=null?e:this.getColumns(),this.slickGrid=this.createSlickGrid(),this.enableFiltering()&&this.createFilterBar(),this.usePager()&&this.createPager(),this.bindToSlickEvents(),this.bindToViewEvents(),this.toolbar&&this.createToolbarExtensions(),this.createQuickFilters(),this.updateDisabledState(),this.updateInterface(),this.initialSettings=this.getCurrentSettings(null),this.restoreSettings(null,null),window.setTimeout(()=>this.initialPopulate(),0)}initSync(){this.propertyItemsData=this.getPropertyItemsData(),this.internalInit(),this.afterInit()}initAsync(){return De(this,null,function*(){this.propertyItemsData=yield this.getPropertyItemsDataAsync(),this.internalInit(),this.afterInit()})}afterInit(){}useAsync(){return!1}useLayoutTimer(){return!0}attrs(e){return kd(zn(this),e,!0)}layout(){if(!(!this.element||!this.element.is(":visible")||!this.slickContainer||!this.slickGrid)){var e=this.element.hasClass("responsive-height"),t=this.slickGrid!=null&&this.slickGrid.getOptions().autoHeight,i=e&&window.innerWidth<768;i?(this.element[0]&&this.element[0].style.height!="auto"&&(this.element[0].style.height="auto"),t||(this.slickContainer.css("height","auto").children(".slick-pane").each((r,a)=>{a.style.height!=null&&a.style.height!="auto"&&(a.style.height="auto")}),this.slickGrid.setOptions({autoHeight:!0}))):(t&&(this.slickContainer.children(".slick-viewport").css("height","auto"),this.slickGrid.setOptions({autoHeight:!1})),_d(this.slickContainer)),this.slickGrid.resizeCanvas()}}getInitialTitle(){return null}createToolbarExtensions(){}ensureQuickFilterBar(){return this.quickFiltersDiv==null&&this.createQuickFilters([]),this.quickFiltersBar}createQuickFilters(e){this.quickFiltersDiv==null&&(e!=null||(e=this.getQuickFilters())&&e!=null&&e.length)&&(this.quickFiltersDiv=$("<div/>").addClass("quick-filters-bar"),this.toolbar?($("<div/>").addClass("clear").appendTo(this.toolbar.element),this.quickFiltersDiv.appendTo(this.toolbar.element)):this.quickFiltersDiv.appendTo($("<div/>").addClass("s-Toolbar").insertBefore(this.slickContainer)),this.quickFiltersBar=new W(this.quickFiltersDiv,{filters:e,getTitle:t=>this.determineText(i=>i+t.field),idPrefix:this.uniqueName+"_QuickFilter_"}),this.quickFiltersBar.onChange=t=>this.quickFilterChange(t))}getQuickFilters(){return this.allColumns.filter(function(e){return e.sourceItem&&e.sourceItem.quickFilter===!0&&(e.sourceItem.readPermission==null||gs.hasPermission(e.sourceItem.readPermission))}).map(e=>B.propertyItemToQuickFilter(e.sourceItem)).filter(e=>e!=null)}static propertyItemToQuickFilter(e){var g,y;var t={},i=e.name,r=Vr(e.title);r==null&&(r=e.title,r==null&&(r=i));var a=qt.get((g=e.filteringType)!=null?g:"String");if(a===At)t=W.dateRange(i,r);else if(a===Jt)t=W.dateTimeRange(i,r,(y=e.editorParams)==null?void 0:y.useUtc);else if(a===Wt){var o=e.quickFilterParams||{},l=e.filteringParams||{},d=o.trueText;d==null&&(d=l.trueText);var c=o.falseText;c==null&&(c=l.falseText),t=W.boolean(i,r,d,c)}else{var u=new a;if(u&&Ed(u,Ct))be.set(u,e.filteringParams),u.set_field(e),u.set_operator({key:k.EQ}),u.initQuickFilter(t),t.options=Td(Sd(t.options),e.quickFilterParams);else return null}return e.quickFilterSeparator&&(t.separator=!0),t.cssClass=e.quickFilterCssClass,t}findQuickFilter(e,t){return this.quickFiltersBar!=null?this.quickFiltersBar.find(e,t):$("#"+this.uniqueName+"_QuickFilter_"+t).getWidget(e)}tryFindQuickFilter(e,t){if(this.quickFiltersBar!=null)return this.quickFiltersBar.tryFind(e,t);var i=$("#"+this.uniqueName+"_QuickFilter_"+t);return i.length?i.tryGetWidget(e):null}createIncludeDeletedButton(){(!K(this.getIsActiveProperty())||!K(this.getIsDeletedProperty()))&&It.addIncludeDeletedToggle(this.toolbar.element,this.view,null,!1)}getQuickSearchFields(){return null}createQuickSearchInput(){It.addQuickSearchInput(this.toolbar.element,this.view,this.getQuickSearchFields(),()=>this.persistSettings(null))}destroy(){this.layoutTimer&&(this.layoutTimer=ys.off(this.layoutTimer)),this.quickFiltersBar&&(this.quickFiltersBar.destroy(),this.quickFiltersBar=null),this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),this.slickGrid&&(this.slickGrid.onClick.clear(),this.slickGrid.onSort.clear(),this.slickGrid.onColumnsResized.clear(),this.slickGrid.onColumnsReordered.clear(),this.slickGrid.destroy(),this.slickGrid=null),this.view&&(this.view.onDataChanged.clear(),this.view.onSubmit=null,this.view.setFilter(null),this.view=null),this.titleDiv=null,super.destroy()}getItemCssClass(e,t){var i=this.getIsActiveProperty(),r=this.getIsDeletedProperty();if(K(i)&&K(r))return null;if(i){var a=e[i];if(a==null)return null;if(typeof a=="number"){if(a<0)return"deleted";if(a===0)return"inactive"}else if(typeof a=="boolean"&&a===!1)return"deleted"}else return e[r]?"deleted":null;return null}getItemMetadata(e,t){var i=this.getItemCssClass(e,t);return K(i)?new Object:{cssClasses:i}}postProcessColumns(e){Rr.setDefaults(e,this.getLocalTextDbPrefix());var t=this.getColumnWidthDelta(),i=this.getColumnWidthScale();if(i<0&&(i=1),t!==0||i!==1)for(var r of e)typeof r.width=="number"&&(r.width=r.width*i+t),typeof r.minWidth=="number"&&(r.minWidth=r.minWidth*i+t),typeof r.maxWidth=="number"&&(r.maxWidth=r.maxWidth*i+t);return e}getColumnWidthDelta(){var e;return(e=B.defaultColumnWidthDelta)!=null?e:0}getColumnWidthScale(){var e;return(e=B.defaultColumnWidthScale)!=null?e:1}initialPopulate(){var e=this;this.populateWhenVisible()?(ve.executeEverytimeWhenShown(this.element,function(){e.refreshIfNeeded()},!1),this.element.is(":visible")&&this.view&&this.view.populate()):this.view&&this.view.populate()}canFilterColumn(e){return e.sourceItem!=null&&e.sourceItem.notFilterable!==!0&&(e.sourceItem.readPermission==null||gs.hasPermission(e.sourceItem.readPermission))}initializeFilterBar(){this.filterBar.set_store(new ae(this.allColumns.filter(e=>this.canFilterColumn(e)).map(e=>e.sourceItem))),this.filterBar.get_store().add_changed((e,t)=>{this.restoringSettings<=0&&(this.persistSettings(null),this.view&&(this.view.seekToPage=1),this.refresh())})}createSlickGrid(){var e=this.postProcessColumns(this.allColumns).filter(function(r){return r.visible!==!1}),t=this.getSlickOptions(),i=new Ad(this.slickContainer,this.view,e,t);return i.registerPlugin(new Gd({enableForHeaderCells:!0})),this.slickGrid=i,this.setInitialSortOrder(),i}setInitialSortOrder(){var e=this.getDefaultSortBy();this.view&&(this.view.sortBy=Array.prototype.slice.call(e));var t=e.map(function(i){var r;return i&&fs(i.toLowerCase()," desc")?{columnId:Bd(i.substr(0,i.length-5)),sortAsc:!1}:{columnId:i,sortAsc:!0}});this.slickGrid.setSortColumns(t)}itemAt(e){return this.slickGrid.getDataItem(e)}rowCount(){return this.slickGrid.getDataLength()}getItems(){return this.view.getItems()}setItems(e){this.view.setItems(e,!0)}bindToSlickEvents(){var e=this;this.slickGridOnSort=(t,i)=>{e.view.populateLock();try{var r=[],a;if(i.multiColumnSort)for(var o=0;o<i.sortCols.length;o++){var l=i.sortCols[o];a=l.sortCol,a==null&&(a={}),r.push(a.field+(l.sortAsc?"":" DESC"))}else{var a=i.sortCol;a==null&&(a={}),r.push(a.field+(i.sortAsc?"":" DESC"))}e.view.seekToPage=1,e.view.sortBy=r}finally{e.view.populateUnlock()}e.view.getLocalSort&&e.view.getLocalSort()?e.view.sort():e.view.populate(),this.persistSettings(null)},this.slickGrid.onSort.subscribe(this.slickGridOnSort),this.slickGridOnClick=(t,i)=>{e.onClick(t,i.row,i.cell)},this.slickGrid.onClick.subscribe(this.slickGridOnClick),this.slickGrid.onColumnsReordered.subscribe((t,i)=>this.persistSettings(null)),this.slickGrid.onColumnsResized.subscribe((t,i)=>this.persistSettings(null))}getAddButtonCaption(){var e;return(e=Vr("Controls.DataGrid.NewButton"))!=null?e:"New"}getButtons(){return[]}editItem(e){throw new Error("Not Implemented!")}editItemOfType(e,t){if(e===this.getItemType()){this.editItem(t);return}throw new Error("Not Implemented!")}onClick(e,t,i){if(!e.isDefaultPrevented()){var r=$(e.target);r.hasClass("s-EditLink")||(r=r.closest("a")),r.hasClass("s-EditLink")&&(e.preventDefault(),this.editItemOfType(we.getItemType(r),we.getItemId(r)))}}viewDataChanged(e,t){this.markupReady(),this.layout()}bindToViewEvents(){var e=this;this.view.onDataChanged.subscribe(function(t,i){return e.viewDataChanged(t,i)}),this.view.onSubmit=function(t){return e.onViewSubmit()},this.view.setFilter(function(t,i){return e.onViewFilter(t)}),this.view.onProcessData=function(t,i){return e.onViewProcessData(t)}}onViewProcessData(e){return e}onViewFilter(e){return!0}getIncludeColumns(e){var t=this.slickGrid.getColumns();for(var i of t)if(i.field&&(e[i.field]=!0),i.referencedFields)for(var r of i.referencedFields)e[r]=!0}setCriteriaParameter(){if(delete this.view.params.Criteria,this.filterBar){var e=this.filterBar.get_store().get_activeCriteria();xd.isEmpty(e)||(this.view.params.Criteria=e)}}setEquality(e,t){Vd(this.view.params,e,t)}setIncludeColumnsParameter(){var e={};this.getIncludeColumns(e);var t=[];for(var i of Object.keys(e))t.push(i);this.view.params.IncludeColumns=t}onViewSubmit(){return this.isDisabled||!this.getGridCanLoad()?!1:(this.setCriteriaParameter(),this.setIncludeColumnsParameter(),this.invokeSubmitHandlers(),!0)}markupReady(){}createSlickContainer(){return $('<div class="grid-container"></div>').appendTo(this.element)}createView(){var e=this.getViewOptions();return new Ld(e)}getDefaultSortBy(){if(this.slickGrid){var e=this.slickGrid.getColumns().filter(function(a){return a.sortOrder&&a.sortOrder!==0});if(e.length>0){e.sort(function(a,o){return Math.abs(a.sortOrder)<Math.abs(o.sortOrder)?-1:Math.abs(a.sortOrder)>Math.abs(o.sortOrder)?1:0});for(var t=[],i=0;i<e.length;i++){var r=e[i];t.push(r.field+(r.sortOrder<0?" DESC":""))}return t}}return[]}usePager(){return!1}enableFiltering(){var e=this.attrs(nt);return e.length>0&&e[0].value}populateWhenVisible(){return!1}createFilterBar(){var e=$("<div/>").appendTo(this.element);this.filterBar=new zt(e),this.initializeFilterBar()}getPagerOptions(){return{view:this.view,rowsPerPage:20,rowsPerPageOptions:[20,100,500,2500]}}createPager(){var e=$("<div></div>").appendTo(this.element);new Ht(e,this.getPagerOptions())}getViewOptions(){var e={};return e.idField=this.getIdProperty(),e.sortBy=this.getDefaultSortBy(),this.usePager()?this.element.hasClass("responsive-height")?e.rowsPerPage=$(window.window).width()<768?20:100:e.rowsPerPage=100:e.rowsPerPage=0,e.getItemMetadata=(t,i)=>this.getItemMetadata(t,i),e}createToolbar(e){var t=$('<div class="grid-toolbar"></div>').appendTo(this.element);this.toolbar=new A(t,{buttons:e,hotkeyContext:this.element[0]})}getTitle(){return this.titleDiv?this.titleDiv.children(".title-text").text():null}setTitle(e){e!==this.getTitle()&&(e==null?this.titleDiv&&(this.titleDiv.remove(),this.titleDiv=null):(this.titleDiv||(this.titleDiv=$('<div class="grid-title"><div class="title-text"></div></div>').prependTo(this.element)),this.titleDiv.children(".title-text").text(e)),this.layout())}getItemType(){return"Item"}itemLink(e,t,i,r,a=!0){return e==null&&(e=this.getItemType()),t==null&&(t=this.getIdProperty()),we.itemLink(e,t,i,r,a)}getColumnsKey(){var e=this.attrs(kt);return e&&e.length>0?e[0].value:null}getPropertyItems(){var e;return((e=this.propertyItemsData)==null?void 0:e.items)||[]}getPropertyItemsData(){var e=this.getColumnsKey();return this.getColumnsKey===B.prototype.getColumnsKey&&this.getPropertyItems!==B.prototype.getPropertyItems&&!Rd.canLoad("Columns."+e)?{items:this.getPropertyItems(),additionalItems:[]}:K(e)?{items:[],additionalItems:[]}:Od(e)}getPropertyItemsDataAsync(){return De(this,null,function*(){var e=this.getColumnsKey();return K(e)?{items:[],additionalItems:[]}:yield wd(e)})}getColumns(){return this.propertyItemsToSlickColumns(this.getPropertyItems())}propertyItemsToSlickColumns(e){for(var t=_r.toSlickColumns(e),i=0;i<e.length;i++){var r=e[i],a=t[i];if(r.editLink===!0){var o={$:a.format},l={$:r.editLinkCssClass!=null?r.editLinkCssClass:null};a.format=this.itemLink(r.editLinkItemType!=null?r.editLinkItemType:null,r.editLinkIdField!=null?r.editLinkIdField:null,function(d){return this.oldFormat.$!=null?this.oldFormat.$(d):Fd(d.value)}.bind({oldFormat:o}),function(d){var c;return(c=this.css.$)!=null?c:""}.bind({css:l}),!1),K(r.editLinkIdField)||(a.referencedFields=a.referencedFields||[],a.referencedFields.push(r.editLinkIdField))}}return t}getSlickOptions(){var e={};return e.multiSelect=!1,e.multiColumnSort=!0,e.enableCellNavigation=!1,B.defaultHeaderHeight&&(e.headerRowHeight=B.defaultHeaderHeight),B.defaultRowHeight&&(e.rowHeight=B.defaultRowHeight),e}populateLock(){this.view.populateLock()}populateUnlock(){this.view.populateUnlock()}getGridCanLoad(){return!0}refresh(){if(!this.populateWhenVisible()){this.internalRefresh();return}if(this.slickContainer.is(":visible")){this.slickContainer.data("needsRefresh",!1),this.internalRefresh();return}this.slickContainer.data("needsRefresh",!0)}refreshIfNeeded(){this.slickContainer.data("needsRefresh")&&(this.slickContainer.data("needsRefresh",!1),this.internalRefresh())}internalRefresh(){this.view.populate()}setIsDisabled(e){this.isDisabled!==e&&(this.isDisabled=e,this.isDisabled&&this.view.setItems([],!0),this.updateDisabledState())}get readOnly(){return this.get_readOnly()}set readOnly(e){this.set_readOnly(e)}get_readOnly(){return!!this._readonly}set_readOnly(e){!!this._readonly!=!!e&&(this._readonly=!!e,this.updateInterface())}updateInterface(){this.toolbar&&this.toolbar.updateInterface()}getLocalTextDbPrefix(){var e;return this.localTextDbPrefix==null&&(this.localTextDbPrefix=(e=this.getLocalTextPrefix())!=null?e:"",this.localTextDbPrefix.length>0&&!fs(this.localTextDbPrefix,".")&&(this.localTextDbPrefix="Db."+this.localTextDbPrefix+".")),this.localTextDbPrefix}getLocalTextPrefix(){var e=this.attrs(qe);return e.length>=1?e[0].value:""}getIdProperty(){if(this.idProperty==null){var e=this.attrs(We);e.length===1?this.idProperty=e[0].value:this.idProperty="ID"}return this.idProperty}getIsDeletedProperty(){return null}getIsActiveProperty(){if(this.isActiveProperty==null){var e=this.attrs(Je);e.length===1?this.isActiveProperty=e[0].value:this.isActiveProperty=""}return this.isActiveProperty}updateDisabledState(){this.slickContainer.toggleClass("ui-state-disabled",!!this.isDisabled)}resizeCanvas(){var e;(e=this.slickGrid)==null||e.resizeCanvas()}subDialogDataChange(){this.refresh()}addFilterSeparator(){this.ensureQuickFilterBar().addSeparator()}determineText(e){var t=this.getLocalTextDbPrefix();if(!K(t)){var i=Vr(e(t));if(i!=null)return i}return null}addQuickFilter(e){return this.ensureQuickFilterBar().add(e)}addDateRangeFilter(e,t){return this.ensureQuickFilterBar().addDateRange(e,t)}dateRangeQuickFilter(e,t){return W.dateRange(e,t)}addDateTimeRangeFilter(e,t){return this.ensureQuickFilterBar().addDateTimeRange(e,t)}dateTimeRangeQuickFilter(e,t){return W.dateTimeRange(e,t)}addBooleanFilter(e,t,i,r){return this.ensureQuickFilterBar().addBoolean(e,t,i,r)}booleanQuickFilter(e,t,i,r){return W.boolean(e,t,i,r)}invokeSubmitHandlers(){this.quickFiltersBar!=null&&this.quickFiltersBar.onSubmit(this.view.params)}quickFilterChange(e){this.persistSettings(null),this.view&&(this.view.seekToPage=1),this.refresh()}getPersistanceStorage(){return B.defaultPersistanceStorage}getPersistanceKey(){var e="GridSettings:",t=window.location.pathname;return K(t)||(e+=t.substr(1).split(String.fromCharCode(47)).slice(0,2).join("/")+":"),e+=Dd(zn(this)),e}gridPersistanceFlags(){return{}}canShowColumn(e){if(e==null)return!1;var t=e.sourceItem;return t==null?!0:t.filterOnly===!0?!1:t.readPermission==null?!0:gs.hasPermission(t.readPermission)}getPersistedSettings(){var e=this.getPersistanceStorage();if(e==null)return null;var t=Nd(e.getItem(this.getPersistanceKey()));return t!=null&&Qd(t,"{")&&fs(t,"}")?JSON.parse(t):null}restoreSettings(e,t){if(this.slickGrid&&!(e==null&&(e=this.getPersistedSettings(),e==null))){var i=this.slickGrid.getColumns(),r=null,a=function(X){r={};for(var de=0;de<X.length;de++){var Tt=X[de];r[Tt.id]=Tt}};this.view.beginUpdate(),this.restoringSettings++;try{if(t=t||this.gridPersistanceFlags(),e.columns!=null){if(t.columnVisibility!==!1){var o={};a(this.allColumns);for(var l=[],d=0;d<e.columns.length;d++){var c=e.columns[d];if(c.id!=null&&c.visible===!0){var u=r[c.id];this.canShowColumn(u)&&(u.visible=!0,l.push(u),delete r[c.id])}}for(var g=0;g<this.allColumns.length;g++){var y=this.allColumns[g];r[y.id]!=null&&(y.visible=!1,l.push(y))}this.allColumns=l,i=this.allColumns.filter(function(X){return X.visible===!0})}if(t.columnWidths!==!1){a(i);for(var f=0;f<e.columns.length;f++){var v=e.columns[f];if(v.id!=null&&v.width!=null&&v.width!==0){var C=r[v.id];C!=null&&(C.width=v.width)}}}if(t.sortColumns!==!1){a(i);var S=[],O=e.columns.filter(function(X){var de;return X.id!=null&&((de=X.sort)!=null?de:0)!==0});O.sort(function(X,de){return Math.abs(X.sort)-Math.abs(de.sort)});for(var T=0;T<O.length;T++){var D=O[T],x=r[D.id];x!=null&&S.push({columnId:D.id,sortAsc:D.sort>0})}this.view.sortBy=S.map(function(X){return X.columnId+(X.sortAsc===!1?" DESC":"")}),this.slickGrid.setSortColumns(S)}this.slickGrid.setColumns(i),this.slickGrid.invalidate()}if(e.filterItems!=null&&t.filterItems!==!1&&this.filterBar!=null&&this.filterBar.get_store()!=null){var I=this.filterBar.get_store().get_items();I.length=0,I.push.apply(I,e.filterItems),this.filterBar.get_store().raiseChanged()}if(e.includeDeleted!=null&&t.includeDeleted!==!1){var R=this.element.find(".s-IncludeDeletedToggle");!!e.includeDeleted!==R.hasClass("pressed")&&R.children("a").click()}if(e.quickFilters!=null&&t.quickFilters!==!1&&this.quickFiltersDiv!=null&&this.quickFiltersDiv.length>0&&this.quickFiltersDiv.find(".quick-filter-item").each((X,de)=>{var Tt=$(de).data("qffield");if(!K(Tt)){var zr=$("#"+this.uniqueName+"_QuickFilter_"+Tt).tryGetWidget(b);if(zr!=null){var Os=e.quickFilters[Tt],ws=$(de).data("qfloadstate");ws!=null?ws(zr,Os):w.setValue(zr,Os)}}}),t.quickSearch===!0&&(e.quickSearchField!==void 0||e.quickSearchText!==void 0)){var Y=this.toolbar.element.find(".s-QuickSearchInput").first();if(Y.length>0){var ks=Y.tryGetWidget(te);ks&&ks.restoreState(e.quickSearchText,e.quickSearchField)}}}finally{this.restoringSettings--,this.view.endUpdate()}}}persistSettings(e){var t=this.getPersistanceStorage();if(t){var i=this.getCurrentSettings(e);t.setItem(this.getPersistanceKey(),JSON.stringify(i))}}getCurrentSettings(e){e=e||this.gridPersistanceFlags();var t={};if(e.columnVisibility!==!1||e.columnWidths!==!1||e.sortColumns!==!1){t.columns=[];var i=this.slickGrid.getSortColumns(),r=this.slickGrid.getColumns();for(var a of r){var o={id:a.id};if(e.columnVisibility!==!1&&(o.visible=!0),e.columnWidths!==!1&&(o.width=a.width),e.sortColumns!==!1){var l=Pd(i,u=>u.columnId==a.id);o.sort=l>=0?i[l].sortAsc!==!1?l+1:-l-1:0}t.columns.push(o)}}if(e.includeDeleted!==!1&&(t.includeDeleted=this.element.find(".s-IncludeDeletedToggle").hasClass("pressed")),e.filterItems!==!1&&this.filterBar!=null&&this.filterBar.get_store()!=null&&(t.filterItems=this.filterBar.get_store().get_items().slice()),e.quickSearch===!0){var d=this.toolbar.element.find(".s-QuickSearchInput").first();if(d.length>0){var c=d.tryGetWidget(te);c!=null&&(t.quickSearchField=c.get_field(),t.quickSearchText=c.element.val())}}return e.quickFilters!==!1&&this.quickFiltersDiv!=null&&this.quickFiltersDiv.length>0&&(t.quickFilters={},this.quickFiltersDiv.find(".quick-filter-item").each((u,g)=>{var D;var y=$(g).data("qffield");if(!K(y)){var f=$("#"+this.uniqueName+"_QuickFilter_"+y).tryGetWidget(b);if(f!=null){var v=$(g).data("qfsavestate"),C=v!=null?v(f):w.getValue(f);if(t.quickFilters[y]=C,e.quickFilterText===!0&&$(g).hasClass("quick-filter-active")){var S=$(g).data("qfdisplaytext"),O=$(g).find(".quick-filter-label").text(),T;S!=null?T=S(f,O):T=O+" = "+w.getDisplayText(f),K(T)||(K(t.quickFilterText)?t.quickFilterText=T:(t.quickFilterText+=" "+((D=Vr("Controls.FilterPanel.And"))!=null?D:"and")+" ",t.quickFilterText+=T))}}}})),t}getElement(){return this.element}getGrid(){return this.slickGrid}getView(){return this.view}getFilterStore(){return this.filterBar==null?null:this.filterBar.get_store()}};B=h([m.registerClass("Serenity.DataGrid",[E]),m.element("<div/>")],B);import{Authorization as Wd,centerDialog as Jd,Culture as qd,htmlEncode as di,Router as vs,localText as Le,trimToNull as Md}from"@serenity-is/corelib/q";var it=class extends V{constructor(){super();new te(this.byId("Search"),{onSearch:(e,t,i)=>{t=Md(t),t!=null&&(t=Select2.util.stripDiacritics(t.toLowerCase())),this.element.find("li").each((r,a)=>{$(a).toggle(!t||Select2.util.stripDiacritics($(a).text().toLowerCase()).indexOf(t)>=0)}),i&&i(!0)}}),this.ulVisible=this.byId("VisibleCols"),this.ulHidden=this.byId("HiddenCols"),this.dialogTitle=Le("Controls.ColumnPickerDialog.Title")}static createToolButton(e){function t(){var i=new it;if(i.allColumns=e.allColumns,e.initialSettings){var r=e.initialSettings;r.columns&&r.columns.length&&(i.defaultColumns=r.columns.map(a=>a.id))}i.visibleColumns=e.getGrid().getColumns().map(a=>a.id),i.done=()=>{e.allColumns=i.allColumns;var a=i.allColumns.filter(o=>o.visible===!0);e.getGrid().setColumns(a),e.persistSettings(),e.getView().populate()},vs&&vs.dialog&&vs.dialog(e.element,i.element,()=>"columns"),i.dialogOpen()}return e.element.on("handleroute."+e.uniqueName,(i,r)=>{r&&!r.handled&&r.route=="columns"&&t()}),{hint:Le("Controls.ColumnPickerDialog.Title"),cssClass:"column-picker-button",icon:"fa-th-list text-blue",onClick:t}}getDialogButtons(){return[{text:Le("Controls.ColumnPickerDialog.RestoreDefaults"),click:()=>{let e={};this.ulVisible.children().add(this.ulHidden.children()).each((i,r)=>{let a=$(r);e[a.data("key")]=a});let t=null;for(let i of this.defaultColumns){let r=e[i];if(!r)continue;t==null?r.prependTo(this.ulVisible):r.insertAfter(t),t=r;let a=r.data("key");delete e[a]}for(let i in e)e[i].appendTo(this.ulHidden);this.updateListStates()}},{text:Le("Dialogs.OkButton"),click:()=>{let e=[];for(var t of this.allColumns)t.visible=!1;this.visibleColumns=this.ulVisible.children().toArray().map(i=>{let r=$(i).data("key");var a=this.colById[r];return a.visible=!0,e.push(a),r});for(var t of this.allColumns)t.visible||e.push(t);this.allColumns=e,this.done&&this.done(),this.dialogClose()}},{text:Le("Dialogs.CancelButton"),click:()=>{this.dialogClose()}}]}getDialogOptions(){var e=super.getDialogOptions();return e.width=600,e}getTitle(e){return e.id=="__select__"?"[x]":e.name||e.toolTip||e.id}allowHide(e){return e.sourceItem==null||e.sourceItem.allowHide==null||e.sourceItem.allowHide}createLI(e){var t=this.allowHide(e);return $(`
<li data-key="${e.id}" class="${t?"":"cant-hide"}">
<span class="drag-handle">\u2630</span>
${di(this.getTitle(e))}
${t?`<i class="js-hide fa fa-eye-slash" title="${di(Le("Controls.ColumnPickerDialog.HideHint"))}"></i>`:""}
<i class="js-show fa fa-eye" title="${di(Le("Controls.ColumnPickerDialog.ShowHint"))}"></i>
</li>`)}updateListStates(){this.ulVisible.children().removeClass("bg-info").addClass("bg-success"),this.ulHidden.children().removeClass("bg-success").addClass("bg-info")}setupColumns(){this.allColumns=this.allColumns||[],this.visibleColumns=this.visibleColumns||[];let e={};for(let a of this.visibleColumns)e[a]=!0;this.colById={};for(let a of this.allColumns)this.colById[a.id]=a;this.defaultColumns==null&&(this.defaultColumns=this.visibleColumns.slice(0));let t=[];for(let a of this.allColumns)!e[a.id]&&(!a.sourceItem||a.sourceItem.filterOnly!==!0&&(a.sourceItem.readPermission==null||Wd.hasPermission(a.sourceItem.readPermission)))&&t.push(a);let i=t.sort((a,o)=>qd.stringCompare(this.getTitle(a),this.getTitle(o)));for(let a of this.visibleColumns){var r=this.colById[a];r&&this.createLI(r).appendTo(this.ulVisible)}for(let a of i)this.createLI(a).appendTo(this.ulHidden);this.updateListStates(),typeof Sortable!="undefined"&&Sortable.create&&(Sortable.create(this.ulVisible[0],{group:this.uniqueName+"_group",filter:".js-hide",onFilter:a=>{$(a.item).appendTo(this.ulHidden),this.updateListStates()},onMove:a=>!($(a.dragged).hasClass("cant-hide")&&a.from==this.ulVisible[0]&&a.to!==a.from),onEnd:a=>this.updateListStates()}),Sortable.create(this.ulHidden[0],{group:this.uniqueName+"_group",sort:!1,filter:".js-show",onFilter:a=>{$(a.item).appendTo(this.ulVisible),this.updateListStates()},onEnd:()=>this.updateListStates()}))}onDialogOpen(){super.onDialogOpen(),this.element.find("input").removeAttr("disabled"),this.element.closest(".ui-dialog").children(".ui-dialog-buttonpane").find("button").eq(0).addClass("restore-defaults").next().focus(),this.setupColumns(),Jd(this.element)}getTemplate(){return`
<div class="search"><input id="~_Search" type="text" disabled /></div>
<div class="columns-container">
<div class="column-list visible-list bg-success">
<h5><i class="fa fa-eye"></i> ${di(Le("Controls.ColumnPickerDialog.VisibleColumns"))}</h5>
<ul id="~_VisibleCols"></ul>
</div>
<div class="column-list hidden-list bg-info">
<h5><i class="fa fa-eye-slash"></i> ${di(Le("Controls.ColumnPickerDialog.HiddenColumns"))}</h5>
<ul id="~_HiddenCols"></ul>
</div>
</div>`}};it=h([m.registerClass("Serenity.ColumnPickerDialog"),m.resizable(),m.responsive()],it);import{htmlEncode as $d,toGrouping as Hn,tryFirst as zd}from"@serenity-is/corelib/q";var Qr=class{constructor(n){this.options=n;var e=this.dataGrid=n.grid,t=e.getIdProperty(),i=this.getId=l=>l[t];e.element.find(".grid-container").on("click",l=>{if($(l.target).hasClass("s-TreeToggle")){var d=e.slickGrid.getCellFromEvent(l);d.cell>=0&&d.row>=0&&ie.toggleClick(l,d.row,d.row,e.view,i)}});var r=e.onViewFilter;e.onViewFilter=function(l){return r.apply(this,[l])?ie.filterById(l,e.view,n.getParentId):!1};var a=e.onViewProcessData;if(e.onViewProcessData=function(l){return l=a.apply(this,[l]),l.Entities=Qr.applyTreeOrdering(l.Entities,i,n.getParentId),ie.setIndents(l.Entities,i,n.getParentId,n.initialCollapse&&n.initialCollapse()||!1),l},n.toggleField){var o=zd(e.allColumns||e.slickGrid.getColumns()||[],l=>l.field==n.toggleField);o&&(o.format=we.treeToggle(()=>e.view,i,o.format||(l=>$d(l.value))))}}toggleAll(){ie.setCollapsed(this.dataGrid.view.getItems(),!this.dataGrid.view.getItems().every(n=>n._collapsed==!0)),this.dataGrid.view.setItems(this.dataGrid.view.getItems(),!0)}collapseAll(){ie.setCollapsed(this.dataGrid.view.getItems(),!0),this.dataGrid.view.setItems(this.dataGrid.view.getItems(),!0)}expandAll(){ie.setCollapsed(this.dataGrid.view.getItems(),!1),this.dataGrid.view.setItems(this.dataGrid.view.getItems(),!0)}static applyTreeOrdering(n,e,t){var i=[],r=Hn(n,e),a=Hn(n,t),o={};function l(u){if(!o[u]){o[u]=!0;for(var g of a[u]||[])i.push(g),l(e(g))}}for(var d of n){var c=t(d);(c==null||!(r[c]||[]).length)&&(i.push(d),l(e(d)))}return i}};import{Culture as Hd,getLookup as Ud,htmlEncode as jd,isEmptyOrNull as Yt,ScriptData as Kd,trimToNull as Yd,tryGetText as Xd}from"@serenity-is/corelib/q";var ui=class extends B{constructor(e,t){super(e,t);e.addClass("s-CheckTreeEditor"),this.updateItems()}getIdProperty(){return"id"}getTreeItems(){return[]}updateItems(){for(var e=this.getTreeItems(),t={},i=0;i<e.length;i++){var r=e[i];if(r.children=[],Yt(r.id)||(t[r.id]=r),!Yt(r.parentId)){var a=t[r.parentId];a!=null&&a.children.push(r)}}this.view.addData({Entities:e,Skip:0,Take:0,TotalCount:e.length}),this.updateSelectAll(),this.updateFlags()}getEditValue(e,t){this.getDelimited()?t[e.name]=this.get_value().join(","):t[e.name]=this.get_value()}setEditValue(e,t){var i=e[t.name];this.set_value(i)}getButtons(){var e=this.getSelectAllText();if(Yt(e))return null;var t=this,i=[];return i.push(li.define(function(){return t},function(r){return r.id},function(r){return r.isSelected},(r,a)=>{r.isSelected!==a&&(r.isSelected=a,this.itemSelectedChanged(r))},null,()=>{this.updateFlags()})),i}itemSelectedChanged(e){}getSelectAllText(){var e;return(e=Xd("Controls.CheckTreeEditor.SelectAll"))!=null?e:"Select All"}isThreeStateHierarchy(){return!1}createSlickGrid(){this.element.addClass("slick-no-cell-border").addClass("slick-no-odd-even");var e=super.createSlickGrid();return this.element.addClass("slick-hide-header"),e.resizeCanvas(),e}onViewFilter(e){if(!super.onViewFilter(e))return!1;var t=this.view.getItems(),i=this;return ie.filterCustom(e,function(r){if(r.parentId==null)return null;if(i.byId==null){i.byId={};for(var a=0;a<t.length;a++){var o=t[a];o.id!=null&&(i.byId[o.id]=o)}}return i.byId[r.parentId]})}getInitialCollapse(){return!1}onViewProcessData(e){return e=super.onViewProcessData(e),this.byId=null,ie.setIndents(e.Entities,function(t){return t.id},function(t){return t.parentId},this.getInitialCollapse()),e}onClick(e,t,i){if(super.onClick(e,t,i),e.isDefaultPrevented()||ie.toggleClick(e,t,i,this.view,function(d){return d.id}),!e.isDefaultPrevented()){var r=$(e.target);if(r.hasClass("check-box")){if(e.preventDefault(),this._readOnly)return;var a=r.hasClass("checked")||r.hasClass("partial"),o=this.itemAt(t),l=o.isSelected!==!a;this.view.beginUpdate();try{o.isSelected!==!a&&(o.isSelected=!a,this.view.updateItem(o.id,o),this.itemSelectedChanged(o)),l=this.setAllSubTreeSelected(o,o.isSelected)||l,this.updateSelectAll(),this.updateFlags()}finally{this.view.endUpdate()}l&&this.element.triggerHandler("change")}}}updateSelectAll(){li.update(this,function(e){return e.isSelected})}updateFlags(){var e=this.view,t=e.getItems(),i=this.isThreeStateHierarchy();if(i){e.beginUpdate();try{for(var r=0;r<t.length;r++){var a=t[r];if(a.children==null||a.children.length===0){var o=this.getDescendantsSelected(a);o!==a.isAllDescendantsSelected&&(a.isAllDescendantsSelected=o,e.updateItem(a.id,a));continue}var l=this.allDescendantsSelected(a),d=l||this.anyDescendantsSelected(a);if(l!==a.isAllDescendantsSelected||d!==a.isSelected){var c=a.isSelected!==d;a.isAllDescendantsSelected=l,a.isSelected=d,e.updateItem(a.id,a),c&&this.itemSelectedChanged(a)}}}finally{e.endUpdate()}}}getDescendantsSelected(e){return!0}setAllSubTreeSelected(e,t){for(var i=!1,r=0;r<e.children.length;r++){var a=e.children[r];a.isSelected!==t&&(i=!0,a.isSelected=t,this.view.updateItem(a.id,a),this.itemSelectedChanged(a)),a.children.length>0&&(i=this.setAllSubTreeSelected(a,t)||i)}return i}allItemsSelected(){for(var e=0;e<this.rowCount();e++){var t=this.itemAt(e);if(!t.isSelected)return!1}return this.rowCount()>0}allDescendantsSelected(e){if(e.children.length>0)for(var t=0;t<e.children.length;t++){var i=e.children[t];if(!i.isSelected||!this.allDescendantsSelected(i))return!1}return!0}getDelimited(){return!!this.options.delimited}anyDescendantsSelected(e){if(e.children.length>0)for(var t=0;t<e.children.length;t++){var i=e.children[t];if(i.isSelected||this.anyDescendantsSelected(i))return!0}return!1}getColumns(){var e=this,t=[];return t.push({field:"text",name:"Kay\u0131t",width:80,format:we.treeToggle(function(){return e.view},function(i){return i.id},i=>{var r="check-box",a=i.item;if(a.hideCheckBox)return this.getItemText(i);var o=this.isThreeStateHierarchy();return a.isSelected&&(o&&!a.isAllDescendantsSelected?r+=" partial":r+=" checked"),this._readOnly&&(r+=" readonly"),'<span class="'+r+'"></span>'+this.getItemText(i)})}),t}getItemText(e){return jd(e.value)}getSlickOptions(){var e=super.getSlickOptions();return e.forceFitColumns=!0,e}sortItems(){if(this.moveSelectedUp()){for(var e={},t=this.view.getItems(),i=0,r=0;r<t.length;r++){var a=t[r];e[a.id]=i++}t.sort(function(o,l){if(o.isSelected&&!l.isSelected)return-1;if(l.isSelected&&!o.isSelected)return 1;var d=Hd.stringCompare(o.text,l.text);return d!==0?d:e[o.id]<e[l.id]?-1:e[o.id]>e[l.id]?1:0}),this.view.setItems(t,!0)}}moveSelectedUp(){return!1}get_readOnly(){return this._readOnly}set_readOnly(e){!!this._readOnly!=!!e&&(this._readOnly=!!e,this.view.refresh())}get_value(){for(var e=[],t=this.view.getItems(),i=0;i<t.length;i++)t[i].isSelected&&e.push(t[i].id);return e}get value(){return this.get_value()}set_value(e){var t={};if(e!=null){typeof e=="string"&&(e=e.split(",").map(d=>Yd(d)).filter(d=>d!=null));for(var i=0;i<e.length;i++)t[e[i]]=!0}this.view.beginUpdate();try{for(var r=this.view.getItems(),a=0;a<r.length;a++){var o=r[a],l=t[o.id];l!==o.isSelected&&(o.isSelected=l,this.view.updateItem(o.id,o))}this.updateSelectAll(),this.updateFlags(),this.sortItems()}finally{this.view.endUpdate()}}set value(e){this.set_value(e)}};ui=h([m.registerEditor("Serenity.CheckTreeEditor",[J,q,E]),m.element("<div/>")],ui);var Br=class extends ui{constructor(e,t){super(e,t);this.enableUpdateItems=!0,this.setCascadeFrom(this.options.cascadeFrom),this.updateItems(),Kd.bindToChange("Lookup."+this.getLookupKey(),this.uniqueName,()=>this.updateItems())}updateItems(){this.enableUpdateItems&&super.updateItems()}getLookupKey(){return this.options.lookupKey}getButtons(){var e;return(e=super.getButtons())!=null?e:this.options.hideSearch?null:[]}createToolbarExtensions(){super.createToolbarExtensions(),It.addQuickSearchInputCustom(this.toolbar.element,(e,t)=>{this.searchText=Select2.util.stripDiacritics(t||"").toUpperCase(),this.view.setItems(this.view.getItems(),!0)})}getSelectAllText(){return this.options.showSelectAll?super.getSelectAllText():null}cascadeItems(e){var t=this.get_cascadeValue();if(t==null||t==="")return Yt(this.get_cascadeField())?e:[];var i=t.toString(),r=this.get_cascadeField();return e.filter(a=>{var l;var o=(l=a[r])!=null?l:re.getPropertyValue(a,r);return o!=null&&o.toString()===i})}filterItems(e){var t=this.get_filterValue();if(t==null||t==="")return e;var i=t.toString(),r=this.get_filterField();return e.filter(a=>{var l;var o=(l=a[r])!=null?l:re.getPropertyValue(a,r);return o!=null&&o.toString()===i})}getLookupItems(e){return this.filterItems(this.cascadeItems(e.items))}getTreeItems(){var e=Ud(this.options.lookupKey),t=this.getLookupItems(e);return t.map(i=>{var r,a;return{id:((r=i[e.idField])!=null?r:"").toString(),text:((a=i[e.textField])!=null?a:"").toString(),source:i}})}onViewFilter(e){return super.onViewFilter(e)&&(Yt(this.searchText)||Select2.util.stripDiacritics(e.text||"").toUpperCase().indexOf(this.searchText)>=0)}moveSelectedUp(){return this.options.checkedOnTop}get_cascadeFrom(){return this.options.cascadeFrom}get cascadeFrom(){return this.get_cascadeFrom()}getCascadeFromValue(e){return w.getValue(e)}setCascadeFrom(e){if(Yt(e)){this.cascadeLink!=null&&(this.cascadeLink.set_parentID(null),this.cascadeLink=null),this.options.cascadeFrom=null;return}this.cascadeLink=new Ue(b,this,t=>{this.set_cascadeValue(this.getCascadeFromValue(t))}),this.cascadeLink.set_parentID(e),this.options.cascadeFrom=e}set_cascadeFrom(e){e!==this.options.cascadeFrom&&(this.setCascadeFrom(e),this.updateItems())}set cascadeFrom(e){this.set_cascadeFrom(e)}get_cascadeField(){var e;return(e=this.options.cascadeField)!=null?e:this.options.cascadeFrom}get cascadeField(){return this.get_cascadeField()}set_cascadeField(e){this.options.cascadeField=e}set cascadeField(e){this.set_cascadeField(e)}get_cascadeValue(){return this.options.cascadeValue}get cascadeValue(){return this.get_cascadeValue()}set_cascadeValue(e){this.options.cascadeValue!==e&&(this.options.cascadeValue=e,this.value=[],this.updateItems())}set cascadeValue(e){this.set_cascadeValue(e)}get_filterField(){return this.options.filterField}get filterField(){return this.get_filterField()}set_filterField(e){this.options.filterField=e}set filterField(e){this.set_filterField(e)}get_filterValue(){return this.options.filterValue}get filterValue(){return this.get_filterValue()}set_filterValue(e){this.options.filterValue!==e&&(this.options.filterValue=e,this.value=null,this.updateItems())}set filterValue(e){this.set_filterValue(e)}};Br=h([m.registerEditor("Serenity.CheckLookupEditor")],Br);import{Authorization as Zd,endsWith as Un,format as bs,getInstanceType as Cs,getTypeFullName as xs,isEmptyOrNull as eu,LT as jn,replaceAll as tu,resolveUrl as iu,Router as Nr,safeCast as Kn,localText as Is,tryGetText as Yn}from"@serenity-is/corelib/q";var Lr=class extends B{constructor(e,t){super(e,t);this.element.addClass("route-handler").on("handleroute."+this.uniqueName,(i,r)=>this.handleRoute(r))}handleRoute(e){if(!e.handled){if(e.route==="new"){e.handled=!0,this.addButtonClick();return}var t=jQuery.active,i=e.route.split("/");if(i.length===2&&i[0]==="edit")e.handled=!0,this.editItem(decodeURIComponent(i[1]));else if(i.length===2&&i[1]==="new")e.handled=!0,this.editItemOfType(i[0],null);else if(i.length===3&&i[1]==="edit")e.handled=!0,this.editItemOfType(i[0],decodeURIComponent(i[2]));else return;jQuery.active>t&&e.handled&&e.index>=0&&e.index<e.parts.length-1&&$(document).one("ajaxStop",()=>{setTimeout(()=>Nr.resolve("#"+e.parts.join("/+/")),1)})}}usePager(){return!0}createToolbarExtensions(){this.createIncludeDeletedButton(),this.createQuickSearchInput()}getInitialTitle(){return this.getDisplayName()}getLocalTextPrefix(){var e=super.getLocalTextPrefix();return eu(e)?this.getEntityType():e}getEntityType(){if(this.entityType!=null)return this.entityType;var e=this.attrs(Ae);if(e.length===1)return this.entityType=e[0].value;var t=xs(Cs(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),Un(t,"Grid")?t=t.substr(0,t.length-4):Un(t,"SubGrid")&&(t=t.substr(0,t.length-7)),this.entityType=t,this.entityType}getDisplayName(){if(this.displayName!=null)return this.displayName;var e=this.attrs(Fe);return e.length>=1?(this.displayName=e[0].displayName,this.displayName=jn.getDefault(this.displayName,this.displayName)):(this.displayName=Yn(this.getLocalTextDbPrefix()+"EntityPlural"),this.displayName==null&&(this.displayName=this.getEntityType())),this.displayName}getItemName(){if(this.itemName!=null)return this.itemName;var e=this.attrs(Pe);return e.length>=1?(this.itemName=e[0].value,this.itemName=jn.getDefault(this.itemName,this.itemName)):(this.itemName=Yn(this.getLocalTextDbPrefix()+"EntitySingular"),this.itemName==null&&(this.itemName=this.getEntityType())),this.itemName}getAddButtonCaption(){return bs(Is("Controls.EntityGrid.NewButton"),this.getItemName())}getButtons(){var e=[];return e.push({title:this.getAddButtonCaption(),cssClass:"add-button",icon:"fa-plus-circle text-green",hotkey:"alt+n",onClick:()=>{this.addButtonClick()},disabled:()=>!this.hasInsertPermission()||this.readOnly}),e.push(this.newRefreshButton(!0)),e.push(it.createToolButton(this)),e}newRefreshButton(e){return{title:e?null:Is("Controls.EntityGrid.RefreshButton"),hint:e?Is("Controls.EntityGrid.RefreshButton"):null,icon:"fa-refresh text-blue",cssClass:"refresh-button",onClick:()=>{this.refresh()}}}addButtonClick(){this.editItem(new Object)}editItem(e){this.createEntityDialog(this.getItemType(),t=>{var i=Kn(t,Re);if(i!=null){i.load(e,()=>{i.dialogOpen(this.openDialogsAsPanel)});return}throw new Error(bs("{0} doesn't implement IEditDialog!",xs(Cs(t))))})}editItemOfType(e,t){if(e===this.getItemType()){this.editItem(t);return}this.createEntityDialog(e,i=>{var r=Kn(i,Re);if(r!=null){r.load(t,()=>r.dialogOpen(this.openDialogsAsPanel));return}throw new Error(bs("{0} doesn't implement IEditDialog!",xs(Cs(i))))})}getService(){if(this.service!=null)return this.service;var e=this.attrs(Ee);return e.length>=1?this.service=e[0].value:this.service=tu(this.getEntityType(),".","/"),this.service}getViewOptions(){var e=super.getViewOptions();return e.url=iu("~/Services/"+this.getService()+"/List"),e}getItemType(){return this.getEntityType()}routeDialog(e,t){Nr&&Nr.dialog&&Nr.dialog(this.element,t.element,()=>{var i="";return e!==this.getItemType()&&(i=e+"/"),t!=null&&t.entityId!=null?i+="edit/"+t.entityId.toString():i+="new",i})}getInsertPermission(){return null}hasInsertPermission(){var e=this.getInsertPermission();return e==null||Zd.hasPermission(this.getInsertPermission())}transferDialogReadOnly(e){this.readOnly&&w.setReadOnly(e,!0)}initDialog(e){xe.bindToDataChange(e,this,(t,i)=>{this.subDialogDataChange()},!0),this.transferDialogReadOnly(e),this.routeDialog(this.getItemType(),e)}initEntityDialog(e,t){if(e===this.getItemType()){this.initDialog(t);return}xe.bindToDataChange(t,this,(i,r)=>{this.subDialogDataChange()},!0),this.transferDialogReadOnly(t),this.routeDialog(e,t)}createEntityDialog(e,t){var i=this.getDialogTypeFor(e),r=b.create({type:i,options:this.getDialogOptionsFor(e),init:a=>{this.initEntityDialog(e,a),t&&t(a)}});return r}getDialogOptions(){return{}}getDialogOptionsFor(e){return e===this.getItemType()?this.getDialogOptions():{}}getDialogTypeFor(e){return e===this.getItemType()?this.getDialogType():ct.get(e)}getDialogType(){if(this.dialogType!=null)return this.dialogType;var e=this.attrs(rt);return e.length>=1?this.dialogType=e[0].value:this.dialogType=ct.get(this.getEntityType()),this.dialogType}};Lr=h([m.registerClass("Serenity.EntityGrid")],Lr);import{any as ru,Authorization as Ss,confirmDialog as Xn,endsWith as Gr,Exception as su,extend as St,format as Zn,getAttributes as nu,getFormData as au,getFormDataAsync as ou,getInstanceType as Ts,getTypeFullName as lu,isArray as du,isEmptyOrNull as Xt,LT as uu,notifySuccess as pu,replaceAll as cu,safeCast as hu,ScriptData as mu,serviceCall as pi,startsWith as gu,localText as z,tryGetText as fu,validatorAbortHandler as ea}from"@serenity-is/corelib/q";var Ge=class extends V{constructor(e){super(e);this.useAsync()?this.initAsync():this.initSync()}internalInit(){this.initPropertyGrid(),this.initLocalizationGrid()}initSync(){this.propertyItemsData=this.getPropertyItemsData(),this.internalInit(),this.afterInit()}initAsync(){return De(this,null,function*(){this.propertyItemsData=yield this.getPropertyItemsDataAsync(),this.internalInit(),this.afterInit()})}afterInit(){}useAsync(){return!1}destroy(){this.propertyGrid&&(this.propertyGrid.destroy(),this.propertyGrid=null),this.localizationGrid&&(this.localizationGrid.destroy(),this.localizationGrid=null),this.undeleteButton=null,this.applyChangesButton=null,this.deleteButton=null,this.saveAndCloseButton=null,this.editButton=null,this.cloneButton=null,this.toolbar=null,super.destroy()}get_entity(){return this.entity}set_entity(e){this.entity=e||new Object}get_entityId(){return this.entityId}set_entityId(e){this.entityId=e}getEntityNameFieldValue(){var e;return((e=this.get_entity()[this.getNameProperty()])!=null?e:"").toString()}getEntityTitle(){var i;if(this.isEditMode()){var e=this.isViewMode()||this.readOnly||!this.hasSavePermission()?z("Controls.EntityDialog.ViewRecordTitle"):z("Controls.EntityDialog.EditRecordTitle"),t=(i=this.getEntityNameFieldValue())!=null?i:"";return Zn(e,this.getEntitySingular(),Xt(t)?"":" ("+t+")")}else return Zn(z("Controls.EntityDialog.NewRecordTitle"),this.getEntitySingular())}updateTitle(){this.dialogTitle=this.getEntityTitle()}isCloneMode(){return!1}isEditMode(){return this.get_entityId()!=null&&!this.isCloneMode()}isDeleted(){if(this.get_entityId()==null)return!1;var e=this.getIsDeletedProperty();if(e)return!!this.get_entity()[e];var t=this.get_entity()[this.getIsActiveProperty()];return t==null?!1:t<0}isNew(){return this.get_entityId()==null}isNewOrDeleted(){return this.isNew()||this.isDeleted()}getDeleteOptions(e){return{}}deleteHandler(e,t){pi(e)}doDelete(e){var t=this,i={EntityId:this.get_entityId()},r={service:this.getService()+"/Delete",request:i,onSuccess:l=>{t.onDeleteSuccess(l),e!=null&&e(l),t.element.triggerHandler("ondatachange",[{entityId:i.EntityId,entity:this.entity,type:"delete"}])}},a=this.getDeleteOptions(e),o=St(r,a);this.deleteHandler(o,e)}onDeleteSuccess(e){}attrs(e){return nu(Ts(this),e,!0)}getEntityType(){if(this.entityType!=null)return this.entityType;var e=this.attrs(Ae);if(e.length===1)return this.entityType=e[0].value;var t=lu(Ts(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),Gr(t,"Dialog")||Gr(t,"Control")?t=t.substr(0,t.length-6):Gr(t,"Panel")&&(t=t.substr(0,t.length-5)),this.entityType=t}getFormKey(){if(this.formKey!=null)return this.formKey;var e=this.attrs(fe);return e.length>=1?this.formKey=e[0].value:this.formKey=this.getEntityType()}getLocalTextDbPrefix(){var e;return this.localTextDbPrefix!=null?this.localTextDbPrefix:(this.localTextDbPrefix=(e=this.getLocalTextPrefix())!=null?e:"",this.localTextDbPrefix.length>0&&!Gr(this.localTextDbPrefix,".")&&(this.localTextDbPrefix="Db."+this.localTextDbPrefix+"."),this.localTextDbPrefix)}getLocalTextPrefix(){var e=this.attrs(qe);return e.length>=1?e[0].value:this.getEntityType()}getEntitySingular(){if(this.entitySingular!=null)return this.entitySingular;var e=this.attrs(Pe);if(e.length>=1)this.entitySingular=e[0].value,this.entitySingular=uu.getDefault(this.entitySingular,this.entitySingular);else{var t=fu(this.getLocalTextDbPrefix()+"EntitySingular");t==null&&(t=this.getEntityType()),this.entitySingular=t}return this.entitySingular}getNameProperty(){if(this.nameProperty!=null)return this.nameProperty;var e=this.attrs(Ot);return e.length>=1?this.nameProperty=e[0].value:this.nameProperty="Name",this.nameProperty}getIdProperty(){if(this.idProperty!=null)return this.idProperty;var e=this.attrs(We);return e.length>=1?this.idProperty=e[0].value:this.idProperty="ID",this.idProperty}getIsActiveProperty(){if(this.isActiveProperty!=null)return this.isActiveProperty;var e=this.attrs(Je);return e.length>=1?this.isActiveProperty=e[0].value:this.isActiveProperty="IsActive",this.isActiveProperty}getIsDeletedProperty(){return null}getService(){if(this.service!=null)return this.service;var e=this.attrs(Ee);return e.length>=1?this.service=e[0].value:this.service=cu(this.getEntityType(),".","/"),this.service}load(e,t,i){var r=()=>{if(e==null){this.loadResponse({}),t&&t();return}var o=typeof e;if(o==="string"||o==="number"){var l=e;this.loadById(l,function(c){t&&window.setTimeout(t,0)},null);return}var d=e||new Object;this.loadResponse({Entity:d}),t&&t()};if(i==null){r();return}try{r()}catch(o){var a=su.wrap(o);i(a)}}loadNewAndOpenDialog(e){this.loadResponse({}),this.dialogOpen(e)}loadEntityAndOpenDialog(e,t){this.loadResponse({Entity:e}),this.dialogOpen(t)}loadResponse(e){e=e||{},this.onLoadingData(e);var t=e.Entity||new Object;this.beforeLoadEntity(t),this.loadEntity(t),this.set_entity(t),this.afterLoadEntity()}loadEntity(e){var t=this.getIdProperty();t!=null&&this.set_entityId(e[t]),this.set_entity(e),this.propertyGrid!=null&&(this.propertyGrid.set_mode(this.isEditMode()?2:1),this.propertyGrid.load(e))}beforeLoadEntity(e){this.localizationPendingValue=null,this.localizationLastValue=null}afterLoadEntity(){this.updateInterface(),this.updateTitle()}loadByIdAndOpenDialog(e,t){this.loadById(e,i=>window.setTimeout(()=>this.dialogOpen(t),0),()=>{this.element.is(":visible")||this.element.remove()})}onLoadingData(e){}getLoadByIdOptions(e,t){return{}}getLoadByIdRequest(e){var t={};return t.EntityId=e,t}reloadById(){this.loadById(this.get_entityId())}loadById(e,t,i){var r={service:this.getService()+"/Retrieve",blockUI:!0,request:this.getLoadByIdRequest(e),onSuccess:l=>{this.loadResponse(l),t&&t(l)},onCleanup:()=>{this.validator!=null&&ea(this.validator)}},a=this.getLoadByIdOptions(e,t),o=St(r,a);this.loadByIdHandler(o,t,i)}loadByIdHandler(e,t,i){var r=pi(e);i&&r.fail(i)}initLocalizationGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.initLocalizationGridCommon(t)}}initLocalizationGridCommon(e){var t=this.byId("PropertyGrid");if(ru(e.items,c=>c.localizable===!0)){var i=$("<div/>").attr("id",this.idPrefix+"LocalizationGrid").hide().insertAfter(t);e.idPrefix=this.idPrefix+"Localization_";var r=[];for(var a of e.items){var o=null;if(a.localizable===!0){var l=St({},a);l.oneWay=!0,l.readOnly=!0,l.required=!1,l.defaultValue=null,r.push(l),o==null&&(o=this.getLangs());for(var d of o)l=St({},a),l.name=d[0]+"$"+l.name,l.title=d[1],l.cssClass=[l.cssClass,"translation"].join(" "),l.insertable=!0,l.updatable=!0,l.oneWay=!1,l.required=!1,l.localizable=!1,l.defaultValue=null,r.push(l)}}e.items=r,this.localizationGrid=new M(i,e).init(null),i.addClass("s-LocalizationGrid")}}isLocalizationMode(){return this.localizationButton!=null&&this.localizationButton.hasClass("pressed")}isLocalizationModeAndChanged(){if(!this.isLocalizationMode())return!1;var e=this.getLocalizationGridValue();return JSON.stringify(this.localizationLastValue)!=JSON.stringify(e)}localizationButtonClick(){if(!(this.isLocalizationMode()&&!this.validateForm())){if(this.isLocalizationModeAndChanged()){var e=this.getLocalizationGridValue();this.localizationLastValue=e,this.localizationPendingValue=e}this.localizationButton.toggleClass("pressed"),this.updateInterface(),this.isLocalizationMode()&&this.loadLocalization()}}getLanguages(){return Ge.defaultLanguageList!=null?Ge.defaultLanguageList()||[]:[]}getLangs(){var e=this.getLanguages(),t=hu(e,Array);return(t==null||t.length===0||t[0]==null||!du(t[0]))&&(t=Array.prototype.slice.call(e.map(function(i){return[i.item1,i.item2]}))),t}loadLocalization(){if(this.localizationLastValue==null&&this.isNew()){this.localizationGrid.load({}),this.setLocalizationGridCurrentValues(),this.localizationLastValue=this.getLocalizationGridValue();return}if(this.localizationLastValue!=null){this.localizationGrid.load(this.localizationLastValue),this.setLocalizationGridCurrentValues();return}var e={service:this.getService()+"/Retrieve",blockUI:!0,request:{EntityId:this.get_entityId(),ColumnSelection:"keyOnly",IncludeColumns:["Localizations"]},onSuccess:t=>{var i=St(new Object,this.get_entity());if(t.Localizations)for(var r of Object.keys(t.Localizations)){var a=t.Localizations[r];for(var o of Object.keys(a))i[r+"$"+o]=a[o]}this.localizationGrid.load(i),this.setLocalizationGridCurrentValues(),this.localizationPendingValue=null,this.localizationLastValue=this.getLocalizationGridValue()}};pi(e)}setLocalizationGridCurrentValues(){var e={};this.localizationGrid.enumerateItems((t,i)=>{t.name.indexOf("$")<0&&i.element.is(":input")&&(e[t.name]=this.byId(t.name).val(),i.element.val(e[t.name]))}),this.localizationGrid.enumerateItems((t,i)=>{var r=t.name.indexOf("$");if(r>=0&&i.element.is(":input")){var a=e[t.name.substr(r+1)];a!=null&&a.length>0&&i.element.attr("title",a).attr("placeholder",a)}})}getLocalizationGridValue(){var e={};this.localizationGrid.save(e);for(var t of Object.keys(e))t.indexOf("$")<0&&delete e[t];return e}getPendingLocalizations(){if(this.localizationPendingValue==null)return null;var e={},t=this.getIdProperty(),i=this.getLangs();for(var r of i){var a=r[0],o={};t!=null&&(o[t]=this.get_entityId());var l=a+"$";for(var d of Object.keys(this.localizationPendingValue))gu(d,l)&&(o[d.substr(l.length)]=this.localizationPendingValue[d]);e[a]=o}return e}initPropertyGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.propertyGrid=new M(e,t).init(null),this.element.closest(".ui-dialog").hasClass("s-Flexify")&&this.propertyGrid.element.children(".categories").flexHeightOnly(1)}}getPropertyItems(){var e;return((e=this.propertyItemsData)==null?void 0:e.items)||[]}getPropertyItemsData(){var e=this.getFormKey();return this.getFormKey===Ge.prototype.getFormKey&&this.getPropertyItems!==Ge.prototype.getPropertyItems&&!mu.canLoad("Form."+e)?{items:this.getPropertyItems(),additionalItems:[]}:Xt(e)?{items:[],additionalItems:[]}:au(e)}getPropertyItemsDataAsync(){return De(this,null,function*(){var e=this.getFormKey();return Xt(e)?{items:[],additionalItems:[]}:yield ou(e)})}getPropertyGridOptions(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,localTextPrefix:"Forms."+this.getFormKey()+".",useCategories:!0}}validateBeforeSave(){return!0}getSaveOptions(e){var t={};return t.service=this.getService()+"/"+(this.isEditMode()?"Update":"Create"),t.onSuccess=i=>{this.onSaveSuccess(i),e&&e(i);var r=this.isEditMode()?"update":"create",a=t.request==null?null:t.request.Entity,o=this.isEditMode()?this.get_entityId():i==null?null:i.EntityId,l={type:r,entity:a,entityId:o};this.element.triggerHandler("ondatachange",[l])},t.onCleanup=()=>{this.validator&&ea(this.validator)},t.request=this.getSaveRequest(),t}getSaveEntity(){var e=new Object;if(this.propertyGrid!=null&&this.propertyGrid.save(e),this.isEditMode()){var t=this.getIdProperty();t!=null&&e[t]==null&&(e[t]=this.get_entityId())}return e}getSaveRequest(){var e=this.getSaveEntity(),t={};if(t.Entity=e,this.isEditMode()){var i=this.getIdProperty();i!=null&&(t.EntityId=this.get_entityId())}return this.localizationPendingValue!=null&&(t.Localizations=this.getPendingLocalizations()),t}onSaveSuccess(e){}save_submitHandler(e){var t=this.getSaveOptions(e);this.saveHandler(t,e)}save(e){return Dt.submit(this.byId("Form"),()=>this.validateBeforeSave(),()=>this.save_submitHandler(e))}saveHandler(e,t){pi(e)}initToolbar(){super.initToolbar(),this.toolbar&&(this.saveAndCloseButton=this.toolbar.findButton("save-and-close-button"),this.applyChangesButton=this.toolbar.findButton("apply-changes-button"),this.deleteButton=this.toolbar.findButton("delete-button"),this.undeleteButton=this.toolbar.findButton("undo-delete-button"),this.editButton=this.toolbar.findButton("edit-button"),this.cloneButton=this.toolbar.findButton("clone-button"),this.localizationButton=this.toolbar.findButton("localization-button"))}showSaveSuccessMessage(e){pu(z("Controls.EntityDialog.SaveSuccessMessage"),"",null)}getToolbarButtons(){var e=[];return e.push({title:z("Controls.EntityDialog.SaveButton"),cssClass:"save-and-close-button",icon:"fa-check-circle text-purple",hotkey:"alt+s",onClick:()=>{this.save(t=>{this.dialogClose()})},visible:()=>!this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasSavePermission()||this.readOnly}),e.push({title:"",hint:z("Controls.EntityDialog.ApplyChangesButton"),cssClass:"apply-changes-button",icon:"fa-clipboard-check text-purple",hotkey:"alt+a",onClick:()=>{this.save(t=>{if(this.isEditMode()){var i=t.EntityId;i==null&&(i=this.get_entityId()),this.loadById(i)}else this.loadById(t.EntityId);this.showSaveSuccessMessage(t)})},visible:()=>!this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasSavePermission()||this.readOnly}),e.push({title:z("Controls.EntityDialog.DeleteButton"),cssClass:"delete-button",icon:"fa-trash-o text-red",hotkey:"alt+x",onClick:()=>{Xn(z("Controls.EntityDialog.DeleteConfirmation"),()=>{this.doDelete(()=>this.dialogClose())})},visible:()=>this.isEditMode()&&!this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasDeletePermission()||this.readOnly}),e.push({title:z("Controls.EntityDialog.UndeleteButton"),cssClass:"undo-delete-button",onClick:()=>{this.isDeleted()&&Xn(z("Controls.EntityDialog.UndeleteConfirmation"),()=>{this.undelete(()=>this.loadById(this.get_entityId()))})},visible:()=>this.isEditMode()&&this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasDeletePermission()||this.readOnly}),this.useViewMode()&&e.push({title:z("Controls.EntityDialog.EditButton"),cssClass:"edit-button",icon:"fa-edit",onClick:()=>{this.isEditMode()&&(this.editClicked=!0,this.updateInterface(),this.updateTitle())},visible:()=>this.isViewMode(),disabled:()=>!this.hasSavePermission()||this.readOnly}),e.push({title:z("Controls.EntityDialog.LocalizationButton"),cssClass:"localization-button",onClick:()=>this.localizationButtonClick()}),e.push({title:z("Controls.EntityDialog.CloneButton"),cssClass:"clone-button",icon:"fa-clone",onClick:()=>{if(this.isEditMode()){var t=this.getCloningEntity();b.create({type:Ts(this),init:i=>xe.bubbleDataChange(xe.cascade(i,this.element),this,!0).loadEntityAndOpenDialog(t,null)})}},visible:()=>!1,disabled:()=>!this.hasInsertPermission()||this.readOnly}),e}getCloningEntity(){var e=new Object;e=St(e,this.get_entity());var t=this.getIdProperty();Xt(t)||delete e[t];var i=this.getIsActiveProperty();Xt(i)||delete e[i];var r=this.getIsDeletedProperty();return Xt(r)||delete e[r],e}updateInterface(){w.setContainerReadOnly(this.byId("Form"),!1);var e=this.isLocalizationMode(),t=this.hasSavePermission(),i=this.isViewMode(),r=this.readOnly;if(this.toolbar.updateInterface(),this.tabs!=null&&Bi.setDisabled(this.tabs,"Log",this.isNewOrDeleted()),this.propertyGrid!=null&&this.propertyGrid.element.toggle(!e),this.localizationGrid!=null&&this.localizationGrid.element.toggle(e),this.localizationButton!=null&&(this.localizationButton.toggle(this.localizationGrid!=null),this.localizationButton.find(".button-inner").text(this.isLocalizationMode()?z("Controls.EntityDialog.LocalizationBack"):z("Controls.EntityDialog.LocalizationButton"))),e){this.toolbar!=null&&this.toolbar.findButton("tool-button").not(".localization-hidden").addClass(".localization-hidden").hide(),this.localizationButton&&this.localizationButton.show();return}this.toolbar.findButton("localization-hidden").removeClass("localization-hidden").show(),(!t||i||r)&&w.setContainerReadOnly(this.byId("Form"),!0)}getUndeleteOptions(e){return{}}undeleteHandler(e,t){pi(e)}undelete(e){var t={};t.service=this.getService()+"/Undelete";var i={};i.EntityId=this.get_entityId(),t.request=i,t.onSuccess=o=>{e&&e(o),this.element.triggerHandler("ondatachange",[{entityId:this.get_entityId(),entity:this.entity,type:"undelete"}])};var r=this.getUndeleteOptions(e),a=St(t,r);this.undeleteHandler(a,e)}get readOnly(){return this.get_readOnly()}set readOnly(e){this.set_readOnly(e)}get_readOnly(){return!!this._readonly}set_readOnly(e){!!this._readonly!=!!e&&(this._readonly=!!e,this.updateInterface(),this.updateTitle())}getInsertPermission(){return null}getUpdatePermission(){return null}getDeletePermission(){return null}hasDeletePermission(){var e=this.getDeletePermission();return e==null||Ss.hasPermission(e)}hasInsertPermission(){var e=this.getInsertPermission();return e==null||Ss.hasPermission(e)}hasUpdatePermission(){var e=this.getUpdatePermission();return e==null||Ss.hasPermission(e)}hasSavePermission(){return this.isNew()?this.hasInsertPermission():this.hasUpdatePermission()}isViewMode(){return this.useViewMode()&&this.isEditMode()&&!this.editClicked}useViewMode(){return!1}getFallbackTemplate(){return`<div class="s-DialogContent">
    <div id="~_Toolbar" class="s-DialogToolbar">
    </div>
    <div class="s-Form">
        <form id="~_Form" action="">
            <div class="fieldset">
                <div id="~_PropertyGrid"></div>
                <div class="clear"></div>
            </div>
        </form> 
    </div>
</div>`}};Ge=h([m.registerClass("Serenity.EntityDialog",[Re,E])],Ge);import{postToService as yu,serviceCall as vu,trimToNull as ta}from"@serenity-is/corelib/q";var ia;(e=>{let p=class extends V{constructor(r){super(r);r.reportKey&&this.loadReport(r.reportKey)}createPropertyGrid(){this.propertyGrid&&(this.byId("PropertyGrid").html("").attr("class",""),this.propertyGrid=null),this.propertyGrid=new M(this.byId("PropertyGrid"),{idPrefix:this.idPrefix,useCategories:!0,items:this.propertyItems}).init(null)}loadReport(r){vu({service:"Report/Retrieve",request:{ReportKey:r},onSuccess:a=>{var l;this.reportKey=(l=a.ReportKey)!=null?l:r,this.propertyItems=a.Properties||[],this.dialogTitle=a.Title,this.createPropertyGrid();var o=a.InitialSettings;o==null&&(o=new Object),this.propertyGrid.load(o),this.toolbar.findButton("print-preview-button").toggle(!a.IsDataOnlyReport),this.toolbar.findButton("export-pdf-button").toggle(!a.IsDataOnlyReport),this.toolbar.findButton("export-docx-button").toggle(!a.IsDataOnlyReport),this.dialogOpen(null)}})}executeReport(r,a){if(this.validateForm()){var o=new Object;this.propertyGrid.save(o),yu({service:"Report/Execute",request:{ReportKey:this.reportKey,DesignId:"Default",ExportType:a,Parameters:o},target:r})}}getToolbarButtons(){var r=[];return r.push({title:"\xD6nizleme",cssClass:"print-preview-button",onClick:()=>{this.executeReport("_blank",null)}}),r.push({title:"PDF",cssClass:"export-pdf-button",onClick:()=>{this.executeReport("","Pdf")}}),r.push({title:"Excel",cssClass:"export-xlsx-button",onClick:()=>{this.executeReport("","Xlsx")}}),r.push({title:"Word",cssClass:"export-docx-button",onClick:()=>{this.executeReport("","Docx")}}),r}};p=h([m.registerClass("Serenity.Reporting.ReportDialog")],p),e.ReportDialog=p;let n=class extends b{constructor(i){super(i),$(".report-link").click(a=>this.reportLinkClick(a)),$("div.line").click(a=>this.categoryClick(a));var r=this;new te($("#QuickSearchInput"),{onSearch:function(a,o,l){r.updateMatchFlags(o),l(!0)}})}updateMatchFlags(i){var r=$("#ReportList").find("li").removeClass("non-match");if(i=ta(i),i==null){r.children("ul").hide(),r.show().removeClass("expanded");return}for(var a=i.replace(","," ").split(" "),o=0;o<a.length;o++)a[o]=ta(Select2.util.stripDiacritics(a[o]).toUpperCase());var l=r.filter(".report-item");l.each(function(g,y){var O;for(var f=$(y),v=Select2.util.stripDiacritics(((O=f.text())!=null?O:"").toUpperCase()),C=0;C<a.length;C++){var S=a[C];if(S!=null&&v.indexOf(S)===-1){f.addClass("non-match");break}}});var d=l.not(".non-match"),c=d.parents("li").add(d),u=r.not(c);u.hide().addClass("non-match"),c.show(),c.length<=100&&(r.children("ul").show(),r.addClass("expanded"))}categoryClick(i){var r=$(i.target).closest("li");r.hasClass("expanded")?(r.find("ul").hide("fast"),r.removeClass("expanded"),r.find("li").removeClass("expanded")):(r.addClass("expanded"),r.children("ul").show("fast"),r.children("ul").children("li").length===1&&!r.children("ul").children("li").hasClass("expanded")&&r.children("ul").children("li").children(".line").click())}reportLinkClick(i){i.preventDefault();var r=new p({reportKey:$(i.target).data("key")})}};n=h([m.registerClass("Serenity.Reporting.ReportPage")],n),e.ReportPage=n})(ia||(ia={}));var Ar=class extends ft{constructor(n,e){super(n,e)}getLookupKey(){var n;return(n=this.options.lookupKey)!=null?n:super.getLookupKey()}};Ar=h([m.registerEditor("Serenity.AsyncLookupEditor",[q,J,P,E])],Ar);var Wr=class{};Wr=h([m.registerClass("Serenity.ScriptContext")],Wr);var Jr=class{};Jr=h([m.registerInterface("Serenity.IAsyncInit")],Jr);var qr;(a=>{function p(o,l){return o.getWidget(l)}a.getWidget=p,a.getWidgetName=b.getWidgetName;function e(o){return typeof o.originalEvent!="undefined"}a.hasOriginalEvent=e;function t(o,l){o.change(l)}a.change=t;function i(o,l){o.changeSelect2(l)}a.changeSelect2=i;function r(o){return o.getGridField()}a.getGridField=r})(qr||(qr={}));var Mr=class extends b{constructor(e,t){var d,c,u,g,y,f,v;super(e,t);var i=(u=new google.m)!=null?u:s.LatLng((d=this.options.latitude)!=null?d:0,(c=this.options.longitude)!=null?c:0),r=new Object;if(r.center=i,r.mapTypeId=(g=this.options.mapTypeId)!=null?g:"roadmap",r.zoom=(y=this.options.zoom)!=null?y:15,r.zoomControl=!0,this.map=new google.maps.Map(e[0],r),this.options.markerTitle!=null){var a=new Object,o=this.options.markerLatitude;o==null&&(o=(f=this.options.latitude)!=null?f:0);var l=this.options.markerLongitude;l==null&&(l=(v=this.options.longitude)!=null?v:0),a.position=new google.maps.LatLng(o,l),a.map=this.map,a.title=this.options.markerTitle,a.animation=2,new google.maps.Marker(a)}ve.executeOnceWhenShown(e,()=>{google.maps.event.trigger(this.map,"resize",[]),this.map.setCenter(i)})}get_map(){return this.map}};Mr=h([m.registerEditor("Serenity.GoogleMap",[]),m.element("<div/>")],Mr);import{isEmptyOrNull as ra,isValue as bu,safeCast as Cu,serviceCall as sa,localText as xu,trimToNull as Iu}from"@serenity-is/corelib/q";var $r=class extends b{constructor(e,t){super(e,t);this.pageSize=50;var i=this.emptyItemText();i!=null&&e.attr("placeholder",i),e.select2(this.getSelect2Options()),e.attr("type","text"),e.on("change."+this.uniqueName,(r,a)=>{(qr.hasOriginalEvent(r)||!a)&&Dt.getValidator(e)!=null&&e.valid()})}emptyItemText(){var e=this.element.attr("placeholder");return e==null&&(e=xu("Controls.SelectEditor.EmptyItemText")),e}getService(){throw new Error("Not implemented!")}query(e,t){var i={blockUI:!1,service:this.getService()+"/List",request:e,onSuccess:function(r){t(r)}};this.executeQuery(i)}executeQuery(e){sa(e)}queryByKey(e,t){var i={blockUI:!1,service:this.getService()+"/Retrieve",request:{EntityId:e},onSuccess:function(r){t(r.Entity)}};this.executeQueryByKey(i)}executeQueryByKey(e){sa(e)}getItemKey(e){return null}getItemText(e){return null}getTypeDelay(){return 200}getSelect2Options(){var e=this.emptyItemText(),t=0;return{minimumResultsForSearch:10,placeHolder:ra(e)?null:e,allowClear:bu(e),query:i=>{var r={ContainsText:Iu(i.term),Skip:(i.page-1)*this.pageSize,Take:this.pageSize+1};t!==0&&window.clearTimeout(t);var a=$(this.element).data("select2");a&&a.search&&a.search.removeClass("select2-active").parent().removeClass("select2-active"),t=window.setTimeout(()=>{a&&a.search.addClass("select2-active").parent().addClass("select2-active"),this.query(r,o=>{i.callback({results:o.Entities.slice(0,this.pageSize).map(l=>({id:this.getItemKey(l),text:this.getItemText(l),source:l})),more:o.Entities.length>=this.pageSize})})},this.getTypeDelay())},initSelection:(i,r)=>{var a=i.val();if(ra(a)){r(null);return}this.queryByKey(a,o=>{r(o==null?null:{id:this.getItemKey(o),text:this.getItemText(o),source:o})})}}}addInplaceCreate(e){var t=this;$("<a><b/></a>").addClass("inplace-button inplace-create").attr("title",e).insertAfter(this.element).click(function(i){t.inplaceCreateClick(i)}),this.get_select2Container().add(this.element).addClass("has-inplace-button")}inplaceCreateClick(e){}get_select2Container(){return this.element.prevAll(".select2-container")}get_value(){return Cu(this.element.select2("val"),String)}get value(){return this.get_value()}set_value(e){if(e!==this.get_value()){var t=this.element;t.select2("val",e),t.data("select2-change-triggered",!0);try{t.triggerHandler("change",[!0])}finally{t.data("select2-change-triggered",!1)}}}set value(e){this.set_value(e)}};$r=h([m.registerEditor("Serenity.Select2AjaxEditor",[P]),m.element('<input type="hidden" />')],$r);export{Ar as AsyncLookupEditor,oe as BaseEditorFiltering,xt as BaseFiltering,Wi as BooleanEditor,Wt as BooleanFiltering,Ut as BooleanFormatter,Rs as CaptureOperationType,Ue as CascadedWidgetLink,ci as CategoryAttribute,Br as CheckLookupEditor,ui as CheckTreeEditor,Or as CheckboxFormatter,it as ColumnPickerDialog,$C as ColumnSelection,kt as ColumnsKeyAttribute,UC as Criteria,hi as CssClassAttribute,B as DataGrid,Q as DateEditor,At as DateFiltering,ge as DateFormatter,G as DateTimeEditor,Jt as DateTimeFiltering,wr as DateTimeFormatter,Yi as DateYearEditor,Ie as DecimalEditor,hr as DecimalFiltering,m as Decorators,mi as DefaultValueAttribute,He as DialogExtensions,rt as DialogTypeAttribute,ct as DialogTypeRegistry,Fe as DisplayNameAttribute,vt as EditorFiltering,gi as EditorOptionAttribute,fi as EditorTypeAttribute,Di as EditorTypeAttributeBase,ht as EditorTypeRegistry,w as EditorUtils,st as ElementAttribute,zi as EmailAddressEditor,Et as EmailEditor,Ge as EntityDialog,Lr as EntityGrid,Ae as EntityTypeAttribute,Rt as EnumEditor,mr as EnumFiltering,ke as EnumFormatter,U as EnumKeyAttribute,ze as EnumTypeRegistry,et as FileDownloadFormatter,si as FileUploadEditor,$t as FilterDialog,zt as FilterDisplayBar,k as FilterOperators,Mt as FilterPanel,ae as FilterStore,Ye as FilterWidgetBase,nt as FilterableAttribute,qt as FilteringTypeRegistry,Vi as Flexify,at as FlexifyAttribute,fe as FormKeyAttribute,Fr as FormatterTypeRegistry,yi as GeneratedCodeAttribute,Mr as GoogleMap,Er as GridRadioSelectionMixin,Pr as GridRowSelectionMixin,li as GridSelectAllButtonHelper,It as GridUtils,vi as HiddenAttribute,bi as HintAttribute,ne as HtmlContentEditor,Zi as HtmlNoteContentEditor,er as HtmlReportContentEditor,Jr as IAsyncInit,_e as IBooleanValue,ye as IDialog,Z as IDoubleValue,Re as IEditDialog,Ke as IFiltering,J as IGetEditValue,tt as IInitializeColumn,Ct as IQuickFiltering,E as IReadOnly,q as ISetEditValue,Mp as ISlickFormatter,P as IStringValue,Ve as IValidateRequired,We as IdPropertyAttribute,nr as ImageUploadEditor,Ci as InsertableAttribute,Ft as IntegerEditor,gr as IntegerFiltering,Je as IsActivePropertyAttribute,Pe as ItemNameAttribute,ve as LazyLoadHelper,qe as LocalTextPrefixAttribute,Vt as LookupEditor,ft as LookupEditorBase,fr as LookupFiltering,tr as MaskedEditor,xi as MaxLengthAttribute,ot as MaximizableAttribute,jt as MinuteFormatter,Lt as MultipleFileUploadEditor,ar as MultipleImageUploadEditor,Ot as NamePropertyAttribute,Ne as NumberFormatter,Ii as OneWayAttribute,Me as OptionAttribute,lt as OptionsTypeAttribute,dt as PanelAttribute,Gi as PasswordEditor,Si as PlaceholderAttribute,mt as PopupMenuButton,_i as PopupToolButton,Ns as PrefixedContext,gt as PropertyDialog,M as PropertyGrid,ti as PropertyGridMode,_r as PropertyItemSlickConverter,Li as PropertyPanel,W as QuickFilterBar,te as QuickSearchInput,ji as RadioButtonEditor,Ti as ReadOnlyAttribute,ir as Recaptcha,be as ReflectionOptionsSetter,re as ReflectionUtils,ia as Reporting,ki as RequiredAttribute,ut as ResizableAttribute,pt as ResponsiveAttribute,zC as RetrieveColumnSelection,Wr as ScriptContext,$r as Select2AjaxEditor,L as Select2Editor,je as SelectEditor,Ee as ServiceAttribute,Qt as ServiceLookupEditor,ri as ServiceLookupEditorBase,yr as ServiceLookupFiltering,we as SlickFormatting,Rr as SlickHelper,Ht as SlickPager,ie as SlickTreeHelper,se as StringEditor,vr as StringFiltering,xe as SubDialogHelper,HC as SummaryType,Bi as TabsExtensions,V as TemplatedDialog,wt as TemplatedPanel,N as TemplatedWidget,Ai as TextAreaEditor,Mi as TimeEditor,A as Toolbar,Qr as TreeGridMixin,Hi as URLEditor,Oi as UpdatableAttribute,Te as UploadHelper,Be as UrlFormatter,As as VX,Dt as ValidationHelper,qr as WX,b as Widget,pn as datePickerIconSvg,Fa as reactPatch};
//# sourceMappingURL=index.js.map
